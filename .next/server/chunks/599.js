"use strict";exports.id=599,exports.ids=[599],exports.modules={28254:(a,e,t)=>{t.d(e,{JU:()=>r.JU,KT:()=>i.KT,K_:()=>r.K_,LE:()=>o,ME:()=>r.ME,Rk:()=>n.Rk,SX:()=>r.SX,TF:()=>r.TF,Tq:()=>l,Ys:()=>r.Ys,ah:()=>i.ah,h1:()=>r.h1,jz:()=>r.jz,lT:()=>r.lT,s2:()=>r.publishCampaign,t9:()=>r.t9}),t(91905);var r=t(50857),i=t(83893),n=t(53442);async function s(a){let{createLead:e}=await Promise.resolve().then(t.bind(t,83893)),{incrementLeadsUsage:r,canCaptureLeads:i}=await Promise.resolve().then(t.bind(t,53442)),n=await i(1);if(!n.success)return n;if(!n.data)return{success:!1,error:"Monthly leads limit reached"};let s=await e(a);return s.success&&await r(1),s}async function l(a){let{createCampaign:e}=await Promise.resolve().then(t.bind(t,50857)),{incrementCampaignUsage:r,canCreateCampaign:i}=await Promise.resolve().then(t.bind(t,53442)),n=await i();if(!n.success)return n;if(!n.data)return{success:!1,error:"Monthly campaign limit reached"};let s=await e(a);return s.success&&await r(),s}async function o(a,e,t){return e.email?s({campaign_id:a,name:e.name||null,email:e.email,phone:e.phone||null,ip_address:t?.ip_address||null,user_agent:t?.user_agent||null,referrer:t?.referrer||null,utm_source:t?.utm_source||null,utm_medium:t?.utm_medium||null,utm_campaign:t?.utm_campaign||null,utm_term:t?.utm_term||null,utm_content:t?.utm_content||null,metadata:{capture_form:!0,gdpr_consent:e.gdprConsent||!1,marketing_consent:e.marketingConsent||!1,capture_timestamp:new Date().toISOString()},completed_at:null}):{success:!1,error:"Email is required",validation_errors:[{field:"email",message:"Email address is required",code:"REQUIRED_FIELD",value:e.email}]}}},50857:(a,e,t)=>{t.d(e,{JU:()=>g,K_:()=>o,ME:()=>s,SX:()=>l,TF:()=>d,Ys:()=>f,createCampaign:()=>i,h1:()=>m,jz:()=>n,lT:()=>p,publishCampaign:()=>u,t9:()=>_});var r=t(91905);async function i(a){let e=(0,r.Rv)(a,["name"]);if(e.length>0)return{success:!1,error:"Validation failed",validation_errors:e};let t=await (0,r.oC)(),i=await (0,r.AG)();return(0,r.Uj)(async()=>await i.from("campaigns").insert({...a,user_id:t}).select().single())}async function n(a,e=!1){if(!(0,r.aJ)(a))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let t=await (0,r.AG)();return(0,r.Uj)(async()=>{let r=t.from("campaigns").select(e?`
        *,
        sections (
          *,
          section_options (*)
        ),
        campaign_variables (*),
        campaign_analytics (*)
      `:"*").eq("id",a);return await r.single()})}async function s(a={}){let e=await (0,r.oC)(),t=await (0,r.AG)(),{status:i,search:n,...l}=a;return(0,r.Uj)(async()=>{let a=t.from("campaigns").select("*",{count:"exact"}).eq("user_id",e);i&&(a=a.eq("status",i)),n&&(a=a.or(`name.ilike.%${n}%,description.ilike.%${n}%`)),a=(0,r.fu)(a,{sort_by:"created_at",...l});let{data:s,error:o,count:c}=await a;if(o)return{data:null,error:o};let{page:d=1,per_page:u=20}=l,m=Math.ceil((c||0)/u);return{data:{data:s||[],meta:{total:c||0,page:d,per_page:u,has_more:d<m,total_pages:m}},error:null}})}async function l(a,e){if(!(0,r.aJ)(a))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let t=await (0,r.AG)();return(0,r.Uj)(async()=>await t.from("campaigns").update({...e,updated_at:new Date().toISOString()}).eq("id",a).select().single())}async function o(a){if(!(0,r.aJ)(a))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let e=await (0,r.AG)();return(0,r.Uj)(async()=>{let{error:t}=await e.from("campaigns").delete().eq("id",a);return{data:!t,error:t}})}async function c(a,e){let t=await (0,r.AG)();return(0,r.Uj)(async()=>{let r=a.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim().substring(0,50);(r=r.replace(/^-+|-+$/g,""))||(r="campaign");let i=r,n=0;for(;n<100;){let a=t.from("campaigns").select("id").eq("published_url",i);e&&(a=a.neq("id",e));let{data:s,error:l}=await a;if(l)throw l;if(!s||0===s.length)return{data:i,error:null};n++,i=`${r}-${n}`}throw Error("Failed to generate unique URL after multiple attempts")})}async function d(a){if(!(0,r.aJ)(a))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let e=await (0,r.AG)();return(0,r.Uj)(async()=>{let t=[],{data:r,error:i}=await e.from("campaigns").select(`
        *,
        sections (
          id,
          type,
          title,
          settings
        )
      `).eq("id",a).single();if(i||!r)throw i||Error("Campaign not found");return r.sections&&0!==r.sections.length||t.push("Campaign must have at least one section"),r.name&&0!==r.name.trim().length||t.push("Campaign must have a name"),r.sections&&r.sections.forEach((a,e)=>{a.title&&0!==a.title.trim().length||t.push(`Section ${e+1} must have a title`)}),{data:{isValid:0===t.length,errors:t},error:null}})}async function u(a,e){if(!(0,r.aJ)(a))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let t=await (0,r.AG)();return(0,r.Uj)(async()=>{let r,i=await d(a);if(!i.success||!i.data?.isValid){let a=i.data?.errors||["Campaign validation failed"];throw Error(`Cannot publish campaign: ${a.join(", ")}`)}let{data:n,error:s}=await t.from("campaigns").select("name, published_url").eq("id",a).single();if(s||!n)throw s||Error("Campaign not found");if(e){if(!/^[a-z0-9-]+$/.test(e)||e.length<3||e.length>50)throw Error("Custom URL must be 3-50 characters long and contain only lowercase letters, numbers, and hyphens");let{data:i,error:n}=await t.from("campaigns").select("id").eq("published_url",e).neq("id",a);if(n)throw n;if(i&&i.length>0)throw Error("This custom URL is already taken. Please choose a different one.");r=e}else{let e=await c(n.name,a);if(!e.success||!e.data)throw Error(e.error||"Failed to generate unique URL");r=e.data}let l={status:"published",published_at:new Date().toISOString(),published_url:r,is_active:!0,updated_at:new Date().toISOString()},{data:o,error:u}=await t.from("campaigns").update(l).eq("id",a).select().single();if(u)throw u;return{data:o,error:null}})}async function m(a,e=!1){if(!(0,r.aJ)(a))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let t=await (0,r.AG)();return(0,r.Uj)(async()=>{let r={status:"draft",published_at:null,is_active:!1,updated_at:new Date().toISOString()};return e||(r.published_url=null),await t.from("campaigns").update(r).eq("id",a).select().single()})}async function p(a,e){let t=await (0,r.AG)();return(0,r.Uj)(async()=>{if(!/^[a-z0-9-]+$/.test(a)||a.length<3||a.length>50)return{data:{available:!1,suggestions:void 0},error:null};let r=t.from("campaigns").select("published_url").eq("published_url",a);e&&(r=r.neq("id",e));let{data:i,error:n}=await r;if(n)throw n;let s=!i||0===i.length,l=[];if(!s)for(let e=1;e<=5;e++){let r=`${a}-${e}`,{data:i}=await t.from("campaigns").select("published_url").eq("published_url",r).limit(1);i&&0!==i.length||l.push(r)}return{data:{available:s,suggestions:l.length>0?l:void 0},error:null}})}async function f(a){if(!(0,r.aJ)(a))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let e=await (0,r.AG)();return(0,r.Uj)(async()=>{let{data:t,error:r}=await e.from("campaigns").select("status, published_at").eq("id",a).single();if(r||!t)throw r||Error("Campaign not found");if("published"!==t.status||!t.published_at)throw Error("Only published campaigns can be activated");return await e.from("campaigns").update({is_active:!0,updated_at:new Date().toISOString()}).eq("id",a).select().single()})}async function g(a){if(!(0,r.aJ)(a))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let e=await (0,r.AG)();return(0,r.Uj)(async()=>{let{data:t,error:r}=await e.from("campaigns").select("status, published_at").eq("id",a).single();if(r||!t)throw r||Error("Campaign not found");if("published"!==t.status||!t.published_at)throw Error("Only published campaigns can be deactivated");return await e.from("campaigns").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",a).select().single()})}async function _(a){if(!(0,r.aJ)(a))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let e=await (0,r.AG)();return(0,r.Uj)(async()=>{let{data:t,error:r}=await e.from("campaigns").select("status, published_at, is_active").eq("id",a).single();if(r||!t)throw r||Error("Campaign not found");let i="published"===t.status&&!!t.published_at;return{data:{isPublished:i,isActive:t.is_active,canActivate:i},error:null}})}},53442:(a,e,t)=>{t.d(e,{Rk:()=>i,canCaptureLeads:()=>o,canCreateCampaign:()=>l,incrementCampaignUsage:()=>n,incrementLeadsUsage:()=>s});var r=t(91905);async function i(){let a=await (0,r.oC)(),e=await (0,r.AG)();return(0,r.Uj)(async()=>await e.from("profiles").select("*").eq("id",a).single())}async function n(){let a=await (0,r.oC)(),e=await (0,r.AG)(),{data:t,error:i}=await e.from("profiles").select("monthly_campaigns_used, monthly_campaign_limit").eq("id",a).single();if(i)return{success:!1,error:i.message||"Failed to fetch profile"};let n=t.monthly_campaigns_used||0,s=t.monthly_campaign_limit||0;return s>0&&n>=s?{success:!1,error:"Monthly campaign limit exceeded",validation_errors:[{field:"monthly_campaigns_used",message:`You have reached your monthly limit of ${s} campaigns`,code:"LIMIT_EXCEEDED",value:n}]}:(0,r.Uj)(async()=>await e.from("profiles").update({monthly_campaigns_used:n+1,updated_at:new Date().toISOString()}).eq("id",a).select().single())}async function s(a=1){let e=await (0,r.oC)(),t=await (0,r.AG)(),{data:i,error:n}=await t.from("profiles").select("monthly_leads_captured, monthly_leads_limit").eq("id",e).single();if(n)return{success:!1,error:n.message||"Failed to fetch profile"};let l=i.monthly_leads_captured||0,o=i.monthly_leads_limit||0;return o>0&&l+a>o?{success:!1,error:"Monthly leads limit exceeded",validation_errors:[{field:"monthly_leads_captured",message:`Adding ${a} lead(s) would exceed your monthly limit of ${o} leads`,code:"LIMIT_EXCEEDED",value:l}]}:(0,r.Uj)(async()=>await t.from("profiles").update({monthly_leads_captured:l+a,updated_at:new Date().toISOString()}).eq("id",e).select().single())}async function l(){let a=await (0,r.oC)(),e=await (0,r.AG)();return(0,r.Uj)(async()=>{let{data:t,error:r}=await e.from("profiles").select("monthly_campaigns_used, monthly_campaign_limit").eq("id",a).single();return r?{data:null,error:r}:{data:t.monthly_campaign_limit<=0||t.monthly_campaigns_used<t.monthly_campaign_limit,error:null}})}async function o(a=1){let e=await (0,r.oC)(),t=await (0,r.AG)();return(0,r.Uj)(async()=>{let{data:r,error:i}=await t.from("profiles").select("monthly_leads_captured, monthly_leads_limit").eq("id",e).single();return i?{data:null,error:i}:{data:r.monthly_leads_limit<=0||r.monthly_leads_captured+a<=r.monthly_leads_limit,error:null}})}},55192:(a,e,t)=>{t.d(e,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>s,aR:()=>l,wL:()=>u});var r=t(60687),i=t(43210),n=t(96241);let s=i.forwardRef(({className:a,...e},t)=>(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",a),...e}));s.displayName="Card";let l=i.forwardRef(({className:a,...e},t)=>(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...e}));l.displayName="CardHeader";let o=i.forwardRef(({className:a,...e},t)=>(0,r.jsx)("div",{ref:t,className:(0,n.cn)("font-semibold leading-none tracking-tight",a),...e}));o.displayName="CardTitle";let c=i.forwardRef(({className:a,...e},t)=>(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...e}));c.displayName="CardDescription";let d=i.forwardRef(({className:a,...e},t)=>(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...e}));d.displayName="CardContent";let u=i.forwardRef(({className:a,...e},t)=>(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...e}));u.displayName="CardFooter"},83893:(a,e,t)=>{t.d(e,{KT:()=>n,ah:()=>s,createLead:()=>i});var r=t(91905);async function i(a){let e=(0,r.Rv)(a,["campaign_id","email"]);if(e.length>0)return{success:!1,error:"Validation failed",validation_errors:e};if(!(0,r.aJ)(a.campaign_id))return{success:!1,error:"Invalid campaign ID format"};if(!(0,r.B9)(a.email))return{success:!1,error:"Invalid email format",validation_errors:[{field:"email",message:"Please provide a valid email address",code:"INVALID_EMAIL",value:a.email}]};let t=await (0,r.AG)();return(0,r.Uj)(async()=>await t.from("leads").insert(a).select().single())}async function n(a){if(!(0,r.aJ)(a))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let e=await (0,r.AG)();return(0,r.Uj)(async()=>{let{count:t}=await e.from("leads").select("*",{count:"exact",head:!0}).eq("campaign_id",a),{count:r}=await e.from("leads").select("*",{count:"exact",head:!0}).eq("campaign_id",a).not("completed_at","is",null),{data:i}=await e.from("leads").select("*").eq("campaign_id",a).order("created_at",{ascending:!1}).limit(10),n=t||0,s=r||0;return{data:{total:n,completed:s,conversion_rate:Math.round(100*(n>0?s/n*100:0))/100,recent_leads:i||[]},error:null}})}async function s(a={}){await (0,r.oC)();let e=await (0,r.AG)(),{campaign_id:t,completed:i,search:n,...l}=a;return(0,r.Uj)(async()=>{let a=e.from("leads").select(`
        *,
        campaigns!inner (*)
      `,{count:"exact"});t&&(a=a.eq("campaign_id",t)),void 0!==i&&(a=i?a.not("completed_at","is",null):a.is("completed_at",null)),n&&(a=a.or(`name.ilike.%${n}%,email.ilike.%${n}%,phone.ilike.%${n}%`)),a=(0,r.fu)(a,{sort_by:"created_at",sort_order:"desc",...l});let{data:s,error:o,count:c}=await a;if(o)return{data:null,error:o};let{page:d=1,per_page:u=20}=l,m=Math.ceil((c||0)/u);return{data:{data:s||[],meta:{total:c||0,page:d,per_page:u,has_more:d<m,total_pages:m}},error:null}})}}};