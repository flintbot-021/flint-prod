(()=>{var e={};e.id=111,e.ids=[111],e.modules={272:(e,t,s)=>{Promise.resolve().then(s.bind(s,85071))},443:(e,t,s)=>{"use strict";s.d(t,{MX:()=>a,fX:()=>r,m$:()=>o,zP:()=>n});let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),a=e=>{let t=i(e);return t.charAt(0).toUpperCase()+t.slice(1)},n=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim(),o=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5336:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11437:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},11997:e=>{"use strict";e.exports=require("punycode")},14952:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},16189:(e,t,s)=>{"use strict";var r=s(65773);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},24624:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var r=s(43210),i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},a=s(443);let n=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:n,className:o="",children:l,iconNode:c,...h},d)=>(0,r.createElement)("svg",{ref:d,...i,width:t,height:t,stroke:e,strokeWidth:n?24*Number(s)/Number(t):s,className:(0,a.zP)("lucide",o),...!l&&!(0,a.m$)(h)&&{"aria-hidden":"true"},...h},[...c.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(l)?l:[l]]))},27910:e=>{"use strict";e.exports=require("stream")},28947:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},35120:(e,t,s)=>{Promise.resolve().then(s.bind(s,94533))},41552:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var r=s(43210),i=s(443),a=s(24624);let n=(e,t)=>{let s=(0,r.forwardRef)(({className:s,...n},o)=>(0,r.createElement)(a.A,{ref:o,iconNode:t,className:(0,i.zP)(`lucide-${(0,i.fX)((0,i.MX)(e))}`,`lucide-${e}`,s),...n}));return s.displayName=(0,i.MX)(e),s}},41862:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},43649:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},47033:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},48730:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},58887:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},60721:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>d,pages:()=>h,routeModule:()=>u,tree:()=>c});var r=s(65239),i=s(48088),a=s(88170),n=s.n(a),o=s(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c={children:["",{children:["c",{children:["[slug]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,85071)),"/Users/kevindunbar/Desktop/Design Club/Clients/Flint/Lead Magnet/flint-prod/app/c/[slug]/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,46055))).default(e)],apple:[],openGraph:[async e=>(await Promise.resolve().then(s.bind(s,90253))).default(e)],twitter:[async e=>(await Promise.resolve().then(s.bind(s,59479))).default(e)],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,58014)),"/Users/kevindunbar/Desktop/Design Club/Clients/Flint/Lead Magnet/flint-prod/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,46055))).default(e)],apple:[],openGraph:[async e=>(await Promise.resolve().then(s.bind(s,90253))).default(e)],twitter:[async e=>(await Promise.resolve().then(s.bind(s,59479))).default(e)],manifest:void 0}}]}.children,h=["/Users/kevindunbar/Desktop/Design Club/Clients/Flint/Lead Magnet/flint-prod/app/c/[slug]/page.tsx"],d={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/c/[slug]/page",pathname:"/c/[slug]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67141:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]])},70663:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]])},74075:e=>{"use strict";e.exports=require("zlib")},78200:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]])},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},85071:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/kevindunbar/Desktop/Design Club/Clients/Flint/Lead Magnet/flint-prod/app/c/[slug]/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/kevindunbar/Desktop/Design Club/Clients/Flint/Lead Magnet/flint-prod/app/c/[slug]/page.tsx","default")},87891:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]])},91645:e=>{"use strict";e.exports=require("net")},93613:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(41552).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},94533:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eb});var r,i=s(60687),a=s(43210),n=s(16189),o=s(91905),l=s(96241),c=s(24934),h=s(59821),d=s(78200),u=s(41862),p=s(5336),m=s(48730),g=s(28947),f=s(58887),y=s(93613),x=s(87891),v=s(70663),b=s(43649),w=s(67141),S=s(11437),N=s(47033),E=s(14952);class j{register(e){let t=new Date,s={...e,createdAt:t,updatedAt:t};if(this.validateMetadata(s),this.variables.has(e.id))throw Error(`Variable '${e.id}' is already registered`);this.variables.set(e.id,s),void 0!==e.defaultValue&&this.values.set(e.id,e.defaultValue),console.log(`Variable registered: ${e.id} (${e.type})`)}unregister(e){if(!this.variables.has(e))throw Error(`Variable '${e}' is not registered`);for(let[t,s]of(this.variables.delete(e),this.values.delete(e),this.dependencies.delete(e),this.dependents.delete(e),this.dependencies.entries()))s.delete(e);for(let[t,s]of this.dependents.entries())s.delete(e);console.log(`Variable unregistered: ${e}`)}getVariable(e){return this.variables.get(e)}getAllVariables(){return Array.from(this.variables.values())}getVariablesByNamespace(e){return Array.from(this.variables.values()).filter(t=>t.namespace===e)}getVariablesBySource(e){return Array.from(this.variables.values()).filter(t=>t.sourceSection===e)}setValue(e,t){let s=this.variables.get(e);if(!s)throw Error(`Variable '${e}' is not registered`);let r=this.validateValue(e,t);if(!r.isValid)throw Error(`Invalid value for variable '${e}': ${r.errors.join(", ")}`);this.values.set(e,t),s.updatedAt=new Date,console.log(`Variable value updated: ${e} = ${JSON.stringify(t)}`)}getValue(e){if(!this.variables.has(e))throw Error(`Variable '${e}' is not registered`);let t=this.values.get(e),s=this.variables.get(e);return void 0!==t?t:s.defaultValue}hasVariable(e){return this.variables.has(e)}validateValue(e,t){let s=this.variables.get(e);if(!s)return{isValid:!1,errors:[`Variable '${e}' is not registered`],warnings:[]};let r=[],i=[];if(this.validateType(t,s.type)||r.push(`Expected type ${s.type}, got ${typeof t}`),s.required&&(null==t||""===t)&&r.push(`Variable '${e}' is required`),s.validation)for(let e of s.validation){let s=this.validateRule(t,e);s.isValid||(r.push(...s.errors),i.push(...s.warnings))}return{isValid:0===r.length,errors:r,warnings:i}}clear(){this.variables.clear(),this.values.clear(),this.dependencies.clear(),this.dependents.clear(),console.log("Variable registry cleared")}getDependencies(e){return Array.from(this.dependencies.get(e)||[])}getDependents(e){return Array.from(this.dependents.get(e)||[])}validateMetadata(e){if(!e.id)throw Error("Variable ID is required");if(!e.name)throw Error("Variable name is required");if(!e.sourceSection)throw Error("Variable source section is required");if(!this.isValidVariableType(e.type))throw Error(`Invalid variable type: ${e.type}`)}validateType(e,t){if(null==e)return!0;switch(t){case"string":return"string"==typeof e;case"number":return"number"==typeof e&&!isNaN(e);case"boolean":return"boolean"==typeof e;case"array":return Array.isArray(e);case"object":return"object"==typeof e&&!Array.isArray(e);case"date":return e instanceof Date||!isNaN(Date.parse(e));case"email":return"string"==typeof e&&this.isValidEmail(e);case"phone":return"string"==typeof e&&this.isValidPhone(e);case"url":return"string"==typeof e&&this.isValidUrl(e);default:return!1}}validateRule(e,t){let s=[],r=[];switch(t.type){case"min_length":"string"==typeof e&&e.length<t.config.length&&s.push(t.message||`Minimum length is ${t.config.length}`);break;case"max_length":"string"==typeof e&&e.length>t.config.length&&s.push(t.message||`Maximum length is ${t.config.length}`);break;case"pattern":"string"!=typeof e||new RegExp(t.config.pattern).test(e)||s.push(t.message||"Value does not match required pattern");break;case"range":"number"==typeof e&&(void 0!==t.config.min&&e<t.config.min&&s.push(t.message||`Value must be at least ${t.config.min}`),void 0!==t.config.max&&e>t.config.max&&s.push(t.message||`Value must be at most ${t.config.max}`));break;case"custom":if(t.config.validator&&"function"==typeof t.config.validator)try{t.config.validator(e)||s.push(t.message||"Custom validation failed")}catch(e){s.push(t.message||`Custom validation error: ${e}`)}break;default:r.push(`Unknown validation rule type: ${t.type}`)}return{isValid:0===s.length,errors:s,warnings:r}}isValidVariableType(e){return["string","number","boolean","array","object","date","email","phone","url"].includes(e)}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidPhone(e){return/^[\+]?[1-9][\d]{0,15}$/.test(e.replace(/[\s\-\(\)]/g,""))}isValidUrl(e){try{return new URL(e),!0}catch{return!1}}constructor(){this.variables=new Map,this.values=new Map,this.dependencies=new Map,this.dependents=new Map}}new j;class T{register(e){let t=e.type.id;this.validateConfig(e),this.sectionTypes.has(t)&&console.warn(`Section type '${t}' is already registered. Overwriting...`),this.sectionTypes.set(t,e.type),this.sectionConfigs.set(t,e),console.log(`Section type registered: ${t} (${e.type.name})`)}unregister(e){if(!this.sectionTypes.has(e))throw Error(`Section type '${e}' is not registered`);this.sectionTypes.delete(e),this.sectionConfigs.delete(e),console.log(`Section type unregistered: ${e}`)}getType(e){return this.sectionTypes.get(e)}getTypes(){return Array.from(this.sectionTypes.values())}getTypesByCategory(e){return Array.from(this.sectionTypes.values()).filter(t=>t.category===e)}getConfig(e){return this.sectionConfigs.get(e)}hasType(e){return this.sectionTypes.has(e)}createSection(e,t){let s=this.sectionTypes.get(e),r=this.sectionConfigs.get(e);if(!s||!r)return void console.error(`Section type '${e}' is not registered`);let i={type:e,...s.defaultSettings,...t},a=r.initializer?r.initializer(i):i;return{id:this.generateSectionId(),type:e,settings:a,order:0,isVisible:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),getVariableProducers:()=>[],getVariableConsumers:()=>[],validate:()=>r.validator?r.validator(a):{isValid:!0,errors:[],warnings:[]}}}validateConfig(e){if(this.validateTypeDefinition(e.type),!e.component)throw Error(`Section type '${e.type.id}' must have a component`);if(!e.type.version||!this.isValidVersion(e.type.version))throw Error(`Section type '${e.type.id}' must have a valid version`)}validateTypeDefinition(e){if(!e.id)throw Error("Section type ID is required");if(!e.name)throw Error("Section type name is required");if(!e.description)throw Error("Section type description is required");if(!e.icon)throw Error("Section type icon is required");if(!["input","content","logic","output"].includes(e.category))throw Error(`Invalid section category: ${e.category}`);if(!e.color)throw Error("Section type color is required")}isValidVersion(e){return/^\d+\.\d+\.\d+$/.test(e)}generateSectionId(){return`section_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}constructor(){this.sectionTypes=new Map,this.sectionConfigs=new Map}}new T;class A{addDependency(e,t){if(!e||!t)throw Error("Both dependent and dependency must be provided");if(e===t)throw Error("An item cannot depend on itself");if(this.wouldCreateCycle(e,t))throw Error(`Adding dependency '${e} -> ${t}' would create a circular dependency`);this.dependencies.has(e)||this.dependencies.set(e,new Set),this.dependencies.get(e).add(t),this.dependents.has(t)||this.dependents.set(t,new Set),this.dependents.get(t).add(e),this.invalidateTransitiveCache(),console.log(`Dependency added: ${e} -> ${t}`)}removeDependency(e,t){let s=this.dependencies.get(e);s&&(s.delete(t),0===s.size&&this.dependencies.delete(e));let r=this.dependents.get(t);r&&(r.delete(e),0===r.size&&this.dependents.delete(t)),this.invalidateTransitiveCache(),console.log(`Dependency removed: ${e} -> ${t}`)}getDependencies(e){return Array.from(this.dependencies.get(e)||[])}getDependents(e){return Array.from(this.dependents.get(e)||[])}getTransitiveDependencies(e){let t=this.transitiveDependenciesCache.get(e);if(t)return t;let s=new Set,r=[],i=e=>{if(!s.has(e))for(let t of(s.add(e),this.getDependencies(e)))r.includes(t)||r.push(t),i(t)};return i(e),this.transitiveDependenciesCache.set(e,r),r}hasCircularDependency(e){return this.findCycles().some(t=>t.includes(e))}getDependencyGraph(){let e=new Map;for(let[t,s]of this.dependencies.entries())e.set(t,Array.from(s));return e}getRemovalImpact(e){let t=new Set;this.getDependents(e).forEach(e=>t.add(e));let s=new Set,r=e=>{for(let i of this.getDependents(e))s.has(i)||(s.add(i),t.add(i),r(i))};return r(e),Array.from(t)}validateGraph(){let e=[],t=[],s=this.findCycles();s.length>0&&e.push(...s.map(e=>`Circular dependency detected: ${e.join(" -> ")}`));let r=new Set;for(let[e,t]of this.dependencies.entries())r.add(e),t.forEach(e=>r.add(e));for(let e of r){let s=this.dependencies.has(e),r=this.dependents.has(e);s||r||t.push(`Item '${e}' has no dependencies or dependents`)}let i=new Set;for(let e of this.getRootItems()){let t=this.getTransitiveDependencies(e);i.add(e),t.forEach(e=>i.add(e))}for(let e of r)i.has(e)||t.push(`Item '${e}' is not reachable from any root item`);return{isValid:0===e.length,errors:e,warnings:t}}getTopologicalOrder(){let e=this.getDependencyGraph(),t=new Set,s=new Set,r=[],i=a=>{if(s.has(a))throw Error(`Circular dependency detected involving: ${a}`);if(!t.has(a)){for(let t of(s.add(a),e.get(a)||[]))i(t);s.delete(a),t.add(a),r.unshift(a)}},a=new Set;for(let[t,s]of e.entries())a.add(t),s.forEach(e=>a.add(e));for(let e of a)t.has(e)||i(e);return r}clear(){this.dependencies.clear(),this.dependents.clear(),this.transitiveDependenciesCache.clear(),this.lastGraphVersion=0,console.log("Dependency tracker cleared")}getStatistics(){let e=new Set,t=0;for(let[s,r]of this.dependencies.entries())e.add(s),t+=r.size,r.forEach(t=>e.add(t));for(let[t]of this.dependents.entries())e.add(t);let s=Array.from(e).map(e=>this.dependencies.get(e)?.size||0),r=Array.from(e).filter(e=>0===(this.dependencies.get(e)?.size||0)).length,i=Array.from(e).filter(e=>0===(this.dependents.get(e)?.size||0)).length;return{totalItems:e.size,totalDependencies:t,averageDependencies:e.size>0?t/e.size:0,maxDependencies:Math.max(...s,0),rootItems:r,leafItems:i,cycles:this.findCycles().length}}wouldCreateCycle(e,t){return this.getTransitiveDependencies(t).includes(e)}findCycles(){let e=[],t=new Set,s=new Set,r=[],i=a=>{if(s.has(a)){let t=r.indexOf(a);if(t>=0){let s=r.slice(t).concat([a]);e.push(s)}return!0}if(t.has(a))return!1;for(let e of(t.add(a),s.add(a),r.push(a),this.dependencies.get(a)||new Set))i(e);return s.delete(a),r.pop(),!1},a=new Set;for(let[e,t]of this.dependencies.entries())a.add(e),t.forEach(e=>a.add(e));for(let e of a)t.has(e)||i(e);return e}getRootItems(){let e=new Set;for(let[t,s]of this.dependencies.entries())e.add(t),s.forEach(t=>e.add(t));return Array.from(e).filter(e=>0===(this.dependencies.get(e)?.size||0))}invalidateTransitiveCache(){this.transitiveDependenciesCache.clear(),this.lastGraphVersion++}constructor(){this.dependencies=new Map,this.dependents=new Map,this.transitiveDependenciesCache=new Map,this.lastGraphVersion=0}}let k=new A;class C{constructor(e={}){this.config={stopOnFirstError:!1,async:!1,...e}}getErrorMessage(e){return this.config.message||`Validation failed for value: ${e}`}isAsync(){return!0===this.config.async}}class V extends C{constructor(e={}){super(e),this.validators=[]}addValidator(e){return this.validators.push(e),e.isAsync()&&(this.config.async=!0),this}addValidators(e){return e.forEach(e=>this.addValidator(e)),this}async validate(e,t){for(let s of this.validators){let r=await s.validate(e,t);if(!r&&this.config.stopOnFirstError||!r)return!1}return!0}async validateWithDetails(e,t){let s=[];for(let r of this.validators)try{if(!await r.validate(e,t)&&(s.push(r.getErrorMessage(e)),this.config.stopOnFirstError))break}catch(e){s.push(`Validation error: ${e}`)}return{isValid:0===s.length,errors:s,warnings:[]}}}class $ extends C{constructor(e,t,s={}){super(s),this.minLength=e,this.maxLength=t}validate(e){return"string"==typeof e&&(void 0===this.minLength||!(e.length<this.minLength))&&(void 0===this.maxLength||!(e.length>this.maxLength))}getErrorMessage(e){if(this.config.message)return this.config.message;let t="string"==typeof e?e.length:"N/A";return`String length ${t} is not between ${this.minLength||0} and ${this.maxLength||"∞"}`}}class M extends C{constructor(e,t,s={}){super(s),this.min=e,this.max=t}validate(e){return!("number"!=typeof e||isNaN(e))&&(void 0===this.min||!(e<this.min))&&(void 0===this.max||!(e>this.max))}getErrorMessage(e){return this.config.message?this.config.message:`Number ${e} is not between ${this.min||"-∞"} and ${this.max||"∞"}`}}class D extends C{constructor(e,t={}){super(t),this.regex="string"==typeof e?new RegExp(e):e}validate(e){return"string"==typeof e&&this.regex.test(e)}getErrorMessage(e){return this.config.message?this.config.message:`Value "${e}" does not match required pattern`}}class I extends C{constructor(e,t={}){super(t),this.validatorFn=e}async validate(e,t){try{let s=this.validatorFn(e,t);return s instanceof Promise?await s:s}catch(e){return console.error("Custom validator error:",e),!1}}}class R extends C{constructor(e,t,s,r={}){super(r),this.itemValidator=e,this.minItems=t,this.maxItems=s}async validate(e,t){if(!Array.isArray(e)||void 0!==this.minItems&&e.length<this.minItems||void 0!==this.maxItems&&e.length>this.maxItems)return!1;if(this.itemValidator){for(let s of e)if(!await this.itemValidator.validate(s,t))return!1}return!0}getErrorMessage(e){if(this.config.message)return this.config.message;let t=Array.isArray(e)?e.length:"N/A";return`Array length ${t} is not between ${this.minItems||0} and ${this.maxItems||"∞"}`}}class P{registerValidator(e,t){this.validators.set(e,t)}registerSchema(e,t){this.schemas.set(e,t);let s=this.createValidatorFromSchema(t);this.validators.set(e,s)}addCrossVariableValidator(e){this.crossVariableValidators.push(e)}async validateVariable(e,t,s){let r=this.validators.get(e);return r?await r.validateWithDetails(t,s):{isValid:!0,errors:[],warnings:[]}}async validateVariables(e,t){let s=[],r=[];for(let[i,a]of Object.entries(e)){let e=await this.validateVariable(i,a,t);s.push(...e.errors),r.push(...e.warnings)}for(let r of this.crossVariableValidators)try{let i=r.variables.reduce((t,s)=>(s in e&&(t[s]=e[s]),t),{});Object.keys(i).length===r.variables.length&&(await r.validator(i,t)||s.push(r.message||`Cross-variable validation failed: ${r.name}`))}catch(e){s.push(`Cross-variable validation error: ${e}`)}return{isValid:0===s.length,errors:s,warnings:r}}createValidatorFromSchema(e){let t=new V;return t.addValidator(new I(t=>this.validateType(t,e.type),{message:`Expected type ${e.type}`})),e.validators&&t.addValidators(e.validators),t}validateType(e,t){switch(t){case"string":return"string"==typeof e;case"number":return"number"==typeof e&&!isNaN(e);case"boolean":return"boolean"==typeof e;case"array":return Array.isArray(e);case"object":return"object"==typeof e&&null!==e&&!Array.isArray(e);case"date":return e instanceof Date||!isNaN(Date.parse(e));case"email":return"string"==typeof e&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);case"phone":return"string"==typeof e&&/^[\+]?[1-9][\d]{0,15}$/.test(e.replace(/[\s\-\(\)]/g,""));case"url":try{return new URL(e),!0}catch{return!1}default:return!1}}constructor(){this.validators=new Map,this.crossVariableValidators=[],this.schemas=new Map}}let _=new P;class O{createSession(e){let t=this.generateSessionId(),s={sessionId:t,userId:e,startTime:new Date,responses:{},metadata:{}};return this.sessions.set(t,s),s}getSession(e){return this.sessions.get(e)}updateSession(e,t){let s=this.sessions.get(e);s&&Object.assign(s,t)}deleteSession(e){this.sessions.delete(e)}addResponse(e,t,s){let r=this.sessions.get(e);r&&(r.responses[t]=s)}setLeadData(e,t){let s=this.sessions.get(e);s&&(s.leadData=t)}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}constructor(){this.sessions=new Map}}class z{constructor(e,t){this.variableRegistry=e,this.context=t,this.cache=new Map,this.resolving=new Set}async resolveVariable(e){if(this.cache.has(e))return this.cache.get(e);if(this.resolving.has(e))throw Error(`Circular dependency detected while resolving variable: ${e}`);this.resolving.add(e);try{let t=this.variableRegistry.getVariable(e);if(!t)throw Error(`Variable '${e}' is not registered`);let s=this.variableRegistry.getValue(e);void 0===s&&(s=await this.resolveFromDependencies(e)),void 0===s&&(s=t.defaultValue);let r=await _.validateVariable(e,s,this.context);if(!r.isValid)throw Error(`Variable validation failed: ${r.errors.join(", ")}`);return this.cache.set(e,s),s}finally{this.resolving.delete(e)}}async resolveVariables(e){let t={};for(let s of this.getResolutionOrder(e))try{t[s]=await this.resolveVariable(s)}catch(e){console.error(`Failed to resolve variable ${s}:`,e)}return t}clearCache(){this.cache.clear()}invalidateVariable(e){for(let t of(this.cache.delete(e),k.getDependents(e)))this.cache.delete(t)}async resolveFromDependencies(e){let t=k.getDependencies(e),s={};for(let e of t)s[e]=await this.resolveVariable(e)}getResolutionOrder(e){try{let t=k.getTopologicalOrder();return e.sort((e,s)=>{let r=t.indexOf(e),i=t.indexOf(s);return(-1===r?1/0:r)-(-1===i?1/0:i)})}catch(t){return console.warn("Failed to get topological order, using original order:",t),e}}}class L{constructor(e){this.context=e,this.isRunning=!1,this.resolver=new z(e.variables,e),this.metrics=e.metrics}async executeSection(e){let t=Date.now();try{this.recordSectionStart(e);let s=this.context.variables.getVariablesBySource(e),r=new Set;for(let e of s)k.getDependencies(e.id).forEach(e=>r.add(e));r.size>0&&await this.resolver.resolveVariables(Array.from(r));let i=Date.now()-t;this.recordSectionCompletion(e,i)}catch(r){let s=Date.now()-t;throw this.recordSectionError(e,s,r),r}}async populateVariable(e,t){let s=Date.now();try{let r=await _.validateVariable(e,t,this.context);if(!r.isValid)throw Error(`Variable validation failed: ${r.errors.join(", ")}`);this.context.variables.setValue(e,t),this.resolver.invalidateVariable(e);let i=Date.now()-s;this.metrics.variableLookupTimes[e]=i}catch(t){throw console.error(`Failed to populate variable ${e}:`,t),t}}async resolveVariable(e){let t=Date.now();try{let s=await this.resolver.resolveVariable(e),r=Date.now()-t;return this.metrics.variableLookupTimes[e]=r,s}catch(t){throw console.error(`Failed to resolve variable ${e}:`,t),t}}getMetrics(){return{...this.metrics}}reset(){this.resolver.clearCache(),this.isRunning=!1,this.context.executionHistory=[],this.resetMetrics()}recordSectionStart(e){this.context.currentSection=e}recordSectionCompletion(e,t){let s={sectionId:e,timestamp:new Date,variablesProduced:{},duration:t};this.context.executionHistory.push(s),this.metrics.sectionRenderTimes[e]=t,this.metrics.totalTime+=t}recordSectionError(e,t,s){let r={sectionId:e,timestamp:new Date,variablesProduced:{},duration:t,errors:[s.message]};this.context.executionHistory.push(r),this.metrics.sectionRenderTimes[e]=t,this.metrics.totalTime+=t}resetMetrics(){this.metrics.totalTime=0,this.metrics.variableLookupTimes={},this.metrics.sectionRenderTimes={},this.metrics.memoryUsage={variableCount:0,totalVariableSize:0,cacheHitRate:0}}}new O;class U{constructor(e){this.input=e,this.position=0,this.line=1,this.column=1}tokenize(){let e=[];for(this.position=0,this.line=1,this.column=1;this.position<this.input.length;){let t=this.nextToken();t&&e.push(t)}return e.push({type:"EOF",value:"",position:{start:this.position,end:this.position}}),e}nextToken(){if(this.skipWhitespace(),this.position>=this.input.length)return null;this.position;let e=this.currentChar();switch(e){case"@":return this.createToken("AT",this.advance());case".":return this.createToken("DOT",this.advance());case"|":return this.createToken("PIPE",this.advance());case":":return this.createToken("COLON",this.advance());case"?":return this.createToken("QUESTION",this.advance());case"!":return this.createToken("EXCLAMATION",this.advance());case"(":return this.createToken("LPAREN",this.advance());case")":return this.createToken("RPAREN",this.advance());case"{":return this.createToken("LBRACE",this.advance());case"}":return this.createToken("RBRACE",this.advance());case",":return this.createToken("COMMA",this.advance())}return'"'===e||"'"===e?this.tokenizeString(e):this.isDigit(e)?this.tokenizeNumber():this.isAlpha(e)||"_"===e?this.tokenizeIdentifier():this.createToken("UNKNOWN",this.advance())}tokenizeString(e){let t=this.position;this.advance();let s="",r=!1;for(;this.position<this.input.length;){let t=this.currentChar();if(r)s+=t,r=!1;else if("\\"===t)r=!0;else if(t===e){this.advance();break}else s+=t;this.advance()}return{type:"STRING",value:s,position:{start:t,end:this.position}}}tokenizeNumber(){let e=this.position,t="",s=!1;for(;this.position<this.input.length;){let e=this.currentChar();if(this.isDigit(e))t+=e,this.advance();else if("."!==e||s)break;else s=!0,t+=e,this.advance()}return{type:"NUMBER",value:t,position:{start:e,end:this.position}}}tokenizeIdentifier(){let e=this.position,t="";for(;this.position<this.input.length;){let e=this.currentChar();if(this.isAlphaNumeric(e)||"_"===e)t+=e,this.advance();else break}let s="IDENTIFIER";switch(t.toLowerCase()){case"if":s="IF";break;case"then":s="THEN";break;case"else":s="ELSE";break;case"true":case"false":s="BOOLEAN"}return{type:s,value:t,position:{start:e,end:this.position}}}skipWhitespace(){for(;this.position<this.input.length&&this.isWhitespace(this.currentChar());)"\n"===this.currentChar()?(this.line++,this.column=1):this.column++,this.position++}currentChar(){return this.input[this.position]||""}advance(){let e=this.currentChar();return this.position++,this.column++,e}createToken(e,t){return{type:e,value:t,position:{start:this.position-t.length,end:this.position}}}isWhitespace(e){return/\s/.test(e)}isDigit(e){return/\d/.test(e)}isAlpha(e){return/[a-zA-Z]/.test(e)}isAlphaNumeric(e){return/[a-zA-Z0-9]/.test(e)}}class q{parse(e){let t,s=[],r=new Set;this.errors=[];let i=/@\{[^}]*\}|@[a-zA-Z_][a-zA-Z0-9_]*/g;for(;null!==(t=i.exec(e));)try{let e=t[0],i={start:t.index,end:t.index+e.length},a=this.parseInterpolationExpression(e,i.start),n={type:"interpolation",expression:a,rawText:e,position:i};s.push(n),this.extractDependencies(a,r)}catch(e){this.addError(`Failed to parse interpolation: ${e}`,{start:t.index,end:t.index+t[0].length},"error")}return{success:0===this.errors.filter(e=>"error"===e.severity).length,interpolations:s,dependencies:Array.from(r),errors:this.errors,originalText:e}}parseInterpolationExpression(e,t){let s=e.slice(1);s.startsWith("{")&&s.endsWith("}")&&(s=s.slice(1,-1));let r=new U(s);return this.tokens=r.tokenize(),this.position=0,this.parseExpression()}parseExpression(){return this.parseConditional()}parseConditional(){let e=this.parsePipe();if(this.match("QUESTION")){let t,s=this.parseExpression();this.match("COLON")&&(t=this.parseExpression());let r=e.position.start,i=t?t.position.end:s.position.end;return{type:"conditional",condition:e,thenBranch:s,elseBranch:t,position:{start:r,end:i}}}return e}parsePipe(){let e=this.parseFunction();for(;this.match("PIPE");){let t=this.consume("IDENTIFIER","Expected function name after pipe"),s=[e];this.match("LPAREN")&&(s.push(...this.parseArgumentList()),this.consume("RPAREN","Expected closing parenthesis"));let r=e.position.start,i=this.previous().position.end;e={type:"function",name:t.value,arguments:s,position:{start:r,end:i}}}return e}parseFunction(){return this.parsePrimary()}parsePrimary(){let e=this.peek();if(this.match("IDENTIFIER")){let e=this.previous().value,t=this.previous().position.start,s=this.previous().position.end;if(this.match("LPAREN")){let r=this.parseArgumentList();return this.consume("RPAREN","Expected closing parenthesis"),{type:"function",name:e,arguments:r,position:{start:t,end:s=this.previous().position.end}}}return{type:"variable",name:e,position:{start:t,end:s}}}if(this.match("STRING"))return{type:"literal",value:this.previous().value,position:this.previous().position};if(this.match("NUMBER"))return{type:"literal",value:parseFloat(this.previous().value),position:this.previous().position};if(this.match("BOOLEAN"))return{type:"literal",value:"true"===this.previous().value,position:this.previous().position};if(this.match("LPAREN")){let e=this.parseExpression();return this.consume("RPAREN","Expected closing parenthesis"),e}throw Error(`Unexpected token: ${e.type}`)}parseArgumentList(){let e=[];if(!this.check("RPAREN"))do e.push(this.parseExpression());while(this.match("COMMA"));return e}extractDependencies(e,t){switch(e.type){case"variable":t.add(e.name);break;case"conditional":this.extractDependencies(e.condition,t),this.extractDependencies(e.thenBranch,t),e.elseBranch&&this.extractDependencies(e.elseBranch,t);break;case"function":e.arguments.forEach(e=>this.extractDependencies(e,t))}}match(...e){for(let t of e)if(this.check(t))return this.advance(),!0;return!1}check(e){return!this.isAtEnd()&&this.peek().type===e}advance(){return!this.isAtEnd()&&this.position++,this.previous()}isAtEnd(){return"EOF"===this.peek().type}peek(){return this.tokens[this.position]||this.tokens[this.tokens.length-1]}previous(){return this.tokens[this.position-1]}consume(e,t){if(this.check(e))return this.advance();let s=this.peek();throw this.addError(t,s.position,"error"),Error(t)}addError(e,t,s){this.errors.push({message:e,position:t,severity:s})}constructor(){this.tokens=[],this.position=0,this.errors=[]}}function F(e){return new q().parse(e)}class B{constructor(){this.resolutionCache=new Map,this.strategies=new Map,this.dependencyTracker=k,this.initializeDefaultStrategies()}async analyzeAndRegisterDependencies(e,t,s){let r=[],i=[];try{let s=F(t);for(let t of(s.success||r.push(...s.errors.map(e=>e.message)),s.dependencies))try{this.dependencyTracker.addDependency(e,t)}catch(s){s instanceof Error&&s.message.includes("circular")?r.push(`Circular dependency detected: ${e} -> ${t}`):r.push(`Failed to register dependency: ${s}`)}let a=this.dependencyTracker.validateGraph();return r.push(...a.errors),i.push(...a.warnings),{isValid:0===r.length,errors:r,warnings:i}}catch(e){return{isValid:!1,errors:[`Failed to analyze dependencies: ${e}`],warnings:i}}}createExecutionPlan(e){try{let t=this.dependencyTracker.getTopologicalOrder(),s=new Set;for(let t of e)s.add(t),this.dependencyTracker.getTransitiveDependencies(t).forEach(e=>s.add(e));let r=t.filter(e=>s.has(e)),i=this.createBatchGroups(r),a=this.estimateExecutionTime(r);return this.executionPlan={executionOrder:r,batchGroups:i,estimatedTime:a,parallelizable:i.length>1},this.executionPlan}catch(t){return console.error("Failed to create execution plan:",t),{executionOrder:e,batchGroups:[e],estimatedTime:100*e.length,parallelizable:!1}}}async resolveVariable(e,t,s="default"){let r=Date.now();try{let i=this.resolutionCache.get(e);if(i&&this.isCacheValid(i))return{...i,executionTimeMs:Date.now()-r};let a=this.strategies.get(s);if(!a)throw Error(`Unknown resolution strategy: ${s}`);let n=this.dependencyTracker.getDependencies(e),o={};for(let e of n){let r=await this.resolveVariable(e,t,s);if(!r.success)throw Error(`Failed to resolve dependency '${e}': ${r.error}`);o[e]=r.value}let l=await a.resolve(e,t),c={success:!0,value:l,dependencies:n,executionTimeMs:Date.now()-r};return this.resolutionCache.set(e,c),c}catch(t){return{success:!1,error:t instanceof Error?t.message:String(t),dependencies:this.dependencyTracker.getDependencies(e),executionTimeMs:Date.now()-r}}}async resolveVariables(e,t,s="default"){let r={};for(let i of this.createExecutionPlan(e).batchGroups){let e=i.map(async e=>{let r=await this.resolveVariable(e,t,s);return{variableId:e,result:r}});for(let t of(await Promise.allSettled(e)))if("fulfilled"===t.status){let{variableId:e,result:s}=t.value;r[e]=s}else console.error("Batch resolution failed:",t.reason)}return r}getDependencyGraph(){let e=new Map,t=new Map,s=this.dependencyTracker.getDependencyGraph(),r=new Set;for(let[e,i]of s.entries())r.add(e),i.forEach(e=>r.add(e)),t.set(e,i);let i=0;for(let t of r){let s=this.dependencyTracker.getDependencies(t),r=this.dependencyTracker.getDependents(t);e.set(t,{id:t,type:this.inferNodeType(t),dependencies:s,dependents:r,resolved:this.resolutionCache.has(t),lastResolvedAt:this.resolutionCache.get(t)?new Date:void 0,cachedValue:this.resolutionCache.get(t)?.value,executionOrder:i++,interpolations:[]})}return{nodes:e,edges:t,roots:Array.from(r).filter(e=>0===this.dependencyTracker.getDependencies(e).length),leaves:Array.from(r).filter(e=>0===this.dependencyTracker.getDependents(e).length)}}invalidateCache(e){for(let t of(this.resolutionCache.delete(e),this.dependencyTracker.getDependents(e)))this.invalidateCache(t)}reset(){this.resolutionCache.clear(),this.executionPlan=void 0}getStatistics(){let e=Array.from(this.resolutionCache.values()),t=e.filter(e=>e.success);return{cachedVariables:this.resolutionCache.size,totalResolutions:e.length,averageResolutionTime:t.length>0?t.reduce((e,t)=>e+t.executionTimeMs,0)/t.length:0,cacheHitRate:e.length>0?t.length/e.length:0,dependencyGraphStats:this.dependencyTracker.getStatistics()}}initializeDefaultStrategies(){this.strategies.set("default",{name:"default",description:"Resolve from variable registry",resolve:async(e,t)=>{let s=t.variables.getValue(e);if(void 0===s){let s=t.variables.getVariable(e);return s?.defaultValue}return s}}),this.strategies.set("lazy",{name:"lazy",description:"Resolve only when explicitly requested",resolve:async(e,t)=>t.variables.getValue(e)}),this.strategies.set("eager",{name:"eager",description:"Pre-resolve all dependencies",resolve:async(e,t)=>t.variables.getValue(e)})}createBatchGroups(e){let t=[],s=new Set;for(;s.size<e.length;){let r=[];for(let t of e)!s.has(t)&&this.dependencyTracker.getDependencies(t).every(e=>s.has(e))&&(r.push(t),s.add(t));if(0===r.length)break;t.push(r)}return t}estimateExecutionTime(e){return 50+25*e.length}isCacheValid(e){return e.success&&Date.now()-e.executionTimeMs<6e4}inferNodeType(e){return e.includes(".")?"computed":e.startsWith("section_")?"section":"variable"}}new B;class G{constructor(){this.functions=new Map,this.initializeBuiltinFunctions()}async evaluateExpression(e,t){let s=Date.now(),r=[];try{let i=await this.evaluateNode(e,t,r);return{success:!0,value:i,usedVariables:r,executionTime:Date.now()-s}}catch(e){return{success:!1,value:void 0,error:e instanceof Error?e.message:String(e),usedVariables:r,executionTime:Date.now()-s}}}async evaluateText(e,t){let s=Date.now(),r=[];try{let i=F(e);if(!i.success)throw Error(`Parse error: ${i.errors.map(e=>e.message).join(", ")}`);let a=e;for(let e of i.interpolations){let s=await this.evaluateExpression(e.expression,t);if(!s.success)throw Error(`Evaluation error in '${e.rawText}': ${s.error}`);r.push(...s.usedVariables);let i=this.formatValue(s.value);a=a.replace(e.rawText,i)}return{success:!0,value:a,usedVariables:Array.from(new Set(r)),executionTime:Date.now()-s}}catch(t){return{success:!1,value:e,error:t instanceof Error?t.message:String(t),usedVariables:r,executionTime:Date.now()-s}}}registerFunction(e,t){this.functions.set(e,t)}async evaluateNode(e,t,s){switch(e.type){case"variable":return this.evaluateVariable(e.name,t,s);case"literal":return e.value;case"function":return this.evaluateFunction(e,t,s);case"conditional":return this.evaluateConditional(e,t,s);default:throw Error(`Unknown expression type: ${e.type}`)}}evaluateVariable(e,t,s){s.push(e);let r=e.split("."),i=t.variables[r[0]];for(let e=1;e<r.length&&void 0!==i;e++)i=i[r[e]];return i}async evaluateFunction(e,t,s){let r=this.functions.get(e.name)||t.functions[e.name];if(!r)throw Error(`Unknown function: ${e.name}`);let i=[];for(let r of e.arguments){let e=await this.evaluateNode(r,t,s);i.push(e)}return this.executeFunctionSafely(r,i)}async evaluateConditional(e,t,s){let r=await this.evaluateNode(e.condition,t,s);return this.isTruthy(r)?this.evaluateNode(e.thenBranch,t,s):e.elseBranch?this.evaluateNode(e.elseBranch,t,s):void 0}executeFunctionSafely(e,t){try{return e.apply(null,t)}catch(e){throw Error(`Function execution failed: ${e}`)}}isTruthy(e){return null!=e&&!1!==e&&("number"==typeof e?0!==e&&!isNaN(e):"string"==typeof e||Array.isArray(e)?e.length>0:"object"==typeof e?Object.keys(e).length>0:!!e)}formatValue(e){return null==e?"":"string"==typeof e?e:"number"==typeof e?e.toString():"boolean"==typeof e?e?"true":"false":Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):String(e)}initializeBuiltinFunctions(){this.functions.set("upper",e=>String(e).toUpperCase()),this.functions.set("lower",e=>String(e).toLowerCase()),this.functions.set("trim",e=>String(e).trim()),this.functions.set("length",e=>String(e).length),this.functions.set("substring",(e,t,s)=>String(e).substring(t,s)),this.functions.set("round",e=>Math.round(Number(e))),this.functions.set("floor",e=>Math.floor(Number(e))),this.functions.set("ceil",e=>Math.ceil(Number(e))),this.functions.set("abs",e=>Math.abs(Number(e))),this.functions.set("join",(e,t=",")=>Array.isArray(e)?e.join(t):String(e)),this.functions.set("first",e=>Array.isArray(e)?e[0]:void 0),this.functions.set("last",e=>Array.isArray(e)?e[e.length-1]:void 0),this.functions.set("now",()=>new Date),this.functions.set("formatDate",(e,t="YYYY-MM-DD")=>new Date(e).toISOString().split("T")[0]),this.functions.set("toString",e=>String(e)),this.functions.set("toNumber",e=>Number(e)),this.functions.set("toBoolean",e=>!!e),this.functions.set("ifEmpty",(e,t)=>null==e||""===e?t:e),this.functions.set("ifNull",(e,t)=>null==e?t:e)}}class H{registerComponent(e){this.components.set(e.id,e)}unregisterComponent(e){for(let[t,s]of(this.components.delete(e),this.subscriptions.entries()))s.delete(e),0===s.size&&this.subscriptions.delete(t)}subscribeToVariable(e,t){this.subscriptions.has(t)||this.subscriptions.set(t,new Set),this.subscriptions.get(t).add(e)}notifyVariableUpdate(e,t){let s=this.subscriptions.get(e);if(s)for(let r of s){let s=this.components.get(r);if(s?.onVariableUpdate)try{s.onVariableUpdate(e,t)}catch(e){console.error(`Error notifying component ${r}:`,e),s.onError&&s.onError(e)}}}getAIComponents(){return Array.from(this.components.values()).filter(e=>e.requiresAI)}getAllComponents(){return Array.from(this.components.values())}constructor(){this.components=new Map,this.subscriptions=new Map}}class W{async executeLogicSection(e,t){try{let s={};for(let r of e.inputVariables)s[r]=t.variables.getValue(r);let r=await this.substituteVariables(e.prompt,s),i=await this.callAIAPI(e,r);return e.outputVariable&&t.variables.setValue(e.outputVariable,i),i}catch(e){throw console.error("Logic section execution failed:",e),e}}async substituteVariables(e,t){let s=new G,r=await s.evaluateText(e,{variables:t,functions:{},session:{},metadata:{}});if(!r.success)throw Error(`Prompt variable substitution failed: ${r.error}`);return r.value}async callAIAPI(e,t){return console.log(`AI API call to ${e.modelId}:`,t),`AI response for prompt: ${t.substring(0,50)}...`}}class Y{constructor(e){this.context=e,this.baseEngine=new L(e),this.evaluator=new G,this.componentManager=new H,this.logicProcessor=new W}async resolveVariableWithExpression(e,t){if(!t)return this.baseEngine.resolveVariable(e);try{let s={variables:this.getAllVariableValues(),functions:{},session:this.context.session.responses,metadata:this.context.session.metadata||{}},r=await this.evaluator.evaluateText(t,s);if(!r.success)throw Error(`Expression evaluation failed: ${r.error}`);return await this.populateVariable(e,r.value),r.value}catch(t){throw console.error(`Enhanced variable resolution failed for ${e}:`,t),t}}async processInterpolatedText(e){let t={variables:this.getAllVariableValues(),functions:{},session:this.context.session.responses,metadata:this.context.session.metadata||{}},s=await this.evaluator.evaluateText(e,t);return s.success?s.value:(console.warn(`Text interpolation failed: ${s.error}`),e)}async executeLogicSection(e){let t=Date.now();try{this.context.currentSection=`logic_${e.outputVariable}`;let s=await this.logicProcessor.executeLogicSection(e,this.context);this.componentManager.notifyVariableUpdate(e.outputVariable,s);let r=Date.now()-t;return this.updateMetrics(`logic_${e.outputVariable}`,r),s}catch(r){let s=Date.now()-t;throw this.recordError(`logic_${e.outputVariable}`,s,r),r}}registerComponent(e){this.componentManager.registerComponent(e)}subscribeComponentToVariable(e,t){this.componentManager.subscribeToVariable(e,t)}async populateVariable(e,t){await this.baseEngine.populateVariable(e,t),this.componentManager.notifyVariableUpdate(e,t)}registerExpressionFunction(e,t){this.evaluator.registerFunction(e,t)}async executeMultipleLogicSections(e){let t={};for(let s of e)try{t[s.outputVariable]=await this.executeLogicSection(s)}catch(e){console.error(`Logic section failed for ${s.outputVariable}:`,e),t[s.outputVariable]=null}return t}async executeSection(e){return this.baseEngine.executeSection(e)}async resolveVariable(e){return this.baseEngine.resolveVariable(e)}getMetrics(){return this.baseEngine.getMetrics()}reset(){this.baseEngine.reset(),this.componentManager=new H}getAllVariableValues(){let e={};for(let t of this.context.variables.getAllVariables())e[t.id]=this.context.variables.getValue(t.id);return e}updateMetrics(e,t){this.context.metrics.sectionRenderTimes[e]=t,this.context.metrics.totalTime+=t}recordError(e,t,s){console.error(`Section ${e} failed after ${t}ms:`,s),this.context.metrics.sectionRenderTimes[e]=t,this.context.metrics.totalTime+=t}}new G,new H,new W;class X{constructor(e,t=3e5){this.maxSize=e,this.defaultTTL=t,this.cache=new Map,this.accessOrder=new Map,this.accessCounter=0}set(e,t,s,r=[]){let i=Date.now(),a=s||this.defaultTTL;this.cleanup(),this.cache.size>=this.maxSize&&!this.cache.has(e)&&this.evictLRU();let n={value:t,key:e,timestamp:i,ttl:a,size:this.estimateSize(t),accessCount:1,lastAccess:i,dependencies:r,tier:"memory"};this.cache.set(e,n),this.accessOrder.set(e,++this.accessCounter)}get(e){let t=this.cache.get(e);if(t){if(Date.now()-t.timestamp>t.ttl){this.cache.delete(e),this.accessOrder.delete(e);return}return t.accessCount++,t.lastAccess=Date.now(),this.accessOrder.set(e,++this.accessCounter),t.value}}has(e){let t=this.cache.get(e);return!!t&&(!(Date.now()-t.timestamp>t.ttl)||(this.cache.delete(e),this.accessOrder.delete(e),!1))}delete(e){return this.accessOrder.delete(e),this.cache.delete(e)}clear(){this.cache.clear(),this.accessOrder.clear(),this.accessCounter=0}size(){return this.cache.size}getStats(){let e=0,t=0;for(let s of this.cache.values())e+=s.size,s.accessCount,t+=s.accessCount;return{hitRate:0,missRate:0,totalHits:t,totalMisses:0,memoryUsage:e,itemCount:this.cache.size,averageAccessTime:0,efficiencyScore:0}}invalidateByDependencies(e){let t=[];for(let[s,r]of this.cache.entries())r.dependencies.some(t=>e.includes(t))&&(this.delete(s),t.push(s));return t}cleanup(){let e=Date.now(),t=[];for(let[s,r]of this.cache.entries())e-r.timestamp>r.ttl&&t.push(s);for(let e of t)this.delete(e)}evictLRU(){let e,t=1/0;for(let[s,r]of this.accessOrder.entries())r<t&&(t=r,e=s);e&&this.delete(e)}estimateSize(e){if("string"==typeof e)return 2*e.length;if("number"==typeof e)return 8;if("boolean"==typeof e)return 4;if(null==e);else if(Array.isArray(e))return e.reduce((e,t)=>e+this.estimateSize(t),0);else if("object"==typeof e)return 2*JSON.stringify(e).length;return 0}}class J{constructor(e={}){this.sessionCache=new Map,this.config={maxMemoryUsage:0x3200000,defaultTTL:3e5,maxItems:1e4,layers:{memory:!0,session:!0,persistent:!1},variablePolicies:{},...e},this.memoryCache=new X(this.config.maxItems,this.config.defaultTTL),this.performanceMetrics=this.initializeMetrics(),this.cacheStats=this.initializeStats()}get(e){let t=Date.now();try{if(this.config.layers.memory){let s=this.memoryCache.get(e);if(void 0!==s)return this.recordCacheHit("memory",Date.now()-t),s}if(this.config.layers.session){let s=this.sessionCache.get(e);if(void 0!==s)return this.memoryCache.set(e,s),this.recordCacheHit("session",Date.now()-t),s}this.recordCacheMiss(Date.now()-t);return}catch(e){console.error("Cache get error:",e),this.recordCacheMiss(Date.now()-t);return}}set(e,t,s={}){let{ttl:r,dependencies:i=[],policy:a,tiers:n=["memory"]}=s,o=r||this.getTTLForPolicy(a);for(let s of n)switch(s){case"memory":this.config.layers.memory&&this.memoryCache.set(e,t,o,i);break;case"session":this.config.layers.session&&this.sessionCache.set(e,t)}}invalidateByVariable(e){Date.now();try{let t=k.getDependents(e),s=[e,...t],r=this.memoryCache.invalidateByDependencies(s);for(let e of this.sessionCache.keys())s.some(t=>e.includes(t))&&(this.sessionCache.delete(e),r.push(e));console.log(`Invalidated ${r.length} cache entries for variable ${e}`)}catch(e){console.error("Cache invalidation error:",e)}}getStats(){let e=this.memoryCache.getStats();return{...this.cacheStats,memoryUsage:e.memoryUsage,itemCount:e.itemCount+this.sessionCache.size}}getPerformanceMetrics(){return{...this.performanceMetrics}}clear(){this.memoryCache.clear(),this.sessionCache.clear(),this.cacheStats=this.initializeStats()}optimize(){let e=this.getStats();e.hitRate<.5&&console.log("Low cache hit rate detected, optimizing TTL policies"),e.memoryUsage>.8*this.config.maxMemoryUsage&&(console.log("High memory usage detected, triggering cleanup"),this.cleanup())}getTTLForPolicy(e){return e&&this.config.variablePolicies[e]?this.config.variablePolicies[e].ttl:this.config.defaultTTL}recordCacheHit(e,t){this.cacheStats.totalHits++,this.updateHitRate()}recordCacheMiss(e){this.cacheStats.totalMisses++,this.updateHitRate()}updateHitRate(){let e=this.cacheStats.totalHits+this.cacheStats.totalMisses;this.cacheStats.hitRate=e>0?this.cacheStats.totalHits/e:0,this.cacheStats.missRate=e>0?this.cacheStats.totalMisses/e:0}cleanup(){}initializeMetrics(){return{variableResolutionTimes:{},expressionEvaluationTimes:{},aiApiCallTimes:{},stringInterpolationTimes:[],memorySnapshots:[],bottlenecks:[]}}initializeStats(){return{hitRate:0,missRate:0,totalHits:0,totalMisses:0,memoryUsage:0,itemCount:0,averageAccessTime:0,efficiencyScore:0}}}class Z{memoize(e,t,s){let r=this.cache;return(...i)=>{let a=t?t(...i):JSON.stringify(i),n=r.get(a);if(void 0!==n)return n;let o=e(...i);return r.set(a,o,void 0,s),o}}clear(){this.cache.clear()}invalidateByDependencies(e){this.cache.invalidateByDependencies(e)}constructor(){this.cache=new X(1e3)}}class K{generateKey(e,t,s,r){let i={modelId:e,prompt:t.substring(0,1e3),temperature:s||.7,maxTokens:r||1e3};return`ai_${Buffer.from(JSON.stringify(i)).toString("base64").substring(0,32)}`}get(e,t,s,r){let i=this.generateKey(e,t,s,r);return this.cache.get(i)}set(e,t,s,r,i,a){let n=this.generateKey(e,t,r,i);this.cache.set(n,s,a)}clear(){this.cache.clear()}getStats(){return this.cache.getStats()}constructor(){this.cache=new X(500,36e5)}}class Q{intern(e){if(this.internedStrings.has(e)){let t=this.internedStrings.get(e);return this.usageCount.set(e,(this.usageCount.get(e)||0)+1),t}return this.internedStrings.set(e,e),this.usageCount.set(e,1),e}isInterned(e){return this.internedStrings.has(e)}getMemorySavings(){let e=0;for(let[t,s]of this.usageCount.entries())s>1&&(e+=2*t.length*(s-1));return e}cleanup(e=2){for(let[t,s]of this.usageCount.entries())s<e&&(this.internedStrings.delete(t),this.usageCount.delete(t))}constructor(){this.internedStrings=new Map,this.usageCount=new Map}}class ee{constructor(){this.activeOperations=new Map,this.metrics={variableResolutionTimes:{},expressionEvaluationTimes:{},aiApiCallTimes:{},stringInterpolationTimes:[],memorySnapshots:[],bottlenecks:[]}}startOperation(e){this.activeOperations.set(e,Date.now())}endOperation(e,t){let s=this.activeOperations.get(e);if(!s)return 0;let r=Date.now()-s;switch(this.activeOperations.delete(e),t){case"variableResolutionTimes":case"expressionEvaluationTimes":case"aiApiCallTimes":this.metrics[t][e]||(this.metrics[t][e]=[]),this.metrics[t][e].push(r);break;case"stringInterpolationTimes":this.metrics.stringInterpolationTimes.push(r)}return r}recordMemorySnapshot(){if("undefined"!=typeof process&&process.memoryUsage){let e=process.memoryUsage();this.metrics.memorySnapshots.push({timestamp:Date.now(),usage:e.heapUsed})}}detectBottlenecks(e=100){for(let[t,s]of(this.metrics.bottlenecks=[],Object.entries(this.metrics.variableResolutionTimes))){let r=s.reduce((e,t)=>e+t,0)/s.length;r>e&&this.metrics.bottlenecks.push({operation:`Variable: ${t}`,avgTime:r,frequency:s.length})}this.metrics.bottlenecks.sort((e,t)=>t.avgTime-e.avgTime)}getMetrics(){return this.detectBottlenecks(),{...this.metrics}}clear(){this.activeOperations.clear(),this.metrics={variableResolutionTimes:{},expressionEvaluationTimes:{},aiApiCallTimes:{},stringInterpolationTimes:[],memorySnapshots:[],bottlenecks:[]}}}let et=new J,es=new Z,er=new K,ei=new Q,ea=new ee;var en=function(e){return e.INFO="info",e.WARNING="warning",e.ERROR="error",e.CRITICAL="critical",e}({}),eo=function(e){return e.VARIABLE="variable",e.EXPRESSION="expression",e.API="api",e.DEPENDENCY="dependency",e.SYSTEM="system",e.PERFORMANCE="performance",e}({});class el{constructor(e){this.config=e,this.errorHistory=[],this.retryCounters=new Map,this.errorListeners=[]}async handleError(e){if(this.errorHistory.push(e),this.notifyErrorListeners(e),this.config.logErrors&&this.logError(e),this.config.autoRecovery&&e.recoverable)return this.attemptRecovery(e);throw e}createError(e,t,s={}){return{...e,id:`error_${t}_${Date.now()}`,severity:"error",category:t,userMessage:this.generateUserFriendlyMessage(e,t),technicalMessage:e.message,context:{...s,stackTrace:e.stack},recoveryActions:this.generateRecoveryActions(e,t),timestamp:new Date,recoverable:!0}}withErrorHandling(e,t={}){return e().catch(async e=>{let s=e instanceof Error&&"category"in e?e:this.createError(e,"system",t);return this.handleError(s)})}onError(e){this.errorListeners.push(e)}offError(e){let t=this.errorListeners.indexOf(e);t>-1&&this.errorListeners.splice(t,1)}getErrorHistory(){return[...this.errorHistory]}clearErrorHistory(){this.errorHistory=[],this.retryCounters.clear()}getErrorStats(){let e={totalErrors:this.errorHistory.length,errorsByCategory:{},errorsBySeverity:{},recoverySuccessRate:0};Object.values(eo).forEach(t=>{e.errorsByCategory[t]=0}),Object.values(en).forEach(t=>{e.errorsBySeverity[t]=0});let t=0;for(let s of this.errorHistory)e.errorsByCategory[s.category]++,e.errorsBySeverity[s.severity]++,s.recoverable&&t++;let s=this.errorHistory.filter(e=>e.recoverable).length;return e.recoverySuccessRate=s>0?t/s:0,e}async attemptRecovery(e){let t=e.id.split("_").slice(0,-1).join("_"),s=this.retryCounters.get(t)||0;if(s>=this.config.maxRetries)throw Error(`Max retries exceeded for ${t}`);for(let r of e.recoveryActions.sort((e,t)=>(t.successProbability||0)-(e.successProbability||0)))if(r.execute)try{this.retryCounters.set(t,s+1),"retry"===r.type&&await this.delay(this.config.retryDelay);let i=await r.execute();return console.log(`Recovery successful for ${e.id} using ${r.type}`),i}catch(t){console.warn(`Recovery action ${r.type} failed for ${e.id}:`,t);continue}throw e}generateUserFriendlyMessage(e,t){switch(t){case"variable":return"There was an issue accessing a variable. Please check that all required variables are defined.";case"expression":return"There was a problem with an expression in your campaign. Please check the syntax.";case"api":return"There was a problem connecting to an external service. Please try again.";case"dependency":return"There was an issue with variable dependencies. Please check for circular references.";case"system":return"A system error occurred. Please contact support if this persists.";case"performance":return"An operation is taking longer than expected. Performance may be affected.";default:return"An unexpected error occurred. Please try again."}}generateRecoveryActions(e,t){let s=[{type:"retry",description:"Try again",successProbability:.5}];switch(t){case"api":return[...s,{type:"fallback",description:"Use cached data",successProbability:.8}];case"variable":return[{type:"fallback",description:"Use default value",successProbability:.9},{type:"skip",description:"Skip this variable",successProbability:.7}];default:return s}}logError(e){let t="critical"===e.severity||"error"===e.severity?"error":"warning"===e.severity?"warn":"info";console[t](`[${e.category.toUpperCase()}] ${e.userMessage}`,{id:e.id,technical:e.technicalMessage,context:e.context,recoverable:e.recoverable,timestamp:e.timestamp})}notifyErrorListeners(e){this.errorListeners.forEach(t=>{try{t(e)}catch(e){console.error("Error listener failed:",e)}})}delay(e){return new Promise(t=>setTimeout(t,e))}}let ec=new el({maxRetries:3,retryDelay:1e3,performanceThresholds:{variableResolution:5e3,expressionEvaluation:3e3,apiCall:1e4},autoRecovery:!0,logErrors:!0,...void 0});class eh{debounce(e,t,s,r){let i=this.timers.get(e);i&&clearTimeout(i),this.pendingUpdates.set(e,t);let a=setTimeout(()=>{let t=this.pendingUpdates.get(e);t&&(r(t),this.pendingUpdates.delete(e),this.timers.delete(e))},s);this.timers.set(e,a)}cancel(e){let t=this.timers.get(e);t&&(clearTimeout(t),this.timers.delete(e),this.pendingUpdates.delete(e))}clear(){for(let e of this.timers.values())clearTimeout(e);this.timers.clear(),this.pendingUpdates.clear()}constructor(){this.timers=new Map,this.pendingUpdates=new Map}}var ed=function(e){return e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e[e.CRITICAL=4]="CRITICAL",e[e.SILENT=5]="SILENT",e}({}),eu=function(e){return e.VARIABLE="variable",e.EXPRESSION="expression",e.DEPENDENCY="dependency",e.REALTIME="realtime",e.PERFORMANCE="performance",e.API="api",e.ERROR="error",e.SYSTEM="system",e}({});let ep=e=>{let t=e.timestamp.toISOString(),s=ed[e.level].padEnd(8),r=e.category.toUpperCase().padEnd(12),i=`[${t}] ${s} ${r} ${e.message}`;return e.variableId&&(i+=` (variable: ${e.variableId})`),e.metrics?.duration&&(i+=` (${e.metrics.duration}ms)`),i},em=e=>JSON.stringify({id:e.id,timestamp:e.timestamp.toISOString(),level:ed[e.level],category:e.category,message:e.message,data:e.data,error:e.error?{name:e.error.name,message:e.error.message,stack:e.error.stack}:void 0,sessionId:e.sessionId,campaignId:e.campaignId,variableId:e.variableId,source:e.source,metrics:e.metrics}),eg=e=>{let t=e.timestamp.toTimeString().substring(0,8),s=ed[e.level].substring(0,1),r=e.category.substring(0,3).toUpperCase();return`${t} [${s}/${r}] ${e.message}`},ef=e=>{let t={0:"\x1b[36m",1:"\x1b[32m",2:"\x1b[33m",3:"\x1b[31m",4:"\x1b[35m",5:"\x1b[0m"}[e.level]||"",s=`${t}[${ed[e.level]}]\x1b[0m ${e.category}: ${e.message}`;return e.data&&Object.keys(e.data).length>0&&(s+=`
  Data: ${JSON.stringify(e.data,null,2)}`),e.error&&(s+=`
  Error: ${e.error.message}`,e.error.stack&&(s+=`
  Stack: ${e.error.stack}`)),s};class ey{constructor(e){if(this.config=e,this.entries=[],this.outputs=new Map,this.formatters=new Map,this.operationStack=[],this.performanceTimers=new Map,this.formatters.set("default",ep),this.formatters.set("json",em),this.formatters.set("compact",eg),this.formatters.set("development",ef),e.formatters)for(let[t,s]of Object.entries(e.formatters))this.formatters.set(t,s);for(let t of e.outputs)this.outputs.set(t.id,t)}debug(e,t,s){this.log(0,"system",e,t,s)}info(e,t,s){this.log(1,"system",e,t,s)}warn(e,t,s){this.log(2,"system",e,t,s)}error(e,t,s,r){this.log(3,"error",e,s,{...r,error:t})}critical(e,t,s,r){this.log(4,"error",e,s,{...r,error:t})}variable(e,t,s,r){this.log(e,"variable",t,r,{variableId:s})}expression(e,t,s,r){this.log(e,"expression",t,{...r,expression:s})}dependency(e,t,s,r){this.log(e,"dependency",t,{...r,dependencyChain:s})}realtime(e,t,s,r){this.log(e,"realtime",t,r,{variableId:s})}performance(e,t){this.log(1,"performance",e,void 0,{metrics:t})}api(e,t,s,r,i){this.log(e,"api",t,{...i,service:s,operation:r})}startTimer(e){this.config.trackPerformance&&(this.performanceTimers.set(e,Date.now()),this.operationStack.push(e),this.debug(`Started operation: ${e}`,{operationId:e}))}endTimer(e,t){if(!this.config.trackPerformance)return 0;let s=this.performanceTimers.get(e);if(!s)return this.warn(`Timer not found for operation: ${e}`),0;let r=Date.now()-s;this.performanceTimers.delete(e);let i=this.operationStack.indexOf(e);return i>-1&&this.operationStack.splice(i,1),this.performance(t||`Completed operation: ${e}`,{operationId:e,duration:r,memoryUsage:this.getMemoryUsage()}),r}withTiming(e,t){this.startTimer(e);let s=t=>(this.endTimer(e),t),r=t=>{throw this.endTimer(e,`Failed operation: ${e}`),t};try{let e=t();if(e instanceof Promise)return e.then(s).catch(r);return Promise.resolve(s(e))}catch(e){return r(e),Promise.reject(e)}}scope(e){return new ex(this,e)}getEntries(e){let t=this.entries;return e?.level!==void 0&&(t=t.filter(t=>t.level>=e.level)),e?.category&&(t=t.filter(t=>t.category===e.category)),e?.since&&(t=t.filter(t=>t.timestamp>=e.since)),e?.limit&&(t=t.slice(-e.limit)),t}getStats(){let e={},t={};for(let s of(Object.values(ed).forEach(t=>{"string"==typeof t&&(e[t]=0)}),Object.values(eu).forEach(e=>{t[e]=0}),this.entries))e[ed[s.level]]++,t[s.category]++;return{totalEntries:this.entries.length,entriesByLevel:e,entriesByCategory:t,activeOperations:[...this.operationStack],memoryUsage:this.getMemoryUsage()}}clear(){this.entries=[],this.performanceTimers.clear(),this.operationStack=[]}updateConfig(e){Object.assign(this.config,e)}log(e,t,s,r,i){if(!this.shouldLog(e,t))return;let a={id:`log_${Date.now()}_${Math.random().toString(36).substring(2)}`,level:e,category:t,message:s,timestamp:new Date,data:r,...i};this.config.includeStackTrace&&e>=3&&(a.source=this.getSourceLocation()),this.entries.push(a),this.entries.length>this.config.maxEntries&&(this.entries=this.entries.slice(-this.config.maxEntries)),this.outputEntry(a)}shouldLog(e,t){return!(e<this.config.level)&&("*"===this.config.categories||!!this.config.categories.includes(t))}outputEntry(e){for(let t of this.outputs.values()){if(void 0!==t.level&&e.level<t.level||t.categories&&!t.categories.includes(e.category))continue;let s=this.formatters.get(t.formatter||"default");if(!s){console.error(`Formatter not found: ${t.formatter}`);continue}let r=s(e);"console"===t.type&&console.log(r)}}getSourceLocation(){let e=Error().stack;if(!e)return{};let t=e.split("\n")[4];if(!t)return{};let s=t.match(/at\s+(.+?)\s+\((.+):(\d+):(\d+)\)/);return s?{function:s[1],file:s[2],line:parseInt(s[3])}:{}}getMemoryUsage(){return"undefined"!=typeof process&&process.memoryUsage?process.memoryUsage().heapUsed:0}}class ex{constructor(e,t){this.parent=e,this.context=t}debug(e,t){this.parent.debug(e,t,this.context)}info(e,t){this.parent.info(e,t,this.context)}warn(e,t){this.parent.warn(e,t,this.context)}error(e,t,s){this.parent.error(e,t,s,this.context)}critical(e,t,s){this.parent.critical(e,t,s,this.context)}variable(e,t,s,r){this.parent.variable(e,t,s,r)}scope(e){return new ex(this.parent,{...this.context,...e})}startTimer(e){this.parent.startTimer(e)}endTimer(e,t){return this.parent.endTimer(e,t)}withTiming(e,t){return this.parent.withTiming(e,t)}}let ev=new ey({level:1,categories:"*",outputs:[{id:"console",type:"console",formatter:"development"}],maxEntries:1e3,includeStackTrace:!0,trackPerformance:!0,...void 0});function eb({}){let e=(0,n.useParams)(),t=e?.slug,[s,r]=(0,a.useState)(null),[j,T]=(0,a.useState)([]),[A,k]=(0,a.useState)(!0),[C,V]=(0,a.useState)(null),[$,M]=(0,a.useState)({isOnline:!0,connectionType:"unknown",effectiveType:"unknown",downlink:0}),[D,I]=(0,a.useState)(null),[R,P]=(0,a.useState)(null),[_,O]=(0,a.useState)(null),[z,L]=(0,a.useState)(!1),[U,q]=(0,a.useState)(null),[F,B]=(0,a.useState)(null),[G,H]=(0,a.useState)(null),[W,Y]=(0,a.useState)(new Map),[X,J]=(0,a.useState)(!1),[Z,K]=(0,a.useState)({currentSection:0,userInputs:{},completedSections:new Set,startTime:new Date,sessionId:crypto.randomUUID()}),[Q,ee]=(0,a.useState)({totalProgress:0,weightedProgress:0,captureProgress:0,timeEstimate:0,completionForecast:"",milestones:[]}),et=e=>{let t=j[e];return t?"output"===t.type&&100!==Q.captureProgress?{canAccess:!1,reason:"Please complete the contact information section first"}:{canAccess:!0}:{canAccess:!1,reason:"Section not found"}},es=e=>{let t=et(e);return t.canAccess?(eA(e),!0):(V(ez(t.reason||"Cannot access this section yet","validation",!1)),setTimeout(()=>V(null),3e3),!1)},er=async e=>{try{if(!R)return e.description||"Thank you for completing this campaign.";let t={userResponses:Z.userInputs,campaignInfo:{name:s?.name,id:s?.id,type:"lead_magnet"},sessionInfo:{completedSections:Array.from(Z.completedSections),totalSections:j.length,timeSpent:Math.round((new Date().getTime()-Z.startTime.getTime())/1e3)}},r=e.description||e.title||"Thank you for completing this campaign.";return await eb(r,t)}catch(t){return console.error("Error generating dynamic content:",t),eS(e.description||"Thank you for completing this campaign.",Z.userInputs)}},[ei,ea]=(0,a.useState)(!1),[en,el]=(0,a.useState)(""),[eh,ed]=(0,a.useState)({isProcessing:!1,stage:"",progress:0,message:""}),eu=async e=>{ed({isProcessing:!0,stage:"analyzing",progress:20,message:"Analyzing your responses..."});try{await new Promise(e=>setTimeout(e,1e3)),ed(e=>({...e,stage:"generating",progress:60,message:"Generating personalized content..."})),await er(e),await new Promise(e=>setTimeout(e,1e3)),ed(e=>({...e,stage:"finalizing",progress:90,message:"Finalizing your results..."})),await new Promise(e=>setTimeout(e,500)),ed(e=>({...e,progress:100,message:"Complete!"})),setTimeout(()=>{ed({isProcessing:!1,stage:"",progress:0,message:""})},500)}catch(e){console.error("AI processing error:",e),ed({isProcessing:!1,stage:"error",progress:0,message:"Processing failed. Showing standard content."})}},ep=e=>{if(!D)return e;let t="mobile"===D.type?"min-h-[44px] touch-manipulation select-none":"";return(0,l.cn)(e,t)},em=()=>({}),eg=async(e,t,s,r={})=>{try{K(r=>({...r,userInputs:{...r.userInputs,[t]:s,[`${e}_${t}`]:s}}));let i=`${e}_${t}`,a={sectionId:e,fieldId:t,value:s,metadata:{...r,timestamp:new Date().toISOString(),sessionId:Z.sessionId,sectionIndex:Z.currentSection,deviceInfo:em(),interactionType:"input_change"}};Y(e=>new Map(e.set(i,a))),G&&clearTimeout(G);let n=setTimeout(()=>{ef()},1e3);H(n),_&&await _.updateVariable(t,s,{source:"user_input",propagate:!0})}catch(r){console.error("Error collecting response:",r),ec.handleError(ec.createError(r,eo.VARIABLE,{location:{function:"collectResponse"},metadata:{sectionId:e,fieldId:t,value:s}}))}},ef=async()=>{if(0!==W.size)try{let e=Array.from(W.values());await ey(e),Y(new Map),ev.info("Batch responses saved successfully")}catch(e){console.error("Error flushing pending updates:",e)}},ey=async e=>{try{let t=await (0,o.AG)(),s=e.map(e=>({session_id:e.metadata.sessionId,section_id:e.sectionId,field_id:e.fieldId,response_value:String(e.value),response_type:"number"==typeof e.value?"number":"boolean"==typeof e.value?"boolean":"text",response_data:{originalValue:e.value,metadata:e.metadata},section_index:e.metadata.sectionIndex,created_at:e.metadata.timestamp})),{error:r}=await t.from("lead_responses").upsert(s,{onConflict:"session_id,section_id,field_id"});if(r)throw r;await ex()}catch(e){throw console.error("Error saving batch responses:",e),e}},ex=async()=>{try{let e=await (0,o.AG)(),t={session_id:Z.sessionId,campaign_id:s?.id,last_section_index:Z.currentSection,completion_percentage:Math.round(Z.completedSections.size/j.length*100),total_sections:j.length,completed_sections:Z.completedSections.size,last_activity:new Date().toISOString(),is_completed:Z.completedSections.size>=j.length},{error:r}=await e.from("campaign_sessions").upsert(t,{onConflict:"session_id,campaign_id"});if(r)throw r}catch(e){console.error("Error updating session progress:",e)}},eb=async(e,t={})=>{if(!e||!R)return e||"";try{return await R.processInterpolatedText(e)||e}catch(s){return console.error("Variable interpolation error:",s),eS(e,t)}},ew=()=>({campaign_name:s?.name||"",campaign_id:s?.id||"",campaign_description:s?.description||"",user_session:Z.sessionId,current_section:Z.currentSection+1,total_sections:j.length,start_time:Z.startTime.toISOString(),completion_rate:Math.round(Z.completedSections.size/j.length*100),time_elapsed:Math.round((new Date().getTime()-Z.startTime.getTime())/1e3)}),eS=(e,t={})=>{if(!e)return e;let s=e;return Object.entries(Z.userInputs).forEach(([e,t])=>{s=s.replace(RegExp(`@${e}`,"g"),String(t))}),Object.entries(ew()).forEach(([e,t])=>{s=s.replace(RegExp(`@${e}`,"g"),String(t))}),Object.entries(t).forEach(([e,t])=>{s=s.replace(RegExp(`@${e}`,"g"),String(t))}),s},eN=async()=>{try{if(k(!0),V(null),!$.isOnline)throw Error("No internet connection available");let e=await (0,o.AG)(),{data:s,error:i}=await e.from("campaigns").select("*").eq("published_url",t).eq("status","published").eq("is_active",!0).single();if(i||!s){if(i?.code==="PGRST116")throw Error("Campaign not found");throw Error(i?.message||"Campaign not available")}r(s);let{data:a,error:n}=await e.from("sections").select(`
          *,
          section_options (*)
        `).eq("campaign_id",s.id).order("order_index",{ascending:!0});if(n)throw Error(`Failed to load campaign sections: ${n.message}`);if(!a||0===a.length)throw Error("This campaign has no content to display");T(a),K(e=>({...e,startTime:new Date,sessionId:crypto.randomUUID()}))}catch(e){console.error("Error loading public campaign:",e),eL(e,{function:"loadPublicCampaign",slug:t})}finally{k(!1)}},eE=async(e,t)=>{try{let s=j[e];if(K(s=>({...s,userInputs:{...s.userInputs,...t},completedSections:new Set([...s.completedSections,e])})),_)for(let[e,s]of Object.entries(t))await _.updateVariable(e,s,{source:"user_input",propagate:!0});"capture"===s.type&&await ej(t),await eT(s.id,t),e<j.length-1&&setTimeout(()=>{K(e=>({...e,currentSection:Math.min(j.length-1,e.currentSection+1)}))},1e3)}catch(s){console.error("Error completing section:",s),ec.handleError(ec.createError(s,eo.VARIABLE,{location:{function:"handleSectionComplete"},metadata:{sectionIndex:e,data:t}}))}},ej=async e=>{try{if(!s)return;let t=await (0,o.AG)(),r={campaign_id:s.id,name:e.name||e.full_name||null,email:e.email,phone:e.phone||null,ip_address:null,user_agent:"undefined"!=typeof navigator?navigator.userAgent:null,metadata:{session_id:Z.sessionId,completed_sections:Array.from(Z.completedSections),start_time:Z.startTime.toISOString()}},{data:i,error:a}=await t.from("leads").upsert(r,{onConflict:"campaign_id,email"}).select().single();if(a)throw a;K(e=>({...e,leadId:i.id}))}catch(e){console.error("Error saving lead data:",e)}},eT=async(e,t)=>{try{let s,r;if(!Z.leadId)return;let i=await (0,o.AG)(),a={};"object"==typeof t?(s="multiple_choice",r=JSON.stringify(t),a=t):(s="number"==typeof t?"number":"text",r=String(t));let{error:n}=await i.from("lead_responses").upsert({lead_id:Z.leadId,section_id:e,response_type:s,response_value:r,response_data:a},{onConflict:"lead_id,section_id"});if(n)throw n}catch(e){console.error("Error saving response:",e)}},eA=e=>{!z&&e!==Z.currentSection&&(e<0||e>=j.length||(L(!0),K(t=>({...t,currentSection:e})),setTimeout(()=>L(!1),300)))},ek=async(e,t,s)=>{let r=await eb(e.title||""),i=await eb(e.description||"");switch(e.type){case"capture":return eC(e,t,s,r,i);case"text_question":return eV(e,t,s,r,i);case"multiple_choice":return e$(e,t,s,r,i);case"slider":return eM(e,t,s,r,i);case"info":return eD(e,t,s,r,i);case"logic":return eI(e,t,s,r,i);case"output":return eR(e,t,s,r,i);default:return eP(e,t)}},eC=(e,t,s,r,a)=>(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:(0,l.cn)("font-bold text-gray-900 mb-4 text-center",D?.type==="mobile"?"text-2xl":"text-3xl"),children:r||"Capture Section"}),(0,i.jsx)("p",{className:(0,l.cn)("text-gray-600 mb-8 text-center",D?.type==="mobile"?"text-base px-4":"text-lg"),children:a||"Please provide your information."}),(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault();let s=new FormData(e.currentTarget),r={};s.forEach((e,t)=>{r[t]=e}),eE(t,r)},className:"space-y-6",children:[(s.fields||e_()).map((t,s)=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{className:(0,l.cn)("block font-medium text-gray-700 mb-2",D?.type==="mobile"?"text-base":"text-sm"),children:[t.label,t.required&&(0,i.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,i.jsx)("input",{type:t.type||"text",name:t.id,required:t.required,className:(0,l.cn)("w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",ep("px-4 py-3"),D?.type==="mobile"&&"text-base"),placeholder:t.placeholder||`Enter your ${t.label.toLowerCase()}`,onChange:s=>{eg(e.id,t.id,s.target.value,{fieldType:t.type||"text",fieldLabel:t.label,isRequired:t.required||!1})},defaultValue:Z.userInputs[t.id]||""})]},t.id||s)),(0,i.jsx)("div",{className:"text-center pt-4",children:(0,i.jsx)(c.$,{type:"submit",className:ep("bg-blue-600 hover:bg-blue-700 w-full"),size:D?.type==="mobile"?"lg":"default",children:"Continue"})})]})]}),eV=(e,t,s,r,a)=>(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4 text-center",children:r||"Question"}),(0,i.jsx)("p",{className:"text-gray-600 mb-8 text-center text-lg",children:a||"Please provide your answer."}),(0,i.jsxs)("form",{onSubmit:s=>{s.preventDefault();let r=new FormData(s.currentTarget).get("answer");eE(t,{answer:r,[e.id]:r})},className:"space-y-6",children:[(0,i.jsx)("div",{children:"textarea"===s.input_type?(0,i.jsx)("textarea",{name:"answer",required:e.required,rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:s.placeholder||"Type your answer here...",onChange:t=>{eg(e.id,"answer",t.target.value,{inputType:"textarea",isRequired:e.required||!1,placeholder:s.placeholder})},defaultValue:Z.userInputs.answer||Z.userInputs[e.id]||""}):(0,i.jsx)("input",{type:s.input_type||"text",name:"answer",required:e.required,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:s.placeholder||"Type your answer here...",onChange:t=>{eg(e.id,"answer",t.target.value,{inputType:s.input_type||"text",isRequired:e.required||!1,placeholder:s.placeholder})},defaultValue:Z.userInputs.answer||Z.userInputs[e.id]||""})}),(0,i.jsx)("div",{className:"text-center pt-4",children:(0,i.jsx)(c.$,{type:"submit",size:"lg",className:"bg-blue-600 hover:bg-blue-700 px-8 py-3",children:"Continue"})})]})]}),e$=(e,t,s,r,a)=>(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4 text-center",children:r||"Make Your Choice"}),(0,i.jsx)("p",{className:"text-gray-600 mb-8 text-center text-lg",children:a||"Please select from the options below."}),(0,i.jsx)("div",{className:"space-y-4 max-w-2xl mx-auto",children:(e.options||eO()).map((s,r)=>(0,i.jsx)("div",{className:"p-6 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 cursor-pointer transition-all",onClick:()=>eE(t,{choice:s.value,[e.id]:s.value,selected_option:s.label}),children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"w-5 h-5 border-2 border-gray-300 rounded mr-4"}),(0,i.jsx)("span",{className:"text-lg text-gray-900",children:s.label})]})},s.id||r))})]}),eM=(e,t,s,r,n)=>{let o=Z.userInputs[e.id]||Z.userInputs.value,[l,h]=(0,a.useState)(o||s.default_value||50);return(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4 text-center",children:r||"Rate Your Experience"}),(0,i.jsx)("p",{className:"text-gray-600 mb-8 text-center text-lg",children:n||"Please move the slider to your preferred value."}),(0,i.jsxs)("div",{className:"max-w-md mx-auto space-y-6",children:[(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:l}),(0,i.jsxs)("div",{className:"text-sm text-gray-500",children:[s.min_label||"Minimum"," ← → ",s.max_label||"Maximum"]})]}),(0,i.jsx)("input",{type:"range",min:s.min_value||0,max:s.max_value||100,step:s.step||1,value:l,onChange:t=>{let r=Number(t.target.value);h(r),eg(e.id,"value",r,{inputType:"slider",minValue:s.min_value||0,maxValue:s.max_value||100,step:s.step||1,minLabel:s.min_label,maxLabel:s.max_label})},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),(0,i.jsx)("div",{className:"text-center pt-4",children:(0,i.jsx)(c.$,{onClick:()=>eE(t,{value:l,[e.id]:l}),size:"lg",className:"bg-blue-600 hover:bg-blue-700 px-8 py-3",children:"Continue"})})]})]})},eD=(e,t,s,r,a)=>(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:r||"Information"}),(0,i.jsx)("div",{className:"prose prose-lg mx-auto text-gray-600 mb-8",children:(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:a||"Information content here."}})}),(0,i.jsx)("div",{className:"text-center pt-4",children:(0,i.jsx)(c.$,{onClick:()=>eE(t,{viewed:!0}),size:"lg",className:"bg-blue-600 hover:bg-blue-700 px-8 py-3",children:"Continue"})})]}),eI=(e,t,s,r,n)=>{let[o,l]=(0,a.useState)(!1);(0,a.useEffect)(()=>{c()},[]);let c=async()=>{l(!0);try{await new Promise(e=>setTimeout(e,2e3)),eE(t,{processed:!0,logic_result:"processed",timestamp:new Date().toISOString()})}catch(e){console.error("Error processing logic section:",e)}finally{l(!1)}};return(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(d.A,{className:"h-16 w-16 text-blue-600 mx-auto mb-6"}),(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:r||"Processing Your Information"}),(0,i.jsx)("div",{className:"prose prose-lg mx-auto text-gray-600",children:(0,i.jsx)("p",{children:n||"Please wait while we analyze your responses..."})}),o&&(0,i.jsxs)("div",{className:"mt-8 flex items-center justify-center",children:[(0,i.jsx)(u.A,{className:"h-8 w-8 animate-spin text-blue-600 mr-3"}),(0,i.jsx)("span",{className:"text-gray-600",children:"Processing..."})]})]})},eR=(e,t,s,r,n)=>{let o,[c,y]=(0,a.useState)(""),[x,v]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{x||Z.currentSection!==t||(async()=>{await eu(e),y(await er(e)),v(!0)})()},[Z.currentSection,t,x]),eh.isProcessing&&Z.currentSection===t)?(0,i.jsxs)("div",{className:"text-center max-w-2xl mx-auto",children:[(0,i.jsx)(d.A,{className:"h-16 w-16 text-blue-600 mx-auto mb-6 animate-pulse"}),(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Processing Your Results"}),(0,i.jsxs)("div",{className:"mb-8",children:[(0,i.jsx)("div",{className:"flex items-center justify-center mb-4",children:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("div",{className:"text-sm text-gray-600",children:eh.message}),(0,i.jsx)(u.A,{className:"h-4 w-4 animate-spin text-blue-600"})]})}),(0,i.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-4",children:(0,i.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${eh.progress}%`}})}),(0,i.jsxs)("div",{className:"flex justify-center space-x-8 text-xs",children:[(0,i.jsxs)("div",{className:(0,l.cn)("flex items-center space-x-1",eh.progress>=20?"text-blue-600":"text-gray-400"),children:[(0,i.jsx)("div",{className:(0,l.cn)("w-2 h-2 rounded-full",eh.progress>=20?"bg-blue-600":"bg-gray-300")}),(0,i.jsx)("span",{children:"Analyzing"})]}),(0,i.jsxs)("div",{className:(0,l.cn)("flex items-center space-x-1",eh.progress>=60?"text-blue-600":"text-gray-400"),children:[(0,i.jsx)("div",{className:(0,l.cn)("w-2 h-2 rounded-full",eh.progress>=60?"bg-blue-600":"bg-gray-300")}),(0,i.jsx)("span",{children:"Generating"})]}),(0,i.jsxs)("div",{className:(0,l.cn)("flex items-center space-x-1",eh.progress>=90?"text-blue-600":"text-gray-400"),children:[(0,i.jsx)("div",{className:(0,l.cn)("w-2 h-2 rounded-full",eh.progress>=90?"bg-blue-600":"bg-gray-300")}),(0,i.jsx)("span",{children:"Finalizing"})]})]})]}),(0,i.jsx)("p",{className:"text-gray-600",children:"We're analyzing your responses to create personalized results just for you..."})]}):(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(p.A,{className:"h-16 w-16 text-green-600 mx-auto mb-6"}),(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:r||"Your Results Are Ready!"}),(0,i.jsx)("div",{className:"prose prose-lg mx-auto text-gray-600 mb-8",children:(o=c||n||"Thank you for completing this campaign.",Object.entries({...Z.userInputs,completion_time:Math.round((new Date().getTime()-Z.startTime.getTime())/1e3),completion_percentage:Q.totalProgress,sections_completed:Z.completedSections.size,total_sections:j.length}).forEach(([e,t])=>{o=o.replace(RegExp(`@${e}`,"g"),String(t))}),(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:o}}))}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto mb-8",children:[(0,i.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,i.jsx)(m.A,{className:"h-5 w-5 text-blue-600 mr-2"}),(0,i.jsx)("span",{className:"text-sm font-medium text-blue-800",children:"Completion Time"})]}),(0,i.jsx)("div",{className:"text-xl font-bold text-blue-600",children:(()=>{let e=Math.round((new Date().getTime()-Z.startTime.getTime())/1e3),t=Math.floor(e/60);return`${t}m ${e%60}s`})()})]}),(0,i.jsxs)("div",{className:"bg-green-50 rounded-lg p-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,i.jsx)(g.A,{className:"h-5 w-5 text-green-600 mr-2"}),(0,i.jsx)("span",{className:"text-sm font-medium text-green-800",children:"Progress"})]}),(0,i.jsxs)("div",{className:"text-xl font-bold text-green-600",children:[Q.totalProgress,"%"]})]}),(0,i.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,i.jsx)(f.A,{className:"h-5 w-5 text-purple-600 mr-2"}),(0,i.jsx)("span",{className:"text-sm font-medium text-purple-800",children:"Responses"})]}),(0,i.jsx)("div",{className:"text-xl font-bold text-purple-600",children:Object.keys(Z.userInputs).length})]})]}),Q.milestones.length>0&&(0,i.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 max-w-2xl mx-auto",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Milestones Achieved"}),(0,i.jsx)("div",{className:"flex flex-wrap justify-center gap-2",children:Q.milestones.map((e,t)=>(0,i.jsxs)(h.E,{variant:"secondary",className:"bg-green-100 text-green-800",children:["✓ ",e]},t))})]})]})},eP=(e,t)=>(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(y.A,{className:"h-12 w-12 text-orange-500 mx-auto mb-4"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Unsupported Section Type"}),(0,i.jsxs)("p",{className:"text-gray-600 mb-6",children:['Section type "',e.type,'" is not yet supported in the public view.']}),(0,i.jsx)(c.$,{onClick:()=>eE(t,{skipped:!0}),variant:"outline",children:"Skip This Section"})]}),e_=()=>[{id:"name",type:"text",label:"Full Name",required:!0},{id:"email",type:"email",label:"Email Address",required:!0}],eO=()=>[{id:"1",label:"Option 1",value:"option1"},{id:"2",label:"Option 2",value:"option2"},{id:"3",label:"Option 3",value:"option3"}],ez=(e,t,s=!0,r)=>({message:e,type:t,retryable:s,retryCount:0,details:r,lastRetryAt:void 0,recovered:!1}),eL=(e,t)=>{let s;V(s="type"in e?e:e.message.includes("fetch")||e.message.includes("network")?ez("Network connection issue. Please check your internet connection.","network",!0,{originalError:e.message,context:t}):e.message.includes("401")||e.message.includes("403")?ez("This campaign is no longer available or access is restricted.","api",!1,{originalError:e.message,context:t}):e.message.includes("404")?ez("Campaign not found. Please check the URL.","api",!1,{originalError:e.message,context:t}):ez("An unexpected error occurred. Please try again.","system",!0,{originalError:e.message,context:t})),console.error("Campaign Error:",s),"object"==typeof e&&"stack"in e&&ec.handleError(ec.createError(e,eo.API,{location:{function:t?.function||"unknown"},metadata:{errorState:s,context:t}}))},eU=async(e,t=3,s=1e3,r)=>{for(let i=0;i<=t;i++)try{let t=await e();return C?.retryable&&(V(e=>e?{...e,recovered:!0}:null),setTimeout(()=>V(null),2e3)),t}catch(a){if(i===t)throw a;C?.retryable&&V(e=>e?{...e,retryCount:(e.retryCount||0)+1,lastRetryAt:new Date}:null);let e=s*Math.pow(2,i);await new Promise(t=>setTimeout(t,e)),console.log(`Retry attempt ${i+1}/${t+1} for ${r} in ${e}ms`)}},eq=async()=>{if(C)try{switch(k(!0),C.type){case"network":$.isOnline?await eU(()=>eN(),2,1e3,"network recovery"):V(ez("No internet connection. Please check your network and try again.","network",!0));break;case"api":C.retryable&&await eU(()=>eN(),1,2e3,"api recovery");break;case"system":await eU(()=>eN(),1,1e3,"system recovery");break;default:await eU(()=>eN(),1,1e3,"generic recovery")}}catch(e){eL(e,{function:"recoverFromError"})}finally{k(!1)}};return A?(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(u.A,{className:"h-8 w-8 animate-spin text-blue-600 mx-auto mb-4"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Loading Campaign"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Please wait while we prepare your experience..."})]})}):C?(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,i.jsxs)("div",{className:"text-center max-w-md mx-auto",children:["network"===C.type?(0,i.jsxs)("div",{className:"relative",children:[$.isOnline?(0,i.jsx)(x.A,{className:"h-12 w-12 text-amber-500 mx-auto mb-4"}):(0,i.jsx)(v.A,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),C.retryCount&&C.retryCount>0&&(0,i.jsx)("div",{className:"absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:C.retryCount})]}):"validation"===C.type?(0,i.jsx)(b.A,{className:"h-12 w-12 text-amber-500 mx-auto mb-4"}):(0,i.jsx)(y.A,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,i.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"network"===C.type?"Connection Issue":"validation"===C.type?"Access Required":"api"===C.type?"Campaign Unavailable":"Something went wrong"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:C.message}),"network"===C.type&&(0,i.jsx)("div",{className:(0,l.cn)("inline-flex items-center px-3 py-1 rounded-full text-sm mb-4",$.isOnline?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:$.isOnline?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.A,{className:"h-3 w-3 mr-1"}),"Connected"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.A,{className:"h-3 w-3 mr-1"}),"Offline"]})}),C.recovered&&(0,i.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-center",children:[(0,i.jsx)(p.A,{className:"h-4 w-4 text-green-600 mr-2"}),(0,i.jsx)("span",{className:"text-sm text-green-800",children:"Connection restored"})]})}),(0,i.jsxs)("div",{className:"space-y-3",children:[C.retryable&&(0,i.jsx)(c.$,{onClick:eq,disabled:A,className:ep("bg-blue-600 hover:bg-blue-700 w-full"),size:D?.type==="mobile"?"lg":"default",children:A?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.A,{className:"h-4 w-4 animate-spin mr-2"}),"Retrying..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(w.A,{className:"h-4 w-4 mr-2"}),"Try Again"]})}),"validation"===C.type&&j.length>0&&(0,i.jsx)(c.$,{onClick:()=>{V(null);let e=j.findIndex(e=>"capture"===e.type);e>=0&&eA(e)},className:ep("bg-green-600 hover:bg-green-700 w-full"),size:D?.type==="mobile"?"lg":"default",children:"Complete Required Information"}),!C.retryable&&"validation"!==C.type&&(0,i.jsx)(c.$,{variant:"outline",onClick:()=>window.location.reload(),className:ep("w-full"),size:D?.type==="mobile"?"lg":"default",children:"Reload Page"}),"validation"===C.type&&(0,i.jsx)(c.$,{variant:"outline",onClick:()=>V(null),className:ep("w-full"),size:D?.type==="mobile"?"lg":"default",children:"Continue Where I Left Off"})]}),!1,!1]})}):s&&0!==j.length?(0,i.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[ei&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg p-8 max-w-md mx-4 text-center",children:[(0,i.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDF89"}),(0,i.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Campaign Complete!"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:en}),(0,i.jsx)("div",{className:"flex justify-center space-x-2 mb-4",children:Q.milestones.map((e,t)=>(0,i.jsx)(h.E,{variant:"secondary",className:"text-xs",children:e},t))}),(0,i.jsx)(c.$,{onClick:()=>ea(!1),className:"bg-green-600 hover:bg-green-700",children:"Continue"})]})}),(0,i.jsx)("div",{className:"bg-white border-b",children:(0,i.jsxs)("div",{className:"max-w-4xl mx-auto px-6 py-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(S.A,{className:"h-5 w-5 text-blue-600 mr-2"}),(0,i.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:s.name})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[W.size>0&&(0,i.jsxs)("div",{className:"flex items-center text-sm text-amber-600",children:[(0,i.jsx)(u.A,{className:"h-3 w-3 animate-spin mr-1"}),(0,i.jsx)("span",{children:"Saving..."})]}),0===W.size&&X&&Z.userInputs&&Object.keys(Z.userInputs).length>0&&(0,i.jsxs)("div",{className:"flex items-center text-sm text-green-600",children:[(0,i.jsx)(p.A,{className:"h-3 w-3 mr-1"}),(0,i.jsx)("span",{children:"Saved"})]}),(0,i.jsxs)("div",{className:"flex flex-col items-end",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,i.jsxs)("span",{className:"text-sm text-gray-600",children:[Z.currentSection+1," of ",j.length]}),(0,i.jsxs)("span",{className:"text-sm font-medium text-blue-600",children:[Q.weightedProgress,"%"]})]}),Q.timeEstimate>0&&(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["~",Math.ceil(Q.timeEstimate/60),"min remaining • Est. ",Q.completionForecast]}),(0,i.jsx)("div",{className:"w-32 h-1 bg-gray-200 rounded-full mt-1",children:(0,i.jsx)("div",{className:"h-1 bg-blue-600 rounded-full transition-all duration-300",style:{width:`${Q.weightedProgress}%`}})})]}),(0,i.jsx)("div",{className:"flex space-x-1",children:j.map((e,t)=>{let s=et(t).canAccess;return(0,i.jsx)("div",{className:(0,l.cn)("w-2 h-2 rounded-full transition-colors cursor-pointer",t===Z.currentSection?"bg-blue-600 ring-2 ring-blue-200":Z.completedSections.has(t)?"bg-green-500":s?"bg-gray-300 hover:bg-gray-400":"bg-gray-200"),onClick:()=>{s&&t!==Z.currentSection&&es(t)},title:`${e.title||`Section ${t+1}`}${!s?" (Locked)":""}`},t)})})]})]}),Q.milestones.length>0&&(0,i.jsx)("div",{className:"mt-3 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(g.A,{className:"h-4 w-4 text-green-600"}),(0,i.jsx)("div",{className:"flex space-x-1",children:Q.milestones.slice(-2).map((e,t)=>(0,i.jsx)(h.E,{variant:"secondary",className:"text-xs bg-green-50 text-green-700",children:e},t))})]})})]})}),(0,i.jsx)("div",{className:"py-12 px-6",children:j.map((e,t)=>ek(e,t,e.configuration||{}))}),(0,i.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg",children:(0,i.jsx)("div",{className:"max-w-4xl mx-auto px-6 py-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)(c.$,{variant:"outline",onClick:()=>{z||Z.currentSection<=0||(L(!0),K(e=>({...e,currentSection:Math.max(0,e.currentSection-1)})),setTimeout(()=>L(!1),300))},disabled:z||Z.currentSection<=0,className:(0,l.cn)(ep("transition-all duration-200"),z&&"opacity-50 cursor-not-allowed",D?.type==="mobile"&&"px-6 py-3"),size:D?.type==="mobile"?"lg":"default",children:[(0,i.jsx)(N.A,{className:(0,l.cn)("mr-1",D?.type==="mobile"?"h-5 w-5":"h-4 w-4")}),"Previous"]}),(0,i.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsxs)("span",{className:"text-sm text-gray-600",children:[Z.currentSection+1," of ",j.length]}),z&&(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(u.A,{className:"h-3 w-3 animate-spin text-blue-600 mr-1"}),(0,i.jsx)("span",{className:"text-xs text-blue-600",children:"Transitioning..."})]})]}),(0,i.jsx)("div",{className:"text-xs text-gray-400 text-center max-w-xs",children:D?.touchCapable?"Swipe left/right or use buttons to navigate":"Use arrow keys or buttons to navigate"}),!$.isOnline&&(0,i.jsxs)("div",{className:"flex items-center text-xs text-red-500",children:[(0,i.jsx)(v.A,{className:"h-3 w-3 mr-1"}),(0,i.jsx)("span",{children:"Offline"})]})]}),(0,i.jsxs)(c.$,{variant:"outline",onClick:()=>{z||Z.currentSection>=j.length-1||(L(!0),K(e=>({...e,currentSection:Math.min(j.length-1,e.currentSection+1)})),setTimeout(()=>L(!1),300))},disabled:z||Z.currentSection>=j.length-1,className:(0,l.cn)(ep("transition-all duration-200"),z&&"opacity-50 cursor-not-allowed",D?.type==="mobile"&&"px-6 py-3"),size:D?.type==="mobile"?"lg":"default",children:["Next",(0,i.jsx)(E.A,{className:(0,l.cn)("ml-1",D?.type==="mobile"?"h-5 w-5":"h-4 w-4")})]})]})})})]}):(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(S.A,{className:"h-8 w-8 text-gray-400 mx-auto mb-4"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Content"}),(0,i.jsx)("p",{className:"text-gray-600",children:"This campaign doesn't have any content to display."})]})})}},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[243,247,658,928,177],()=>s(60721));module.exports=r})();