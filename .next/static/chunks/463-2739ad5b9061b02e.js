"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[463],{2382:(e,a,t)=>{t.d(a,{Rk:()=>n,canCaptureLeads:()=>c,canCreateCampaign:()=>o,incrementCampaignUsage:()=>i,incrementLeadsUsage:()=>s});var r=t(85793);async function n(){let e=await (0,r.oC)(),a=await (0,r.AG)();return(0,r.Uj)(async()=>await a.from("profiles").select("*").eq("id",e).single())}async function i(){let e=await (0,r.oC)(),a=await (0,r.AG)(),{data:t,error:n}=await a.from("profiles").select("monthly_campaigns_used, monthly_campaign_limit").eq("id",e).single();if(n)return{success:!1,error:n.message||"Failed to fetch profile"};let i=t.monthly_campaigns_used||0,s=t.monthly_campaign_limit||0;return s>0&&i>=s?{success:!1,error:"Monthly campaign limit exceeded",validation_errors:[{field:"monthly_campaigns_used",message:"You have reached your monthly limit of ".concat(s," campaigns"),code:"LIMIT_EXCEEDED",value:i}]}:(0,r.Uj)(async()=>await a.from("profiles").update({monthly_campaigns_used:i+1,updated_at:new Date().toISOString()}).eq("id",e).select().single())}async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=await (0,r.oC)(),t=await (0,r.AG)(),{data:n,error:i}=await t.from("profiles").select("monthly_leads_captured, monthly_leads_limit").eq("id",a).single();if(i)return{success:!1,error:i.message||"Failed to fetch profile"};let s=n.monthly_leads_captured||0,o=n.monthly_leads_limit||0;return o>0&&s+e>o?{success:!1,error:"Monthly leads limit exceeded",validation_errors:[{field:"monthly_leads_captured",message:"Adding ".concat(e," lead(s) would exceed your monthly limit of ").concat(o," leads"),code:"LIMIT_EXCEEDED",value:s}]}:(0,r.Uj)(async()=>await t.from("profiles").update({monthly_leads_captured:s+e,updated_at:new Date().toISOString()}).eq("id",a).select().single())}async function o(){let e=await (0,r.oC)(),a=await (0,r.AG)();return(0,r.Uj)(async()=>{let{data:t,error:r}=await a.from("profiles").select("monthly_campaigns_used, monthly_campaign_limit").eq("id",e).single();return r?{data:null,error:r}:{data:t.monthly_campaign_limit<=0||t.monthly_campaigns_used<t.monthly_campaign_limit,error:null}})}async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=await (0,r.oC)(),t=await (0,r.AG)();return(0,r.Uj)(async()=>{let{data:r,error:n}=await t.from("profiles").select("monthly_leads_captured, monthly_leads_limit").eq("id",a).single();return n?{data:null,error:n}:{data:r.monthly_leads_limit<=0||r.monthly_leads_captured+e<=r.monthly_leads_limit,error:null}})}},17712:(e,a,t)=>{t.d(a,{KT:()=>n.KT,K_:()=>r.K_,ME:()=>r.ME,Rk:()=>i.Rk,SX:()=>r.SX,Tq:()=>s,ah:()=>n.ah,jz:()=>r.jz,s2:()=>r.publishCampaign}),t(85793);var r=t(75479),n=t(41131),i=t(2382);async function s(e){let{createCampaign:a}=await Promise.resolve().then(t.bind(t,75479)),{incrementCampaignUsage:r,canCreateCampaign:n}=await Promise.resolve().then(t.bind(t,2382)),i=await n();if(!i.success)return i;if(!i.data)return{success:!1,error:"Monthly campaign limit reached"};let s=await a(e);return s.success&&await r(),s}},41131:(e,a,t)=>{t.d(a,{KT:()=>i,ah:()=>s,createLead:()=>n});var r=t(85793);async function n(e){let a=(0,r.Rv)(e,["campaign_id","email"]);if(a.length>0)return{success:!1,error:"Validation failed",validation_errors:a};if(!(0,r.aJ)(e.campaign_id))return{success:!1,error:"Invalid campaign ID format"};if(!(0,r.B9)(e.email))return{success:!1,error:"Invalid email format",validation_errors:[{field:"email",message:"Please provide a valid email address",code:"INVALID_EMAIL",value:e.email}]};let t=await (0,r.AG)();return(0,r.Uj)(async()=>await t.from("leads").insert(e).select().single())}async function i(e){if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let a=await (0,r.AG)();return(0,r.Uj)(async()=>{let{count:t}=await a.from("leads").select("*",{count:"exact",head:!0}).eq("campaign_id",e),{count:r}=await a.from("leads").select("*",{count:"exact",head:!0}).eq("campaign_id",e).not("completed_at","is",null),{data:n}=await a.from("leads").select("*").eq("campaign_id",e).order("created_at",{ascending:!1}).limit(10),i=t||0,s=r||0;return{data:{total:i,completed:s,conversion_rate:Math.round(100*(i>0?s/i*100:0))/100,recent_leads:n||[]},error:null}})}async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await (0,r.oC)();let a=await (0,r.AG)(),{campaign_id:t,completed:n,search:i,...s}=e;return(0,r.Uj)(async()=>{let e=a.from("leads").select("\n        *,\n        campaigns!inner (*)\n      ",{count:"exact"});t&&(e=e.eq("campaign_id",t)),void 0!==n&&(e=n?e.not("completed_at","is",null):e.is("completed_at",null)),i&&(e=e.or("name.ilike.%".concat(i,"%,email.ilike.%").concat(i,"%,phone.ilike.%").concat(i,"%"))),e=(0,r.fu)(e,{sort_by:"created_at",sort_order:"desc",...s});let{data:o,error:c,count:l}=await e;if(c)return{data:null,error:c};let{page:d=1,per_page:u=20}=s,m=Math.ceil((l||0)/u);return{data:{data:o||[],meta:{total:l||0,page:d,per_page:u,has_more:d<m,total_pages:m}},error:null}})}},46414:(e,a,t)=>{t.d(a,{U:()=>n});var r=t(81935);function n(){return(0,r.createBrowserClient)("http://127.0.0.1:54321","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0")}},53999:(e,a,t)=>{t.d(a,{cn:()=>i});var r=t(52596),n=t(39688);function i(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,n.QP)((0,r.$)(a))}},71056:(e,a,t)=>{t.d(a,{G6:()=>l,Hh:()=>i,Jv:()=>s,UU:()=>n,Up:()=>d,f3:()=>c,xw:()=>o});var r=t(81935);function n(){return(0,r.createBrowserClient)("http://127.0.0.1:54321","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0")}async function i(e,a){let t=n(),{error:r}=await t.auth.signUp({email:e,password:a,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});return r?{success:!1,error:r.message}:{success:!0,message:"Check your email for a confirmation link to complete your signup."}}async function s(e,a){let t=n(),{error:r}=await t.auth.signInWithPassword({email:e,password:a});return r?{success:!1,error:r.message}:{success:!0,message:"Successfully signed in!"}}async function o(e){let a=n(),{error:t}=await a.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/auth/callback?next=/auth/update-password")});return t?{success:!1,error:t.message}:{success:!0,message:"Check your email for a password reset link."}}async function c(e){let a=n(),{error:t}=await a.auth.updateUser({password:e});return t?{success:!1,error:t.message}:{success:!0,message:"Password updated successfully!"}}async function l(){let e=n(),{error:a}=await e.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});return a?{success:!1,error:a.message}:{success:!0,message:"Redirecting to Google..."}}async function d(){let e=n(),{error:a}=await e.auth.signInWithOAuth({provider:"github",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});return a?{success:!1,error:a.message}:{success:!0,message:"Redirecting to GitHub..."}}},75479:(e,a,t)=>{t.d(a,{K_:()=>c,ME:()=>s,SX:()=>o,createCampaign:()=>n,jz:()=>i,publishCampaign:()=>l});var r=t(85793);async function n(e){let a=(0,r.Rv)(e,["name"]);if(a.length>0)return{success:!1,error:"Validation failed",validation_errors:a};let t=await (0,r.oC)(),n=await (0,r.AG)();return(0,r.Uj)(async()=>await n.from("campaigns").insert({...e,user_id:t}).select().single())}async function i(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let t=await (0,r.AG)();return(0,r.Uj)(async()=>{let r=t.from("campaigns").select(a?"\n        *,\n        sections (\n          *,\n          section_options (*)\n        ),\n        campaign_variables (*),\n        campaign_analytics (*)\n      ":"*").eq("id",e);return await r.single()})}async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=await (0,r.oC)(),t=await (0,r.AG)(),{status:n,search:i,...s}=e;return(0,r.Uj)(async()=>{let e=t.from("campaigns").select("*",{count:"exact"}).eq("user_id",a);n&&(e=e.eq("status",n)),i&&(e=e.or("name.ilike.%".concat(i,"%,description.ilike.%").concat(i,"%"))),e=(0,r.fu)(e,{sort_by:"created_at",...s});let{data:o,error:c,count:l}=await e;if(c)return{data:null,error:c};let{page:d=1,per_page:u=20}=s,m=Math.ceil((l||0)/u);return{data:{data:o||[],meta:{total:l||0,page:d,per_page:u,has_more:d<m,total_pages:m}},error:null}})}async function o(e,a){if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let t=await (0,r.AG)();return(0,r.Uj)(async()=>await t.from("campaigns").update({...a,updated_at:new Date().toISOString()}).eq("id",e).select().single())}async function c(e){if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let a=await (0,r.AG)();return(0,r.Uj)(async()=>{let{error:t}=await a.from("campaigns").delete().eq("id",e);return{data:!t,error:t}})}async function l(e,a){if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let t=await (0,r.AG)();return(0,r.Uj)(async()=>{let r={status:"published",published_at:new Date().toISOString(),updated_at:new Date().toISOString()};return a&&(r.published_url=a),await t.from("campaigns").update(r).eq("id",e).select().single()})}},76052:(e,a,t)=>{t.d(a,{A:()=>c,AuthProvider:()=>o});var r=t(95155),n=t(12115),i=t(71056);let s=(0,n.createContext)(void 0);function o(e){let{children:a}=e,[t,o]=(0,n.useState)(null),[c,l]=(0,n.useState)(!0),d=(0,i.UU)(),u=async()=>{try{let{data:{user:e},error:a}=await d.auth.getUser();a?(console.error("Error fetching user:",a),o(null)):o(e)}catch(e){console.error("Error in refreshUser:",e),o(null)}},m=async()=>{try{let{error:e}=await d.auth.signOut();e&&console.error("Error signing out:",e),o(null)}catch(e){console.error("Error in signOut:",e)}};return(0,n.useEffect)(()=>{(async()=>{await u(),l(!1)})();let{data:{subscription:e}}=d.auth.onAuthStateChange(async(e,a)=>{var t;console.log("Auth state changed:",e,null==a||null==(t=a.user)?void 0:t.email),(null==a?void 0:a.user)?o(a.user):o(null),l(!1)});return()=>{e.unsubscribe()}},[d.auth]),(0,r.jsx)(s.Provider,{value:{user:t,loading:c,signOut:m,refreshUser:u},children:a})}function c(){let e=(0,n.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},85793:(e,a,t)=>{t.d(a,{AG:()=>n,B9:()=>l,Rv:()=>o,Uj:()=>s,aJ:()=>c,fu:()=>d,oC:()=>m});var r=t(46414);async function n(){return(0,r.U)()}class i extends Error{constructor(e,a,t,r){super(e),this.code=a,this.details=t,this.validationErrors=r,this.name="DataAccessError"}}async function s(e){try{let{data:a,error:t}=await e();if(t){if(console.error("Database operation failed:",t),"PGRST116"===t.code)return{success:!1,error:"No records found"};if("23505"===t.code)return{success:!1,error:"Record already exists",validation_errors:[{field:"unique_constraint",message:"A record with this information already exists",code:"DUPLICATE_ENTRY"}]};if("23503"===t.code)return{success:!1,error:"Referenced record does not exist",validation_errors:[{field:"foreign_key",message:"The referenced record does not exist",code:"INVALID_REFERENCE"}]};return{success:!1,error:t.message||"Database operation failed"}}return{success:!0,data:a||void 0}}catch(e){return console.error("Unexpected error in database operation:",e),{success:!1,error:e instanceof Error?e.message:"Unexpected error occurred"}}}function o(e,a){let t=[];for(let r of a){let a=e[r];(null==a||""===a)&&t.push({field:r,message:"".concat(r," is required"),code:"REQUIRED_FIELD_MISSING",value:a})}return t}function c(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function l(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function d(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{page:t=1,per_page:r=20,sort_by:n,sort_order:i="desc"}=a,s=(t-1)*r;return e=e.range(s,s+r-1),n&&(e=e.order(n,{ascending:"asc"===i})),e}async function u(){let e=await n(),{data:{user:a}}=await e.auth.getUser();return(null==a?void 0:a.id)||null}async function m(){let e=await u();if(!e)throw new i("Authentication required","AUTH_REQUIRED");return e}},88145:(e,a,t)=>{t.d(a,{E:()=>c});var r=t(95155);t(12115);var n=t(99708),i=t(74466),s=t(53999);let o=(0,i.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:a,variant:t,asChild:i=!1,...c}=e,l=i?n.DX:"span";return(0,r.jsx)(l,{"data-slot":"badge",className:(0,s.cn)(o({variant:t}),a),...c})}},88482:(e,a,t)=>{t.d(a,{BT:()=>l,Wu:()=>d,ZB:()=>c,Zp:()=>s,aR:()=>o});var r=t(95155),n=t(12115),i=t(53999);let s=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground shadow",t),...n})});s.displayName="Card";let o=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...n})});o.displayName="CardHeader";let c=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,i.cn)("font-semibold leading-none tracking-tight",t),...n})});c.displayName="CardTitle";let l=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",t),...n})});l.displayName="CardDescription";let d=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,i.cn)("p-6 pt-0",t),...n})});d.displayName="CardContent",n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,i.cn)("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter"},97168:(e,a,t)=>{t.d(a,{$:()=>l});var r=t(95155),n=t(12115),i=t(99708),s=t(74466),o=t(53999);let c=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),l=n.forwardRef((e,a)=>{let{className:t,variant:n,size:s,asChild:l=!1,...d}=e,u=l?i.DX:"button";return(0,r.jsx)(u,{className:(0,o.cn)(c({variant:n,size:s,className:t})),ref:a,...d})});l.displayName="Button"}}]);