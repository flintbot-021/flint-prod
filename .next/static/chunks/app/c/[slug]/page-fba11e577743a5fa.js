(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[111],{1243:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},13052:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},14186:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},16785:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},34869:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},35695:(e,t,s)=>{"use strict";var r=s(18999);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},40646:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},42355:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},46414:(e,t,s)=>{"use strict";s.d(t,{U:()=>i});var r=s(81935);function i(){return(0,r.createBrowserClient)("http://127.0.0.1:54321","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0")}},47147:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var r=s(12115),i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},a=s(66977);let n=(0,r.forwardRef)((e,t)=>{let{color:s="currentColor",size:n=24,strokeWidth:o=2,absoluteStrokeWidth:c,className:l="",children:d,iconNode:h,...u}=e;return(0,r.createElement)("svg",{ref:t,...i,width:n,height:n,stroke:s,strokeWidth:c?24*Number(o)/Number(n):o,className:(0,a.zP)("lucide",l),...!d&&!(0,a.m$)(u)&&{"aria-hidden":"true"},...u},[...h.map(e=>{let[t,s]=e;return(0,r.createElement)(t,s)}),...Array.isArray(d)?d:[d]])})},49376:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]])},51154:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},51272:(e,t,s)=>{Promise.resolve().then(s.bind(s,92474))},53999:(e,t,s)=>{"use strict";s.d(t,{cn:()=>a});var r=s(52596),i=s(39688);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,r.$)(t))}},66977:(e,t,s)=>{"use strict";s.d(t,{MX:()=>a,fX:()=>r,m$:()=>o,zP:()=>n});let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),a=e=>{let t=i(e);return t.charAt(0).toUpperCase()+t.slice(1)},n=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim()},o=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0}},76517:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]])},81497:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},84109:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]])},85339:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},85793:(e,t,s)=>{"use strict";s.d(t,{AG:()=>i,B9:()=>l,Rv:()=>o,Uj:()=>n,aJ:()=>c,fu:()=>d,oC:()=>u});var r=s(46414);async function i(){return(0,r.U)()}class a extends Error{constructor(e,t,s,r){super(e),this.code=t,this.details=s,this.validationErrors=r,this.name="DataAccessError"}}async function n(e){try{let{data:t,error:s}=await e();if(s){if(console.error("Database operation failed:",s),"PGRST116"===s.code)return{success:!1,error:"No records found"};if("23505"===s.code)return{success:!1,error:"Record already exists",validation_errors:[{field:"unique_constraint",message:"A record with this information already exists",code:"DUPLICATE_ENTRY"}]};if("23503"===s.code)return{success:!1,error:"Referenced record does not exist",validation_errors:[{field:"foreign_key",message:"The referenced record does not exist",code:"INVALID_REFERENCE"}]};return{success:!1,error:s.message||"Database operation failed"}}return{success:!0,data:t||void 0}}catch(e){return console.error("Unexpected error in database operation:",e),{success:!1,error:e instanceof Error?e.message:"Unexpected error occurred"}}}function o(e,t){let s=[];for(let r of t){let t=e[r];(null==t||""===t)&&s.push({field:r,message:"".concat(r," is required"),code:"REQUIRED_FIELD_MISSING",value:t})}return s}function c(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function l(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{page:s=1,per_page:r=20,sort_by:i,sort_order:a="desc"}=t,n=(s-1)*r;return e=e.range(n,n+r-1),i&&(e=e.order(i,{ascending:"asc"===a})),e}async function h(){let e=await i(),{data:{user:t}}=await e.auth.getUser();return(null==t?void 0:t.id)||null}async function u(){let e=await h();if(!e)throw new a("Authentication required","AUTH_REQUIRED");return e}},88145:(e,t,s)=>{"use strict";s.d(t,{E:()=>c});var r=s(95155);s(12115);var i=s(99708),a=s(74466),n=s(53999);let o=(0,a.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:s,asChild:a=!1,...c}=e,l=a?i.DX:"span";return(0,r.jsx)(l,{"data-slot":"badge",className:(0,n.cn)(o({variant:s}),t),...c})}},90602:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var r=s(12115),i=s(66977),a=s(47147);let n=(e,t)=>{let s=(0,r.forwardRef)((s,n)=>{let{className:o,...c}=s;return(0,r.createElement)(a.A,{ref:n,iconNode:t,className:(0,i.zP)("lucide-".concat((0,i.fX)((0,i.MX)(e))),"lucide-".concat(e),o),...c})});return s.displayName=(0,i.MX)(e),s}},92474:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eN});var r,i=s(95155),a=s(12115),n=s(35695),o=s(85793),c=s(53999),l=s(97168),d=s(88145),h=s(49376),u=s(51154),p=s(40646),m=s(14186),g=s(16785),f=s(81497),y=s(85339),v=s(76517),x=s(94449),b=s(1243),w=s(84109),E=s(34869),S=s(42355),T=s(13052);class N{register(e){let t=new Date,s={...e,createdAt:t,updatedAt:t};if(this.validateMetadata(s),this.variables.has(e.id))throw Error("Variable '".concat(e.id,"' is already registered"));this.variables.set(e.id,s),void 0!==e.defaultValue&&this.values.set(e.id,e.defaultValue),console.log("Variable registered: ".concat(e.id," (").concat(e.type,")"))}unregister(e){if(!this.variables.has(e))throw Error("Variable '".concat(e,"' is not registered"));for(let[t,s]of(this.variables.delete(e),this.values.delete(e),this.dependencies.delete(e),this.dependents.delete(e),this.dependencies.entries()))s.delete(e);for(let[t,s]of this.dependents.entries())s.delete(e);console.log("Variable unregistered: ".concat(e))}getVariable(e){return this.variables.get(e)}getAllVariables(){return Array.from(this.variables.values())}getVariablesByNamespace(e){return Array.from(this.variables.values()).filter(t=>t.namespace===e)}getVariablesBySource(e){return Array.from(this.variables.values()).filter(t=>t.sourceSection===e)}setValue(e,t){let s=this.variables.get(e);if(!s)throw Error("Variable '".concat(e,"' is not registered"));let r=this.validateValue(e,t);if(!r.isValid)throw Error("Invalid value for variable '".concat(e,"': ").concat(r.errors.join(", ")));this.values.set(e,t),s.updatedAt=new Date,console.log("Variable value updated: ".concat(e," = ").concat(JSON.stringify(t)))}getValue(e){if(!this.variables.has(e))throw Error("Variable '".concat(e,"' is not registered"));let t=this.values.get(e),s=this.variables.get(e);return void 0!==t?t:s.defaultValue}hasVariable(e){return this.variables.has(e)}validateValue(e,t){let s=this.variables.get(e);if(!s)return{isValid:!1,errors:["Variable '".concat(e,"' is not registered")],warnings:[]};let r=[],i=[];if(this.validateType(t,s.type)||r.push("Expected type ".concat(s.type,", got ").concat(typeof t)),s.required&&(null==t||""===t)&&r.push("Variable '".concat(e,"' is required")),s.validation)for(let e of s.validation){let s=this.validateRule(t,e);s.isValid||(r.push(...s.errors),i.push(...s.warnings))}return{isValid:0===r.length,errors:r,warnings:i}}clear(){this.variables.clear(),this.values.clear(),this.dependencies.clear(),this.dependents.clear(),console.log("Variable registry cleared")}getDependencies(e){return Array.from(this.dependencies.get(e)||[])}getDependents(e){return Array.from(this.dependents.get(e)||[])}validateMetadata(e){if(!e.id)throw Error("Variable ID is required");if(!e.name)throw Error("Variable name is required");if(!e.sourceSection)throw Error("Variable source section is required");if(!this.isValidVariableType(e.type))throw Error("Invalid variable type: ".concat(e.type))}validateType(e,t){if(null==e)return!0;switch(t){case"string":return"string"==typeof e;case"number":return"number"==typeof e&&!isNaN(e);case"boolean":return"boolean"==typeof e;case"array":return Array.isArray(e);case"object":return"object"==typeof e&&!Array.isArray(e);case"date":return e instanceof Date||!isNaN(Date.parse(e));case"email":return"string"==typeof e&&this.isValidEmail(e);case"phone":return"string"==typeof e&&this.isValidPhone(e);case"url":return"string"==typeof e&&this.isValidUrl(e);default:return!1}}validateRule(e,t){let s=[],r=[];switch(t.type){case"min_length":"string"==typeof e&&e.length<t.config.length&&s.push(t.message||"Minimum length is ".concat(t.config.length));break;case"max_length":"string"==typeof e&&e.length>t.config.length&&s.push(t.message||"Maximum length is ".concat(t.config.length));break;case"pattern":"string"!=typeof e||new RegExp(t.config.pattern).test(e)||s.push(t.message||"Value does not match required pattern");break;case"range":"number"==typeof e&&(void 0!==t.config.min&&e<t.config.min&&s.push(t.message||"Value must be at least ".concat(t.config.min)),void 0!==t.config.max&&e>t.config.max&&s.push(t.message||"Value must be at most ".concat(t.config.max)));break;case"custom":if(t.config.validator&&"function"==typeof t.config.validator)try{t.config.validator(e)||s.push(t.message||"Custom validation failed")}catch(e){s.push(t.message||"Custom validation error: ".concat(e))}break;default:r.push("Unknown validation rule type: ".concat(t.type))}return{isValid:0===s.length,errors:s,warnings:r}}isValidVariableType(e){return["string","number","boolean","array","object","date","email","phone","url"].includes(e)}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidPhone(e){return/^[\+]?[1-9][\d]{0,15}$/.test(e.replace(/[\s\-\(\)]/g,""))}isValidUrl(e){try{return new URL(e),!0}catch(e){return!1}}constructor(){this.variables=new Map,this.values=new Map,this.dependencies=new Map,this.dependents=new Map}}new N;class A{register(e){let t=e.type.id;this.validateConfig(e),this.sectionTypes.has(t)&&console.warn("Section type '".concat(t,"' is already registered. Overwriting...")),this.sectionTypes.set(t,e.type),this.sectionConfigs.set(t,e),console.log("Section type registered: ".concat(t," (").concat(e.type.name,")"))}unregister(e){if(!this.sectionTypes.has(e))throw Error("Section type '".concat(e,"' is not registered"));this.sectionTypes.delete(e),this.sectionConfigs.delete(e),console.log("Section type unregistered: ".concat(e))}getType(e){return this.sectionTypes.get(e)}getTypes(){return Array.from(this.sectionTypes.values())}getTypesByCategory(e){return Array.from(this.sectionTypes.values()).filter(t=>t.category===e)}getConfig(e){return this.sectionConfigs.get(e)}hasType(e){return this.sectionTypes.has(e)}createSection(e,t){let s=this.sectionTypes.get(e),r=this.sectionConfigs.get(e);if(!s||!r)return void console.error("Section type '".concat(e,"' is not registered"));let i={type:e,...s.defaultSettings,...t},a=r.initializer?r.initializer(i):i;return{id:this.generateSectionId(),type:e,settings:a,order:0,isVisible:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),getVariableProducers:()=>[],getVariableConsumers:()=>[],validate:()=>r.validator?r.validator(a):{isValid:!0,errors:[],warnings:[]}}}validateConfig(e){if(this.validateTypeDefinition(e.type),!e.component)throw Error("Section type '".concat(e.type.id,"' must have a component"));if(!e.type.version||!this.isValidVersion(e.type.version))throw Error("Section type '".concat(e.type.id,"' must have a valid version"))}validateTypeDefinition(e){if(!e.id)throw Error("Section type ID is required");if(!e.name)throw Error("Section type name is required");if(!e.description)throw Error("Section type description is required");if(!e.icon)throw Error("Section type icon is required");if(!["input","content","logic","output"].includes(e.category))throw Error("Invalid section category: ".concat(e.category));if(!e.color)throw Error("Section type color is required")}isValidVersion(e){return/^\d+\.\d+\.\d+$/.test(e)}generateSectionId(){return"section_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}constructor(){this.sectionTypes=new Map,this.sectionConfigs=new Map}}new A;class j{addDependency(e,t){if(!e||!t)throw Error("Both dependent and dependency must be provided");if(e===t)throw Error("An item cannot depend on itself");if(this.wouldCreateCycle(e,t))throw Error("Adding dependency '".concat(e," -> ").concat(t,"' would create a circular dependency"));this.dependencies.has(e)||this.dependencies.set(e,new Set),this.dependencies.get(e).add(t),this.dependents.has(t)||this.dependents.set(t,new Set),this.dependents.get(t).add(e),this.invalidateTransitiveCache(),console.log("Dependency added: ".concat(e," -> ").concat(t))}removeDependency(e,t){let s=this.dependencies.get(e);s&&(s.delete(t),0===s.size&&this.dependencies.delete(e));let r=this.dependents.get(t);r&&(r.delete(e),0===r.size&&this.dependents.delete(t)),this.invalidateTransitiveCache(),console.log("Dependency removed: ".concat(e," -> ").concat(t))}getDependencies(e){return Array.from(this.dependencies.get(e)||[])}getDependents(e){return Array.from(this.dependents.get(e)||[])}getTransitiveDependencies(e){let t=this.transitiveDependenciesCache.get(e);if(t)return t;let s=new Set,r=[],i=e=>{if(!s.has(e))for(let t of(s.add(e),this.getDependencies(e)))r.includes(t)||r.push(t),i(t)};return i(e),this.transitiveDependenciesCache.set(e,r),r}hasCircularDependency(e){return this.findCycles().some(t=>t.includes(e))}getDependencyGraph(){let e=new Map;for(let[t,s]of this.dependencies.entries())e.set(t,Array.from(s));return e}getRemovalImpact(e){let t=new Set;this.getDependents(e).forEach(e=>t.add(e));let s=new Set,r=e=>{for(let i of this.getDependents(e))s.has(i)||(s.add(i),t.add(i),r(i))};return r(e),Array.from(t)}validateGraph(){let e=[],t=[],s=this.findCycles();s.length>0&&e.push(...s.map(e=>"Circular dependency detected: ".concat(e.join(" -> "))));let r=new Set;for(let[e,t]of this.dependencies.entries())r.add(e),t.forEach(e=>r.add(e));for(let e of r){let s=this.dependencies.has(e),r=this.dependents.has(e);s||r||t.push("Item '".concat(e,"' has no dependencies or dependents"))}let i=new Set;for(let e of this.getRootItems()){let t=this.getTransitiveDependencies(e);i.add(e),t.forEach(e=>i.add(e))}for(let e of r)i.has(e)||t.push("Item '".concat(e,"' is not reachable from any root item"));return{isValid:0===e.length,errors:e,warnings:t}}getTopologicalOrder(){let e=this.getDependencyGraph(),t=new Set,s=new Set,r=[],i=a=>{if(s.has(a))throw Error("Circular dependency detected involving: ".concat(a));if(!t.has(a)){for(let t of(s.add(a),e.get(a)||[]))i(t);s.delete(a),t.add(a),r.unshift(a)}},a=new Set;for(let[t,s]of e.entries())a.add(t),s.forEach(e=>a.add(e));for(let e of a)t.has(e)||i(e);return r}clear(){this.dependencies.clear(),this.dependents.clear(),this.transitiveDependenciesCache.clear(),this.lastGraphVersion=0,console.log("Dependency tracker cleared")}getStatistics(){let e=new Set,t=0;for(let[s,r]of this.dependencies.entries())e.add(s),t+=r.size,r.forEach(t=>e.add(t));for(let[t]of this.dependents.entries())e.add(t);let s=Array.from(e).map(e=>{var t;return(null==(t=this.dependencies.get(e))?void 0:t.size)||0}),r=Array.from(e).filter(e=>{var t;return 0===((null==(t=this.dependencies.get(e))?void 0:t.size)||0)}).length,i=Array.from(e).filter(e=>{var t;return 0===((null==(t=this.dependents.get(e))?void 0:t.size)||0)}).length;return{totalItems:e.size,totalDependencies:t,averageDependencies:e.size>0?t/e.size:0,maxDependencies:Math.max(...s,0),rootItems:r,leafItems:i,cycles:this.findCycles().length}}wouldCreateCycle(e,t){return this.getTransitiveDependencies(t).includes(e)}findCycles(){let e=[],t=new Set,s=new Set,r=[],i=a=>{if(s.has(a)){let t=r.indexOf(a);if(t>=0){let s=r.slice(t).concat([a]);e.push(s)}return!0}if(t.has(a))return!1;for(let e of(t.add(a),s.add(a),r.push(a),this.dependencies.get(a)||new Set))i(e);return s.delete(a),r.pop(),!1},a=new Set;for(let[e,t]of this.dependencies.entries())a.add(e),t.forEach(e=>a.add(e));for(let e of a)t.has(e)||i(e);return e}getRootItems(){let e=new Set;for(let[t,s]of this.dependencies.entries())e.add(t),s.forEach(t=>e.add(t));return Array.from(e).filter(e=>{var t;return 0===((null==(t=this.dependencies.get(e))?void 0:t.size)||0)})}invalidateTransitiveCache(){this.transitiveDependenciesCache.clear(),this.lastGraphVersion++}constructor(){this.dependencies=new Map,this.dependents=new Map,this.transitiveDependenciesCache=new Map,this.lastGraphVersion=0}}let k=new j;class C{getErrorMessage(e){return this.config.message||"Validation failed for value: ".concat(e)}isAsync(){return!0===this.config.async}constructor(e={}){this.config={stopOnFirstError:!1,async:!1,...e}}}class V extends C{addValidator(e){return this.validators.push(e),e.isAsync()&&(this.config.async=!0),this}addValidators(e){return e.forEach(e=>this.addValidator(e)),this}async validate(e,t){for(let s of this.validators){let r=await s.validate(e,t);if(!r&&this.config.stopOnFirstError||!r)return!1}return!0}async validateWithDetails(e,t){let s=[];for(let r of this.validators)try{if(!await r.validate(e,t)&&(s.push(r.getErrorMessage(e)),this.config.stopOnFirstError))break}catch(e){s.push("Validation error: ".concat(e))}return{isValid:0===s.length,errors:s,warnings:[]}}constructor(e={}){super(e),this.validators=[]}}class I extends C{validate(e){return"string"==typeof e&&(void 0===this.minLength||!(e.length<this.minLength))&&(void 0===this.maxLength||!(e.length>this.maxLength))}getErrorMessage(e){if(this.config.message)return this.config.message;let t="string"==typeof e?e.length:"N/A";return"String length ".concat(t," is not between ").concat(this.minLength||0," and ").concat(this.maxLength||"∞")}constructor(e,t,s={}){super(s),this.minLength=e,this.maxLength=t}}class M extends C{validate(e){return!("number"!=typeof e||isNaN(e))&&(void 0===this.min||!(e<this.min))&&(void 0===this.max||!(e>this.max))}getErrorMessage(e){return this.config.message?this.config.message:"Number ".concat(e," is not between ").concat(this.min||"-∞"," and ").concat(this.max||"∞")}constructor(e,t,s={}){super(s),this.min=e,this.max=t}}class D extends C{validate(e){return"string"==typeof e&&this.regex.test(e)}getErrorMessage(e){return this.config.message?this.config.message:'Value "'.concat(e,'" does not match required pattern')}constructor(e,t={}){super(t),this.regex="string"==typeof e?new RegExp(e):e}}class _ extends C{async validate(e,t){try{let s=this.validatorFn(e,t);return s instanceof Promise?await s:s}catch(e){return console.error("Custom validator error:",e),!1}}constructor(e,t={}){super(t),this.validatorFn=e}}class R extends C{async validate(e,t){if(!Array.isArray(e)||void 0!==this.minItems&&e.length<this.minItems||void 0!==this.maxItems&&e.length>this.maxItems)return!1;if(this.itemValidator){for(let s of e)if(!await this.itemValidator.validate(s,t))return!1}return!0}getErrorMessage(e){if(this.config.message)return this.config.message;let t=Array.isArray(e)?e.length:"N/A";return"Array length ".concat(t," is not between ").concat(this.minItems||0," and ").concat(this.maxItems||"∞")}constructor(e,t,s,r={}){super(r),this.itemValidator=e,this.minItems=t,this.maxItems=s}}class O{registerValidator(e,t){this.validators.set(e,t)}registerSchema(e,t){this.schemas.set(e,t);let s=this.createValidatorFromSchema(t);this.validators.set(e,s)}addCrossVariableValidator(e){this.crossVariableValidators.push(e)}async validateVariable(e,t,s){let r=this.validators.get(e);return r?await r.validateWithDetails(t,s):{isValid:!0,errors:[],warnings:[]}}async validateVariables(e,t){let s=[],r=[];for(let[i,a]of Object.entries(e)){let e=await this.validateVariable(i,a,t);s.push(...e.errors),r.push(...e.warnings)}for(let r of this.crossVariableValidators)try{let i=r.variables.reduce((t,s)=>(s in e&&(t[s]=e[s]),t),{});Object.keys(i).length===r.variables.length&&(await r.validator(i,t)||s.push(r.message||"Cross-variable validation failed: ".concat(r.name)))}catch(e){s.push("Cross-variable validation error: ".concat(e))}return{isValid:0===s.length,errors:s,warnings:r}}createValidatorFromSchema(e){let t=new V;return t.addValidator(new _(t=>this.validateType(t,e.type),{message:"Expected type ".concat(e.type)})),e.validators&&t.addValidators(e.validators),t}validateType(e,t){switch(t){case"string":return"string"==typeof e;case"number":return"number"==typeof e&&!isNaN(e);case"boolean":return"boolean"==typeof e;case"array":return Array.isArray(e);case"object":return"object"==typeof e&&null!==e&&!Array.isArray(e);case"date":return e instanceof Date||!isNaN(Date.parse(e));case"email":return"string"==typeof e&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);case"phone":return"string"==typeof e&&/^[\+]?[1-9][\d]{0,15}$/.test(e.replace(/[\s\-\(\)]/g,""));case"url":try{return new URL(e),!0}catch(e){return!1}default:return!1}}constructor(){this.validators=new Map,this.crossVariableValidators=[],this.schemas=new Map}}let P=new O;class z{createSession(e){let t=this.generateSessionId(),s={sessionId:t,userId:e,startTime:new Date,responses:{},metadata:{}};return this.sessions.set(t,s),s}getSession(e){return this.sessions.get(e)}updateSession(e,t){let s=this.sessions.get(e);s&&Object.assign(s,t)}deleteSession(e){this.sessions.delete(e)}addResponse(e,t,s){let r=this.sessions.get(e);r&&(r.responses[t]=s)}setLeadData(e,t){let s=this.sessions.get(e);s&&(s.leadData=t)}generateSessionId(){return"session_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}constructor(){this.sessions=new Map}}class L{async resolveVariable(e){if(this.cache.has(e))return this.cache.get(e);if(this.resolving.has(e))throw Error("Circular dependency detected while resolving variable: ".concat(e));this.resolving.add(e);try{let t=this.variableRegistry.getVariable(e);if(!t)throw Error("Variable '".concat(e,"' is not registered"));let s=this.variableRegistry.getValue(e);void 0===s&&(s=await this.resolveFromDependencies(e)),void 0===s&&(s=t.defaultValue);let r=await P.validateVariable(e,s,this.context);if(!r.isValid)throw Error("Variable validation failed: ".concat(r.errors.join(", ")));return this.cache.set(e,s),s}finally{this.resolving.delete(e)}}async resolveVariables(e){let t={};for(let s of this.getResolutionOrder(e))try{t[s]=await this.resolveVariable(s)}catch(e){console.error("Failed to resolve variable ".concat(s,":"),e)}return t}clearCache(){this.cache.clear()}invalidateVariable(e){for(let t of(this.cache.delete(e),k.getDependents(e)))this.cache.delete(t)}async resolveFromDependencies(e){let t=k.getDependencies(e),s={};for(let e of t)s[e]=await this.resolveVariable(e)}getResolutionOrder(e){try{let t=k.getTopologicalOrder();return e.sort((e,s)=>{let r=t.indexOf(e),i=t.indexOf(s);return(-1===r?1/0:r)-(-1===i?1/0:i)})}catch(t){return console.warn("Failed to get topological order, using original order:",t),e}}constructor(e,t){this.variableRegistry=e,this.context=t,this.cache=new Map,this.resolving=new Set}}class U{async executeSection(e){let t=Date.now();try{this.recordSectionStart(e);let s=this.context.variables.getVariablesBySource(e),r=new Set;for(let e of s)k.getDependencies(e.id).forEach(e=>r.add(e));r.size>0&&await this.resolver.resolveVariables(Array.from(r));let i=Date.now()-t;this.recordSectionCompletion(e,i)}catch(r){let s=Date.now()-t;throw this.recordSectionError(e,s,r),r}}async populateVariable(e,t){let s=Date.now();try{let r=await P.validateVariable(e,t,this.context);if(!r.isValid)throw Error("Variable validation failed: ".concat(r.errors.join(", ")));this.context.variables.setValue(e,t),this.resolver.invalidateVariable(e);let i=Date.now()-s;this.metrics.variableLookupTimes[e]=i}catch(t){throw console.error("Failed to populate variable ".concat(e,":"),t),t}}async resolveVariable(e){let t=Date.now();try{let s=await this.resolver.resolveVariable(e),r=Date.now()-t;return this.metrics.variableLookupTimes[e]=r,s}catch(t){throw console.error("Failed to resolve variable ".concat(e,":"),t),t}}getMetrics(){return{...this.metrics}}reset(){this.resolver.clearCache(),this.isRunning=!1,this.context.executionHistory=[],this.resetMetrics()}recordSectionStart(e){this.context.currentSection=e}recordSectionCompletion(e,t){let s={sectionId:e,timestamp:new Date,variablesProduced:{},duration:t};this.context.executionHistory.push(s),this.metrics.sectionRenderTimes[e]=t,this.metrics.totalTime+=t}recordSectionError(e,t,s){let r={sectionId:e,timestamp:new Date,variablesProduced:{},duration:t,errors:[s.message]};this.context.executionHistory.push(r),this.metrics.sectionRenderTimes[e]=t,this.metrics.totalTime+=t}resetMetrics(){this.metrics.totalTime=0,this.metrics.variableLookupTimes={},this.metrics.sectionRenderTimes={},this.metrics.memoryUsage={variableCount:0,totalVariableSize:0,cacheHitRate:0}}constructor(e){this.context=e,this.isRunning=!1,this.resolver=new L(e.variables,e),this.metrics=e.metrics}}new z;class F{tokenize(){let e=[];for(this.position=0,this.line=1,this.column=1;this.position<this.input.length;){let t=this.nextToken();t&&e.push(t)}return e.push({type:"EOF",value:"",position:{start:this.position,end:this.position}}),e}nextToken(){if(this.skipWhitespace(),this.position>=this.input.length)return null;this.position;let e=this.currentChar();switch(e){case"@":return this.createToken("AT",this.advance());case".":return this.createToken("DOT",this.advance());case"|":return this.createToken("PIPE",this.advance());case":":return this.createToken("COLON",this.advance());case"?":return this.createToken("QUESTION",this.advance());case"!":return this.createToken("EXCLAMATION",this.advance());case"(":return this.createToken("LPAREN",this.advance());case")":return this.createToken("RPAREN",this.advance());case"{":return this.createToken("LBRACE",this.advance());case"}":return this.createToken("RBRACE",this.advance());case",":return this.createToken("COMMA",this.advance())}return'"'===e||"'"===e?this.tokenizeString(e):this.isDigit(e)?this.tokenizeNumber():this.isAlpha(e)||"_"===e?this.tokenizeIdentifier():this.createToken("UNKNOWN",this.advance())}tokenizeString(e){let t=this.position;this.advance();let s="",r=!1;for(;this.position<this.input.length;){let t=this.currentChar();if(r)s+=t,r=!1;else if("\\"===t)r=!0;else if(t===e){this.advance();break}else s+=t;this.advance()}return{type:"STRING",value:s,position:{start:t,end:this.position}}}tokenizeNumber(){let e=this.position,t="",s=!1;for(;this.position<this.input.length;){let e=this.currentChar();if(this.isDigit(e))t+=e,this.advance();else if("."!==e||s)break;else s=!0,t+=e,this.advance()}return{type:"NUMBER",value:t,position:{start:e,end:this.position}}}tokenizeIdentifier(){let e=this.position,t="";for(;this.position<this.input.length;){let e=this.currentChar();if(this.isAlphaNumeric(e)||"_"===e)t+=e,this.advance();else break}let s="IDENTIFIER";switch(t.toLowerCase()){case"if":s="IF";break;case"then":s="THEN";break;case"else":s="ELSE";break;case"true":case"false":s="BOOLEAN"}return{type:s,value:t,position:{start:e,end:this.position}}}skipWhitespace(){for(;this.position<this.input.length&&this.isWhitespace(this.currentChar());)"\n"===this.currentChar()?(this.line++,this.column=1):this.column++,this.position++}currentChar(){return this.input[this.position]||""}advance(){let e=this.currentChar();return this.position++,this.column++,e}createToken(e,t){return{type:e,value:t,position:{start:this.position-t.length,end:this.position}}}isWhitespace(e){return/\s/.test(e)}isDigit(e){return/\d/.test(e)}isAlpha(e){return/[a-zA-Z]/.test(e)}isAlphaNumeric(e){return/[a-zA-Z0-9]/.test(e)}constructor(e){this.input=e,this.position=0,this.line=1,this.column=1}}class q{parse(e){let t,s=[],r=new Set;this.errors=[];let i=/@\{[^}]*\}|@[a-zA-Z_][a-zA-Z0-9_]*/g;for(;null!==(t=i.exec(e));)try{let e=t[0],i={start:t.index,end:t.index+e.length},a=this.parseInterpolationExpression(e,i.start),n={type:"interpolation",expression:a,rawText:e,position:i};s.push(n),this.extractDependencies(a,r)}catch(e){this.addError("Failed to parse interpolation: ".concat(e),{start:t.index,end:t.index+t[0].length},"error")}return{success:0===this.errors.filter(e=>"error"===e.severity).length,interpolations:s,dependencies:Array.from(r),errors:this.errors,originalText:e}}parseInterpolationExpression(e,t){let s=e.slice(1);s.startsWith("{")&&s.endsWith("}")&&(s=s.slice(1,-1));let r=new F(s);return this.tokens=r.tokenize(),this.position=0,this.parseExpression()}parseExpression(){return this.parseConditional()}parseConditional(){let e=this.parsePipe();if(this.match("QUESTION")){let t,s=this.parseExpression();this.match("COLON")&&(t=this.parseExpression());let r=e.position.start,i=t?t.position.end:s.position.end;return{type:"conditional",condition:e,thenBranch:s,elseBranch:t,position:{start:r,end:i}}}return e}parsePipe(){let e=this.parseFunction();for(;this.match("PIPE");){let t=this.consume("IDENTIFIER","Expected function name after pipe"),s=[e];this.match("LPAREN")&&(s.push(...this.parseArgumentList()),this.consume("RPAREN","Expected closing parenthesis"));let r=e.position.start,i=this.previous().position.end;e={type:"function",name:t.value,arguments:s,position:{start:r,end:i}}}return e}parseFunction(){return this.parsePrimary()}parsePrimary(){let e=this.peek();if(this.match("IDENTIFIER")){let e=this.previous().value,t=this.previous().position.start,s=this.previous().position.end;if(this.match("LPAREN")){let r=this.parseArgumentList();return this.consume("RPAREN","Expected closing parenthesis"),{type:"function",name:e,arguments:r,position:{start:t,end:s=this.previous().position.end}}}return{type:"variable",name:e,position:{start:t,end:s}}}if(this.match("STRING"))return{type:"literal",value:this.previous().value,position:this.previous().position};if(this.match("NUMBER"))return{type:"literal",value:parseFloat(this.previous().value),position:this.previous().position};if(this.match("BOOLEAN"))return{type:"literal",value:"true"===this.previous().value,position:this.previous().position};if(this.match("LPAREN")){let e=this.parseExpression();return this.consume("RPAREN","Expected closing parenthesis"),e}throw Error("Unexpected token: ".concat(e.type))}parseArgumentList(){let e=[];if(!this.check("RPAREN"))do e.push(this.parseExpression());while(this.match("COMMA"));return e}extractDependencies(e,t){switch(e.type){case"variable":t.add(e.name);break;case"conditional":this.extractDependencies(e.condition,t),this.extractDependencies(e.thenBranch,t),e.elseBranch&&this.extractDependencies(e.elseBranch,t);break;case"function":e.arguments.forEach(e=>this.extractDependencies(e,t))}}match(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];for(let e of t)if(this.check(e))return this.advance(),!0;return!1}check(e){return!this.isAtEnd()&&this.peek().type===e}advance(){return!this.isAtEnd()&&this.position++,this.previous()}isAtEnd(){return"EOF"===this.peek().type}peek(){return this.tokens[this.position]||this.tokens[this.tokens.length-1]}previous(){return this.tokens[this.position-1]}consume(e,t){if(this.check(e))return this.advance();let s=this.peek();throw this.addError(t,s.position,"error"),Error(t)}addError(e,t,s){this.errors.push({message:e,position:t,severity:s})}constructor(){this.tokens=[],this.position=0,this.errors=[]}}function B(e){return new q().parse(e)}class H{async analyzeAndRegisterDependencies(e,t,s){let r=[],i=[];try{let s=B(t);for(let t of(s.success||r.push(...s.errors.map(e=>e.message)),s.dependencies))try{this.dependencyTracker.addDependency(e,t)}catch(s){s instanceof Error&&s.message.includes("circular")?r.push("Circular dependency detected: ".concat(e," -> ").concat(t)):r.push("Failed to register dependency: ".concat(s))}let a=this.dependencyTracker.validateGraph();return r.push(...a.errors),i.push(...a.warnings),{isValid:0===r.length,errors:r,warnings:i}}catch(e){return{isValid:!1,errors:["Failed to analyze dependencies: ".concat(e)],warnings:i}}}createExecutionPlan(e){try{let t=this.dependencyTracker.getTopologicalOrder(),s=new Set;for(let t of e)s.add(t),this.dependencyTracker.getTransitiveDependencies(t).forEach(e=>s.add(e));let r=t.filter(e=>s.has(e)),i=this.createBatchGroups(r),a=this.estimateExecutionTime(r);return this.executionPlan={executionOrder:r,batchGroups:i,estimatedTime:a,parallelizable:i.length>1},this.executionPlan}catch(t){return console.error("Failed to create execution plan:",t),{executionOrder:e,batchGroups:[e],estimatedTime:100*e.length,parallelizable:!1}}}async resolveVariable(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",r=Date.now();try{let i=this.resolutionCache.get(e);if(i&&this.isCacheValid(i))return{...i,executionTimeMs:Date.now()-r};let a=this.strategies.get(s);if(!a)throw Error("Unknown resolution strategy: ".concat(s));let n=this.dependencyTracker.getDependencies(e),o={};for(let e of n){let r=await this.resolveVariable(e,t,s);if(!r.success)throw Error("Failed to resolve dependency '".concat(e,"': ").concat(r.error));o[e]=r.value}let c=await a.resolve(e,t),l={success:!0,value:c,dependencies:n,executionTimeMs:Date.now()-r};return this.resolutionCache.set(e,l),l}catch(t){return{success:!1,error:t instanceof Error?t.message:String(t),dependencies:this.dependencyTracker.getDependencies(e),executionTimeMs:Date.now()-r}}}async resolveVariables(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",r={};for(let i of this.createExecutionPlan(e).batchGroups){let e=i.map(async e=>{let r=await this.resolveVariable(e,t,s);return{variableId:e,result:r}});for(let t of(await Promise.allSettled(e)))if("fulfilled"===t.status){let{variableId:e,result:s}=t.value;r[e]=s}else console.error("Batch resolution failed:",t.reason)}return r}getDependencyGraph(){let e=new Map,t=new Map,s=this.dependencyTracker.getDependencyGraph(),r=new Set;for(let[e,i]of s.entries())r.add(e),i.forEach(e=>r.add(e)),t.set(e,i);let i=0;for(let t of r){var a;let s=this.dependencyTracker.getDependencies(t),r=this.dependencyTracker.getDependents(t);e.set(t,{id:t,type:this.inferNodeType(t),dependencies:s,dependents:r,resolved:this.resolutionCache.has(t),lastResolvedAt:this.resolutionCache.get(t)?new Date:void 0,cachedValue:null==(a=this.resolutionCache.get(t))?void 0:a.value,executionOrder:i++,interpolations:[]})}return{nodes:e,edges:t,roots:Array.from(r).filter(e=>0===this.dependencyTracker.getDependencies(e).length),leaves:Array.from(r).filter(e=>0===this.dependencyTracker.getDependents(e).length)}}invalidateCache(e){for(let t of(this.resolutionCache.delete(e),this.dependencyTracker.getDependents(e)))this.invalidateCache(t)}reset(){this.resolutionCache.clear(),this.executionPlan=void 0}getStatistics(){let e=Array.from(this.resolutionCache.values()),t=e.filter(e=>e.success);return{cachedVariables:this.resolutionCache.size,totalResolutions:e.length,averageResolutionTime:t.length>0?t.reduce((e,t)=>e+t.executionTimeMs,0)/t.length:0,cacheHitRate:e.length>0?t.length/e.length:0,dependencyGraphStats:this.dependencyTracker.getStatistics()}}initializeDefaultStrategies(){this.strategies.set("default",{name:"default",description:"Resolve from variable registry",resolve:async(e,t)=>{let s=t.variables.getValue(e);if(void 0===s){let s=t.variables.getVariable(e);return null==s?void 0:s.defaultValue}return s}}),this.strategies.set("lazy",{name:"lazy",description:"Resolve only when explicitly requested",resolve:async(e,t)=>t.variables.getValue(e)}),this.strategies.set("eager",{name:"eager",description:"Pre-resolve all dependencies",resolve:async(e,t)=>t.variables.getValue(e)})}createBatchGroups(e){let t=[],s=new Set;for(;s.size<e.length;){let r=[];for(let t of e)!s.has(t)&&this.dependencyTracker.getDependencies(t).every(e=>s.has(e))&&(r.push(t),s.add(t));if(0===r.length)break;t.push(r)}return t}estimateExecutionTime(e){return 50+25*e.length}isCacheValid(e){return e.success&&Date.now()-e.executionTimeMs<6e4}inferNodeType(e){return e.includes(".")?"computed":e.startsWith("section_")?"section":"variable"}constructor(){this.resolutionCache=new Map,this.strategies=new Map,this.dependencyTracker=k,this.initializeDefaultStrategies()}}new H;class G{async evaluateExpression(e,t){let s=Date.now(),r=[];try{let i=await this.evaluateNode(e,t,r);return{success:!0,value:i,usedVariables:r,executionTime:Date.now()-s}}catch(e){return{success:!1,value:void 0,error:e instanceof Error?e.message:String(e),usedVariables:r,executionTime:Date.now()-s}}}async evaluateText(e,t){let s=Date.now(),r=[];try{let i=B(e);if(!i.success)throw Error("Parse error: ".concat(i.errors.map(e=>e.message).join(", ")));let a=e;for(let e of i.interpolations){let s=await this.evaluateExpression(e.expression,t);if(!s.success)throw Error("Evaluation error in '".concat(e.rawText,"': ").concat(s.error));r.push(...s.usedVariables);let i=this.formatValue(s.value);a=a.replace(e.rawText,i)}return{success:!0,value:a,usedVariables:Array.from(new Set(r)),executionTime:Date.now()-s}}catch(t){return{success:!1,value:e,error:t instanceof Error?t.message:String(t),usedVariables:r,executionTime:Date.now()-s}}}registerFunction(e,t){this.functions.set(e,t)}async evaluateNode(e,t,s){switch(e.type){case"variable":return this.evaluateVariable(e.name,t,s);case"literal":return e.value;case"function":return this.evaluateFunction(e,t,s);case"conditional":return this.evaluateConditional(e,t,s);default:throw Error("Unknown expression type: ".concat(e.type))}}evaluateVariable(e,t,s){s.push(e);let r=e.split("."),i=t.variables[r[0]];for(let e=1;e<r.length&&void 0!==i;e++)i=i[r[e]];return i}async evaluateFunction(e,t,s){let r=this.functions.get(e.name)||t.functions[e.name];if(!r)throw Error("Unknown function: ".concat(e.name));let i=[];for(let r of e.arguments){let e=await this.evaluateNode(r,t,s);i.push(e)}return this.executeFunctionSafely(r,i)}async evaluateConditional(e,t,s){let r=await this.evaluateNode(e.condition,t,s);return this.isTruthy(r)?this.evaluateNode(e.thenBranch,t,s):e.elseBranch?this.evaluateNode(e.elseBranch,t,s):void 0}executeFunctionSafely(e,t){try{return e.apply(null,t)}catch(e){throw Error("Function execution failed: ".concat(e))}}isTruthy(e){return null!=e&&!1!==e&&("number"==typeof e?0!==e&&!isNaN(e):"string"==typeof e||Array.isArray(e)?e.length>0:"object"==typeof e?Object.keys(e).length>0:!!e)}formatValue(e){return null==e?"":"string"==typeof e?e:"number"==typeof e?e.toString():"boolean"==typeof e?e?"true":"false":Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):String(e)}initializeBuiltinFunctions(){this.functions.set("upper",e=>String(e).toUpperCase()),this.functions.set("lower",e=>String(e).toLowerCase()),this.functions.set("trim",e=>String(e).trim()),this.functions.set("length",e=>String(e).length),this.functions.set("substring",(e,t,s)=>String(e).substring(t,s)),this.functions.set("round",e=>Math.round(Number(e))),this.functions.set("floor",e=>Math.floor(Number(e))),this.functions.set("ceil",e=>Math.ceil(Number(e))),this.functions.set("abs",e=>Math.abs(Number(e))),this.functions.set("join",function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return Array.isArray(e)?e.join(t):String(e)}),this.functions.set("first",e=>Array.isArray(e)?e[0]:void 0),this.functions.set("last",e=>Array.isArray(e)?e[e.length-1]:void 0),this.functions.set("now",()=>new Date),this.functions.set("formatDate",function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],new Date(e).toISOString().split("T")[0]}),this.functions.set("toString",e=>String(e)),this.functions.set("toNumber",e=>Number(e)),this.functions.set("toBoolean",e=>!!e),this.functions.set("ifEmpty",(e,t)=>null==e||""===e?t:e),this.functions.set("ifNull",(e,t)=>null==e?t:e)}constructor(){this.functions=new Map,this.initializeBuiltinFunctions()}}class W{registerComponent(e){this.components.set(e.id,e)}unregisterComponent(e){for(let[t,s]of(this.components.delete(e),this.subscriptions.entries()))s.delete(e),0===s.size&&this.subscriptions.delete(t)}subscribeToVariable(e,t){this.subscriptions.has(t)||this.subscriptions.set(t,new Set),this.subscriptions.get(t).add(e)}notifyVariableUpdate(e,t){let s=this.subscriptions.get(e);if(s)for(let r of s){let s=this.components.get(r);if(null==s?void 0:s.onVariableUpdate)try{s.onVariableUpdate(e,t)}catch(e){console.error("Error notifying component ".concat(r,":"),e),s.onError&&s.onError(e)}}}getAIComponents(){return Array.from(this.components.values()).filter(e=>e.requiresAI)}getAllComponents(){return Array.from(this.components.values())}constructor(){this.components=new Map,this.subscriptions=new Map}}class ${async executeLogicSection(e,t){try{let s={};for(let r of e.inputVariables)s[r]=t.variables.getValue(r);let r=await this.substituteVariables(e.prompt,s),i=await this.callAIAPI(e,r);return e.outputVariable&&t.variables.setValue(e.outputVariable,i),i}catch(e){throw console.error("Logic section execution failed:",e),e}}async substituteVariables(e,t){let s=new G,r=await s.evaluateText(e,{variables:t,functions:{},session:{},metadata:{}});if(!r.success)throw Error("Prompt variable substitution failed: ".concat(r.error));return r.value}async callAIAPI(e,t){return console.log("AI API call to ".concat(e.modelId,":"),t),"AI response for prompt: ".concat(t.substring(0,50),"...")}}class J{async resolveVariableWithExpression(e,t){if(!t)return this.baseEngine.resolveVariable(e);try{let s={variables:this.getAllVariableValues(),functions:{},session:this.context.session.responses,metadata:this.context.session.metadata||{}},r=await this.evaluator.evaluateText(t,s);if(!r.success)throw Error("Expression evaluation failed: ".concat(r.error));return await this.populateVariable(e,r.value),r.value}catch(t){throw console.error("Enhanced variable resolution failed for ".concat(e,":"),t),t}}async processInterpolatedText(e){let t={variables:this.getAllVariableValues(),functions:{},session:this.context.session.responses,metadata:this.context.session.metadata||{}},s=await this.evaluator.evaluateText(e,t);return s.success?s.value:(console.warn("Text interpolation failed: ".concat(s.error)),e)}async executeLogicSection(e){let t=Date.now();try{this.context.currentSection="logic_".concat(e.outputVariable);let s=await this.logicProcessor.executeLogicSection(e,this.context);this.componentManager.notifyVariableUpdate(e.outputVariable,s);let r=Date.now()-t;return this.updateMetrics("logic_".concat(e.outputVariable),r),s}catch(r){let s=Date.now()-t;throw this.recordError("logic_".concat(e.outputVariable),s,r),r}}registerComponent(e){this.componentManager.registerComponent(e)}subscribeComponentToVariable(e,t){this.componentManager.subscribeToVariable(e,t)}async populateVariable(e,t){await this.baseEngine.populateVariable(e,t),this.componentManager.notifyVariableUpdate(e,t)}registerExpressionFunction(e,t){this.evaluator.registerFunction(e,t)}async executeMultipleLogicSections(e){let t={};for(let s of e)try{t[s.outputVariable]=await this.executeLogicSection(s)}catch(e){console.error("Logic section failed for ".concat(s.outputVariable,":"),e),t[s.outputVariable]=null}return t}async executeSection(e){return this.baseEngine.executeSection(e)}async resolveVariable(e){return this.baseEngine.resolveVariable(e)}getMetrics(){return this.baseEngine.getMetrics()}reset(){this.baseEngine.reset(),this.componentManager=new W}getAllVariableValues(){let e={};for(let t of this.context.variables.getAllVariables())e[t.id]=this.context.variables.getValue(t.id);return e}updateMetrics(e,t){this.context.metrics.sectionRenderTimes[e]=t,this.context.metrics.totalTime+=t}recordError(e,t,s){console.error("Section ".concat(e," failed after ").concat(t,"ms:"),s),this.context.metrics.sectionRenderTimes[e]=t,this.context.metrics.totalTime+=t}constructor(e){this.context=e,this.baseEngine=new U(e),this.evaluator=new G,this.componentManager=new W,this.logicProcessor=new $}}new G,new W,new $;var X=s(49641).Buffer,Y=s(49509);class Z{set(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=Date.now(),a=s||this.defaultTTL;this.cleanup(),this.cache.size>=this.maxSize&&!this.cache.has(e)&&this.evictLRU();let n={value:t,key:e,timestamp:i,ttl:a,size:this.estimateSize(t),accessCount:1,lastAccess:i,dependencies:r,tier:"memory"};this.cache.set(e,n),this.accessOrder.set(e,++this.accessCounter)}get(e){let t=this.cache.get(e);if(t){if(Date.now()-t.timestamp>t.ttl){this.cache.delete(e),this.accessOrder.delete(e);return}return t.accessCount++,t.lastAccess=Date.now(),this.accessOrder.set(e,++this.accessCounter),t.value}}has(e){let t=this.cache.get(e);return!!t&&(!(Date.now()-t.timestamp>t.ttl)||(this.cache.delete(e),this.accessOrder.delete(e),!1))}delete(e){return this.accessOrder.delete(e),this.cache.delete(e)}clear(){this.cache.clear(),this.accessOrder.clear(),this.accessCounter=0}size(){return this.cache.size}getStats(){let e=0,t=0;for(let s of this.cache.values())e+=s.size,s.accessCount,t+=s.accessCount;return{hitRate:0,missRate:0,totalHits:t,totalMisses:0,memoryUsage:e,itemCount:this.cache.size,averageAccessTime:0,efficiencyScore:0}}invalidateByDependencies(e){let t=[];for(let[s,r]of this.cache.entries())r.dependencies.some(t=>e.includes(t))&&(this.delete(s),t.push(s));return t}cleanup(){let e=Date.now(),t=[];for(let[s,r]of this.cache.entries())e-r.timestamp>r.ttl&&t.push(s);for(let e of t)this.delete(e)}evictLRU(){let e,t=1/0;for(let[s,r]of this.accessOrder.entries())r<t&&(t=r,e=s);e&&this.delete(e)}estimateSize(e){if("string"==typeof e)return 2*e.length;if("number"==typeof e)return 8;if("boolean"==typeof e)return 4;if(null==e);else if(Array.isArray(e))return e.reduce((e,t)=>e+this.estimateSize(t),0);else if("object"==typeof e)return 2*JSON.stringify(e).length;return 0}constructor(e,t=3e5){this.maxSize=e,this.defaultTTL=t,this.cache=new Map,this.accessOrder=new Map,this.accessCounter=0}}class Q{get(e){let t=Date.now();try{if(this.config.layers.memory){let s=this.memoryCache.get(e);if(void 0!==s)return this.recordCacheHit("memory",Date.now()-t),s}if(this.config.layers.session){let s=this.sessionCache.get(e);if(void 0!==s)return this.memoryCache.set(e,s),this.recordCacheHit("session",Date.now()-t),s}this.recordCacheMiss(Date.now()-t);return}catch(e){console.error("Cache get error:",e),this.recordCacheMiss(Date.now()-t);return}}set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{ttl:r,dependencies:i=[],policy:a,tiers:n=["memory"]}=s,o=r||this.getTTLForPolicy(a);for(let s of n)switch(s){case"memory":this.config.layers.memory&&this.memoryCache.set(e,t,o,i);break;case"session":this.config.layers.session&&this.sessionCache.set(e,t)}}invalidateByVariable(e){Date.now();try{let t=k.getDependents(e),s=[e,...t],r=this.memoryCache.invalidateByDependencies(s);for(let e of this.sessionCache.keys())s.some(t=>e.includes(t))&&(this.sessionCache.delete(e),r.push(e));console.log("Invalidated ".concat(r.length," cache entries for variable ").concat(e))}catch(e){console.error("Cache invalidation error:",e)}}getStats(){let e=this.memoryCache.getStats();return{...this.cacheStats,memoryUsage:e.memoryUsage,itemCount:e.itemCount+this.sessionCache.size}}getPerformanceMetrics(){return{...this.performanceMetrics}}clear(){this.memoryCache.clear(),this.sessionCache.clear(),this.cacheStats=this.initializeStats()}optimize(){let e=this.getStats();e.hitRate<.5&&console.log("Low cache hit rate detected, optimizing TTL policies"),e.memoryUsage>.8*this.config.maxMemoryUsage&&(console.log("High memory usage detected, triggering cleanup"),this.cleanup())}getTTLForPolicy(e){return e&&this.config.variablePolicies[e]?this.config.variablePolicies[e].ttl:this.config.defaultTTL}recordCacheHit(e,t){this.cacheStats.totalHits++,this.updateHitRate()}recordCacheMiss(e){this.cacheStats.totalMisses++,this.updateHitRate()}updateHitRate(){let e=this.cacheStats.totalHits+this.cacheStats.totalMisses;this.cacheStats.hitRate=e>0?this.cacheStats.totalHits/e:0,this.cacheStats.missRate=e>0?this.cacheStats.totalMisses/e:0}cleanup(){}initializeMetrics(){return{variableResolutionTimes:{},expressionEvaluationTimes:{},aiApiCallTimes:{},stringInterpolationTimes:[],memorySnapshots:[],bottlenecks:[]}}initializeStats(){return{hitRate:0,missRate:0,totalHits:0,totalMisses:0,memoryUsage:0,itemCount:0,averageAccessTime:0,efficiencyScore:0}}constructor(e={}){this.sessionCache=new Map,this.config={maxMemoryUsage:0x3200000,defaultTTL:3e5,maxItems:1e4,layers:{memory:!0,session:!0,persistent:!1},variablePolicies:{},...e},this.memoryCache=new Z(this.config.maxItems,this.config.defaultTTL),this.performanceMetrics=this.initializeMetrics(),this.cacheStats=this.initializeStats()}}class K{memoize(e,t,s){let r=this.cache;return function(){for(var i=arguments.length,a=Array(i),n=0;n<i;n++)a[n]=arguments[n];let o=t?t(...a):JSON.stringify(a),c=r.get(o);if(void 0!==c)return c;let l=e(...a);return r.set(o,l,void 0,s),l}}clear(){this.cache.clear()}invalidateByDependencies(e){this.cache.invalidateByDependencies(e)}constructor(){this.cache=new Z(1e3)}}class ee{generateKey(e,t,s,r){let i={modelId:e,prompt:t.substring(0,1e3),temperature:s||.7,maxTokens:r||1e3};return"ai_".concat(X.from(JSON.stringify(i)).toString("base64").substring(0,32))}get(e,t,s,r){let i=this.generateKey(e,t,s,r);return this.cache.get(i)}set(e,t,s,r,i,a){let n=this.generateKey(e,t,r,i);this.cache.set(n,s,a)}clear(){this.cache.clear()}getStats(){return this.cache.getStats()}constructor(){this.cache=new Z(500,36e5)}}class et{intern(e){if(this.internedStrings.has(e)){let t=this.internedStrings.get(e);return this.usageCount.set(e,(this.usageCount.get(e)||0)+1),t}return this.internedStrings.set(e,e),this.usageCount.set(e,1),e}isInterned(e){return this.internedStrings.has(e)}getMemorySavings(){let e=0;for(let[t,s]of this.usageCount.entries())s>1&&(e+=2*t.length*(s-1));return e}cleanup(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;for(let[t,s]of this.usageCount.entries())s<e&&(this.internedStrings.delete(t),this.usageCount.delete(t))}constructor(){this.internedStrings=new Map,this.usageCount=new Map}}class es{startOperation(e){this.activeOperations.set(e,Date.now())}endOperation(e,t){let s=this.activeOperations.get(e);if(!s)return 0;let r=Date.now()-s;switch(this.activeOperations.delete(e),t){case"variableResolutionTimes":case"expressionEvaluationTimes":case"aiApiCallTimes":this.metrics[t][e]||(this.metrics[t][e]=[]),this.metrics[t][e].push(r);break;case"stringInterpolationTimes":this.metrics.stringInterpolationTimes.push(r)}return r}recordMemorySnapshot(){if(void 0!==Y&&Y.memoryUsage){let e=Y.memoryUsage();this.metrics.memorySnapshots.push({timestamp:Date.now(),usage:e.heapUsed})}}detectBottlenecks(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;for(let[t,s]of(this.metrics.bottlenecks=[],Object.entries(this.metrics.variableResolutionTimes))){let r=s.reduce((e,t)=>e+t,0)/s.length;r>e&&this.metrics.bottlenecks.push({operation:"Variable: ".concat(t),avgTime:r,frequency:s.length})}this.metrics.bottlenecks.sort((e,t)=>t.avgTime-e.avgTime)}getMetrics(){return this.detectBottlenecks(),{...this.metrics}}clear(){this.activeOperations.clear(),this.metrics={variableResolutionTimes:{},expressionEvaluationTimes:{},aiApiCallTimes:{},stringInterpolationTimes:[],memorySnapshots:[],bottlenecks:[]}}constructor(){this.activeOperations=new Map,this.metrics={variableResolutionTimes:{},expressionEvaluationTimes:{},aiApiCallTimes:{},stringInterpolationTimes:[],memorySnapshots:[],bottlenecks:[]}}}let er=new Q,ei=new K,ea=new ee,en=new et,eo=new es;var ec=s(49641).Buffer;class el{async resolveVariableWithExpression(e,t){let s=t?"var_expr_".concat(e,"_").concat(en.intern(t)):"var_".concat(e);eo.startOperation(s);try{let r=this.cacheManager.get(s);if(void 0!==r)return eo.endOperation(s,"variableResolutionTimes"),r;let i=await this.baseEngine.resolveVariableWithExpression(e,t),a=t?this.extractDependencies(t):[e];return this.cacheManager.set(s,i,{dependencies:a,tiers:["memory","session"]}),eo.endOperation(s,"variableResolutionTimes"),i}catch(e){throw eo.endOperation(s,"variableResolutionTimes"),e}}async processInterpolatedText(e){let t=en.intern(e),s="text_interp_".concat(ec.from(t).toString("base64").substring(0,32));eo.startOperation(s);try{let e=this.cacheManager.get(s);if(void 0!==e)return eo.endOperation(s,"stringInterpolationTimes"),e;let r={variables:this.getAllVariableValues(),functions:{},session:this.context.session.responses,metadata:this.context.session.metadata||{}},i=await this.memoizedEvaluateText(t,r);if(!i.success)return console.warn("Text interpolation failed: ".concat(i.error)),eo.endOperation(s,"stringInterpolationTimes"),t;return this.cacheManager.set(s,i.value,{dependencies:i.usedVariables,tiers:["memory"]}),eo.endOperation(s,"stringInterpolationTimes"),i.value}catch(e){return console.error("Cached text interpolation error:",e),eo.endOperation(s,"stringInterpolationTimes"),t}}async executeLogicSection(e){let t="logic_".concat(e.outputVariable);eo.startOperation(t);try{let s=ea.get(e.modelId,e.prompt,e.temperature,e.maxTokens);if(s)return await this.populateVariable(e.outputVariable,s),eo.endOperation(t,"aiApiCallTimes"),s;let r=await this.baseEngine.executeLogicSection(e);return"string"==typeof r&&ea.set(e.modelId,e.prompt,r,e.temperature,e.maxTokens),eo.endOperation(t,"aiApiCallTimes"),r}catch(e){throw eo.endOperation(t,"aiApiCallTimes"),e}}async populateVariable(e,t){this.cacheManager.invalidateByVariable(e),await this.baseEngine.populateVariable(e,t),eo.recordMemorySnapshot()}async resolveVariable(e){return this.memoizedResolveVariable(e)}async executeSection(e){return this.baseEngine.executeSection(e)}registerComponent(e){this.baseEngine.registerComponent(e)}subscribeComponentToVariable(e,t){this.baseEngine.subscribeComponentToVariable(e,t)}registerExpressionFunction(e,t){this.baseEngine.registerExpressionFunction(e,t)}getPerformanceMetrics(){return{runtime:this.baseEngine.getMetrics(),cache:this.cacheManager.getStats(),profiler:eo.getMetrics(),stringInterning:{memorySavings:en.getMemorySavings()},aiCache:ea.getStats()}}getMetrics(){return this.baseEngine.getMetrics()}optimizePerformance(){this.cacheManager.optimize(),en.cleanup(),Object.keys(eo.getMetrics().variableResolutionTimes).length>1e3&&ei.clear()}reset(){this.baseEngine.reset(),this.cacheManager.clear(),ei.clear(),eo.clear()}configureCachePolicy(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];console.log("Cache policy configured for ".concat(e,": TTL=").concat(t,"ms, CrossSession=").concat(s))}getCacheStats(){return this.cacheManager.getStats()}invalidateCache(e){e?console.log("Invalidating cache for pattern: ".concat(e)):this.cacheManager.clear()}setupMemoizedFunctions(){this.memoizedEvaluateText=ei.memoize(async(e,t)=>new G().evaluateText(e,t),(e,t)=>{let s=Object.keys(t.variables).sort().join(","),r=ec.from(s).toString("base64").substring(0,16),i=ec.from(e).toString("base64").substring(0,16);return"eval_".concat(i,"_").concat(r)}),this.memoizedResolveVariable=ei.memoize(async e=>this.baseEngine.resolveVariable(e),e=>"resolve_".concat(e),void 0)}extractDependencies(e){let t,s=/@(\w+(?:\.\w+)*)/g,r=[];for(;null!==(t=s.exec(e));)r.push(t[1]);return r}getAllVariableValues(){let e={};for(let t of this.context.variables.getAllVariables())e[t.id]=this.context.variables.getValue(t.id);return e}constructor(e,t){this.context=e,this.baseEngine=new J(e),this.cacheManager=t?new Q(t):er,this.setupMemoizedFunctions()}}var ed=function(e){return e.INFO="info",e.WARNING="warning",e.ERROR="error",e.CRITICAL="critical",e}({}),eh=function(e){return e.VARIABLE="variable",e.EXPRESSION="expression",e.API="api",e.DEPENDENCY="dependency",e.SYSTEM="system",e.PERFORMANCE="performance",e}({});class eu{async handleError(e){if(this.errorHistory.push(e),this.notifyErrorListeners(e),this.config.logErrors&&this.logError(e),this.config.autoRecovery&&e.recoverable)return this.attemptRecovery(e);throw e}createError(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{...e,id:"error_".concat(t,"_").concat(Date.now()),severity:"error",category:t,userMessage:this.generateUserFriendlyMessage(e,t),technicalMessage:e.message,context:{...s,stackTrace:e.stack},recoveryActions:this.generateRecoveryActions(e,t),timestamp:new Date,recoverable:!0}}withErrorHandling(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e().catch(async e=>{let s=e instanceof Error&&"category"in e?e:this.createError(e,"system",t);return this.handleError(s)})}onError(e){this.errorListeners.push(e)}offError(e){let t=this.errorListeners.indexOf(e);t>-1&&this.errorListeners.splice(t,1)}getErrorHistory(){return[...this.errorHistory]}clearErrorHistory(){this.errorHistory=[],this.retryCounters.clear()}getErrorStats(){let e={totalErrors:this.errorHistory.length,errorsByCategory:{},errorsBySeverity:{},recoverySuccessRate:0};Object.values(eh).forEach(t=>{e.errorsByCategory[t]=0}),Object.values(ed).forEach(t=>{e.errorsBySeverity[t]=0});let t=0;for(let s of this.errorHistory)e.errorsByCategory[s.category]++,e.errorsBySeverity[s.severity]++,s.recoverable&&t++;let s=this.errorHistory.filter(e=>e.recoverable).length;return e.recoverySuccessRate=s>0?t/s:0,e}async attemptRecovery(e){let t=e.id.split("_").slice(0,-1).join("_"),s=this.retryCounters.get(t)||0;if(s>=this.config.maxRetries)throw Error("Max retries exceeded for ".concat(t));for(let r of e.recoveryActions.sort((e,t)=>(t.successProbability||0)-(e.successProbability||0)))if(r.execute)try{this.retryCounters.set(t,s+1),"retry"===r.type&&await this.delay(this.config.retryDelay);let i=await r.execute();return console.log("Recovery successful for ".concat(e.id," using ").concat(r.type)),i}catch(t){console.warn("Recovery action ".concat(r.type," failed for ").concat(e.id,":"),t);continue}throw e}generateUserFriendlyMessage(e,t){switch(t){case"variable":return"There was an issue accessing a variable. Please check that all required variables are defined.";case"expression":return"There was a problem with an expression in your campaign. Please check the syntax.";case"api":return"There was a problem connecting to an external service. Please try again.";case"dependency":return"There was an issue with variable dependencies. Please check for circular references.";case"system":return"A system error occurred. Please contact support if this persists.";case"performance":return"An operation is taking longer than expected. Performance may be affected.";default:return"An unexpected error occurred. Please try again."}}generateRecoveryActions(e,t){let s=[{type:"retry",description:"Try again",successProbability:.5}];switch(t){case"api":return[...s,{type:"fallback",description:"Use cached data",successProbability:.8}];case"variable":return[{type:"fallback",description:"Use default value",successProbability:.9},{type:"skip",description:"Skip this variable",successProbability:.7}];default:return s}}logError(e){let t="critical"===e.severity||"error"===e.severity?"error":"warning"===e.severity?"warn":"info";console[t]("[".concat(e.category.toUpperCase(),"] ").concat(e.userMessage),{id:e.id,technical:e.technicalMessage,context:e.context,recoverable:e.recoverable,timestamp:e.timestamp})}notifyErrorListeners(e){this.errorListeners.forEach(t=>{try{t(e)}catch(e){console.error("Error listener failed:",e)}})}delay(e){return new Promise(t=>setTimeout(t,e))}constructor(e){this.config=e,this.errorHistory=[],this.retryCounters=new Map,this.errorListeners=[]}}let ep=new eu({maxRetries:3,retryDelay:1e3,performanceThresholds:{variableResolution:5e3,expressionEvaluation:3e3,apiCall:1e4},autoRecovery:!0,logErrors:!0,...void 0});class em{debounce(e,t,s,r){let i=this.timers.get(e);i&&clearTimeout(i),this.pendingUpdates.set(e,t);let a=setTimeout(()=>{let t=this.pendingUpdates.get(e);t&&(r(t),this.pendingUpdates.delete(e),this.timers.delete(e))},s);this.timers.set(e,a)}cancel(e){let t=this.timers.get(e);t&&(clearTimeout(t),this.timers.delete(e),this.pendingUpdates.delete(e))}clear(){for(let e of this.timers.values())clearTimeout(e);this.timers.clear(),this.pendingUpdates.clear()}constructor(){this.timers=new Map,this.pendingUpdates=new Map}}var eg=s(49509),ef=function(e){return e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e[e.CRITICAL=4]="CRITICAL",e[e.SILENT=5]="SILENT",e}({}),ey=function(e){return e.VARIABLE="variable",e.EXPRESSION="expression",e.DEPENDENCY="dependency",e.REALTIME="realtime",e.PERFORMANCE="performance",e.API="api",e.ERROR="error",e.SYSTEM="system",e}({});let ev=e=>{var t;let s=e.timestamp.toISOString(),r=ef[e.level].padEnd(8),i=e.category.toUpperCase().padEnd(12),a="[".concat(s,"] ").concat(r," ").concat(i," ").concat(e.message);return e.variableId&&(a+=" (variable: ".concat(e.variableId,")")),(null==(t=e.metrics)?void 0:t.duration)&&(a+=" (".concat(e.metrics.duration,"ms)")),a},ex=e=>JSON.stringify({id:e.id,timestamp:e.timestamp.toISOString(),level:ef[e.level],category:e.category,message:e.message,data:e.data,error:e.error?{name:e.error.name,message:e.error.message,stack:e.error.stack}:void 0,sessionId:e.sessionId,campaignId:e.campaignId,variableId:e.variableId,source:e.source,metrics:e.metrics}),eb=e=>{let t=e.timestamp.toTimeString().substring(0,8),s=ef[e.level].substring(0,1),r=e.category.substring(0,3).toUpperCase();return"".concat(t," [").concat(s,"/").concat(r,"] ").concat(e.message)},ew=e=>{let t={0:"\x1b[36m",1:"\x1b[32m",2:"\x1b[33m",3:"\x1b[31m",4:"\x1b[35m",5:"\x1b[0m"}[e.level]||"",s="".concat(t,"[").concat(ef[e.level],"]").concat("\x1b[0m"," ").concat(e.category,": ").concat(e.message);return e.data&&Object.keys(e.data).length>0&&(s+="\n  Data: ".concat(JSON.stringify(e.data,null,2))),e.error&&(s+="\n  Error: ".concat(e.error.message),e.error.stack&&(s+="\n  Stack: ".concat(e.error.stack))),s};class eE{debug(e,t,s){this.log(0,"system",e,t,s)}info(e,t,s){this.log(1,"system",e,t,s)}warn(e,t,s){this.log(2,"system",e,t,s)}error(e,t,s,r){this.log(3,"error",e,s,{...r,error:t})}critical(e,t,s,r){this.log(4,"error",e,s,{...r,error:t})}variable(e,t,s,r){this.log(e,"variable",t,r,{variableId:s})}expression(e,t,s,r){this.log(e,"expression",t,{...r,expression:s})}dependency(e,t,s,r){this.log(e,"dependency",t,{...r,dependencyChain:s})}realtime(e,t,s,r){this.log(e,"realtime",t,r,{variableId:s})}performance(e,t){this.log(1,"performance",e,void 0,{metrics:t})}api(e,t,s,r,i){this.log(e,"api",t,{...i,service:s,operation:r})}startTimer(e){this.config.trackPerformance&&(this.performanceTimers.set(e,Date.now()),this.operationStack.push(e),this.debug("Started operation: ".concat(e),{operationId:e}))}endTimer(e,t){if(!this.config.trackPerformance)return 0;let s=this.performanceTimers.get(e);if(!s)return this.warn("Timer not found for operation: ".concat(e)),0;let r=Date.now()-s;this.performanceTimers.delete(e);let i=this.operationStack.indexOf(e);return i>-1&&this.operationStack.splice(i,1),this.performance(t||"Completed operation: ".concat(e),{operationId:e,duration:r,memoryUsage:this.getMemoryUsage()}),r}withTiming(e,t){this.startTimer(e);let s=t=>(this.endTimer(e),t),r=t=>{throw this.endTimer(e,"Failed operation: ".concat(e)),t};try{let e=t();if(e instanceof Promise)return e.then(s).catch(r);return Promise.resolve(s(e))}catch(e){return r(e),Promise.reject(e)}}scope(e){return new eS(this,e)}getEntries(e){let t=this.entries;return(null==e?void 0:e.level)!==void 0&&(t=t.filter(t=>t.level>=e.level)),(null==e?void 0:e.category)&&(t=t.filter(t=>t.category===e.category)),(null==e?void 0:e.since)&&(t=t.filter(t=>t.timestamp>=e.since)),(null==e?void 0:e.limit)&&(t=t.slice(-e.limit)),t}getStats(){let e={},t={};for(let s of(Object.values(ef).forEach(t=>{"string"==typeof t&&(e[t]=0)}),Object.values(ey).forEach(e=>{t[e]=0}),this.entries))e[ef[s.level]]++,t[s.category]++;return{totalEntries:this.entries.length,entriesByLevel:e,entriesByCategory:t,activeOperations:[...this.operationStack],memoryUsage:this.getMemoryUsage()}}clear(){this.entries=[],this.performanceTimers.clear(),this.operationStack=[]}updateConfig(e){Object.assign(this.config,e)}log(e,t,s,r,i){if(!this.shouldLog(e,t))return;let a={id:"log_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2)),level:e,category:t,message:s,timestamp:new Date,data:r,...i};this.config.includeStackTrace&&e>=3&&(a.source=this.getSourceLocation()),this.entries.push(a),this.entries.length>this.config.maxEntries&&(this.entries=this.entries.slice(-this.config.maxEntries)),this.outputEntry(a)}shouldLog(e,t){return!(e<this.config.level)&&("*"===this.config.categories||!!this.config.categories.includes(t))}outputEntry(e){for(let t of this.outputs.values()){if(void 0!==t.level&&e.level<t.level||t.categories&&!t.categories.includes(e.category))continue;let s=this.formatters.get(t.formatter||"default");if(!s){console.error("Formatter not found: ".concat(t.formatter));continue}let r=s(e);"console"===t.type&&console.log(r)}}getSourceLocation(){let e=Error().stack;if(!e)return{};let t=e.split("\n")[4];if(!t)return{};let s=t.match(/at\s+(.+?)\s+\((.+):(\d+):(\d+)\)/);return s?{function:s[1],file:s[2],line:parseInt(s[3])}:{}}getMemoryUsage(){return void 0!==eg&&eg.memoryUsage?eg.memoryUsage().heapUsed:0}constructor(e){if(this.config=e,this.entries=[],this.outputs=new Map,this.formatters=new Map,this.operationStack=[],this.performanceTimers=new Map,this.formatters.set("default",ev),this.formatters.set("json",ex),this.formatters.set("compact",eb),this.formatters.set("development",ew),e.formatters)for(let[t,s]of Object.entries(e.formatters))this.formatters.set(t,s);for(let t of e.outputs)this.outputs.set(t.id,t)}}class eS{debug(e,t){this.parent.debug(e,t,this.context)}info(e,t){this.parent.info(e,t,this.context)}warn(e,t){this.parent.warn(e,t,this.context)}error(e,t,s){this.parent.error(e,t,s,this.context)}critical(e,t,s){this.parent.critical(e,t,s,this.context)}variable(e,t,s,r){this.parent.variable(e,t,s,r)}scope(e){return new eS(this.parent,{...this.context,...e})}startTimer(e){this.parent.startTimer(e)}endTimer(e,t){return this.parent.endTimer(e,t)}withTiming(e,t){return this.parent.withTiming(e,t)}constructor(e,t){this.parent=e,this.context=t}}let eT=new eE({level:1,categories:"*",outputs:[{id:"console",type:"console",formatter:"development"}],maxEntries:1e3,includeStackTrace:!0,trackPerformance:!0,...void 0});function eN(e){let{}=e,t=(0,n.useParams)(),s=null==t?void 0:t.slug,[r,N]=(0,a.useState)(null),[A,j]=(0,a.useState)([]),[k,C]=(0,a.useState)(!0),[V,I]=(0,a.useState)(null),[M,D]=(0,a.useState)({isOnline:!0,connectionType:"unknown",effectiveType:"unknown",downlink:0}),[_,R]=(0,a.useState)(null),[O,P]=(0,a.useState)(null),[z,L]=(0,a.useState)(null),[U,F]=(0,a.useState)(!1),[q,B]=(0,a.useState)(null),[H,G]=(0,a.useState)(null),[W,$]=(0,a.useState)(null),[J,X]=(0,a.useState)(new Map),[Y,Z]=(0,a.useState)(!1),[Q,K]=(0,a.useState)({currentSection:0,userInputs:{},completedSections:new Set,startTime:new Date,sessionId:crypto.randomUUID()}),[ee,et]=(0,a.useState)({totalProgress:0,weightedProgress:0,captureProgress:0,timeEstimate:0,completionForecast:"",milestones:[]}),es=e=>({capture:3,text_question:2,multiple_choice:2,slider:2,logic:1,info:1,output:4})[e.type]||1,er=()=>{if(0===A.length)return{totalProgress:0,weightedProgress:0,captureProgress:0,timeEstimate:0,completionForecast:"",milestones:[]};let e=A.length,t=Q.completedSections.size,s=Math.round(t/e*100),r=A.reduce((e,t)=>e+es(t),0),i=Math.round(A.filter((e,t)=>Q.completedSections.has(t)).reduce((e,t)=>e+es(t),0)/r*100),a=A.filter(e=>"capture"===e.type),n=a.filter((e,t)=>{let s=A.findIndex(e=>e.id===a[t].id);return Q.completedSections.has(s)}),o=a.length>0?Math.round(n.length/a.length*100):100,c=45*(e-t),l=new Date(new Date().getTime()+1e3*c).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),d=[];return 100===o&&d.push("Contact info collected"),s>=25&&d.push("Getting started"),s>=50&&d.push("Halfway there"),s>=75&&d.push("Almost finished"),100===s&&d.push("Campaign complete!"),{totalProgress:s,weightedProgress:i,captureProgress:o,timeEstimate:c,completionForecast:l,milestones:d}};(0,a.useEffect)(()=>{et(er())},[Q.completedSections,A.length,Q.currentSection]);let ei=e=>{let t=A[e];return t?"output"===t.type&&100!==ee.captureProgress?{canAccess:!1,reason:"Please complete the contact information section first"}:{canAccess:!0}:{canAccess:!1,reason:"Section not found"}},ea=e=>{let t=ei(e);return t.canAccess?(eL(e),!0):(I(eZ(t.reason||"Cannot access this section yet","validation",!1)),setTimeout(()=>I(null),3e3),!1)},en=async e=>{try{if(!O)return e.description||"Thank you for completing this campaign.";let t={userResponses:Q.userInputs,campaignInfo:{name:null==r?void 0:r.name,id:null==r?void 0:r.id,type:"lead_magnet"},sessionInfo:{completedSections:Array.from(Q.completedSections),totalSections:A.length,timeSpent:Math.round((new Date().getTime()-Q.startTime.getTime())/1e3)}},s=e.description||e.title||"Thank you for completing this campaign.";return await eV(s,t)}catch(t){return console.error("Error generating dynamic content:",t),eM(e.description||"Thank you for completing this campaign.",Q.userInputs)}},[eo,ec]=(0,a.useState)(!1),[ed,eu]=(0,a.useState)(""),em=async()=>{if(100===ee.totalProgress&&!eo){let e=Math.round((new Date().getTime()-Q.startTime.getTime())/1e3),t=Math.floor(e/60);eu("\uD83C\uDF89 Congratulations! You completed this campaign in ".concat(t,"m ").concat(e%60,"s. Thank you for your participation!")),ec(!0),setTimeout(()=>{ec(!1)},5e3),await eN()}};(0,a.useEffect)(()=>{100===ee.totalProgress&&em()},[ee.totalProgress]);let[eg,ef]=(0,a.useState)({isProcessing:!1,stage:"",progress:0,message:""}),ey=async e=>{ef({isProcessing:!0,stage:"analyzing",progress:20,message:"Analyzing your responses..."});try{await new Promise(e=>setTimeout(e,1e3)),ef(e=>({...e,stage:"generating",progress:60,message:"Generating personalized content..."})),await en(e),await new Promise(e=>setTimeout(e,1e3)),ef(e=>({...e,stage:"finalizing",progress:90,message:"Finalizing your results..."})),await new Promise(e=>setTimeout(e,500)),ef(e=>({...e,progress:100,message:"Complete!"})),setTimeout(()=>{ef({isProcessing:!1,stage:"",progress:0,message:""})},500)}catch(e){console.error("AI processing error:",e),ef({isProcessing:!1,stage:"error",progress:0,message:"Processing failed. Showing standard content."})}};(0,a.useEffect)(()=>{let e=()=>{let e=navigator.connection||navigator.mozConnection||navigator.webkitConnection,t={isOnline:navigator.onLine,connectionType:(null==e?void 0:e.type)||"unknown",effectiveType:(null==e?void 0:e.effectiveType)||"unknown",downlink:(null==e?void 0:e.downlink)||0};!navigator.onLine&&M.isOnline?t.lastOffline=new Date:navigator.onLine&&!M.isOnline&&(t.lastOnline=new Date),D(t)};e(),window.addEventListener("online",e),window.addEventListener("offline",e);let t=navigator.connection;return t&&t.addEventListener("change",e),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",e),t&&t.removeEventListener("change",e)}},[M.isOnline]),(0,a.useEffect)(()=>{let e=()=>{let e=window.innerWidth,t=window.innerHeight;R({type:e<768?"mobile":e<1024?"tablet":"desktop",screenSize:{width:e,height:t},orientation:e>t?"landscape":"portrait",touchCapable:"ontouchstart"in window||navigator.maxTouchPoints>0,userAgent:navigator.userAgent,pixelRatio:window.devicePixelRatio||1})};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[]),(0,a.useEffect)(()=>{if((null==V?void 0:V.type)==="network"&&M.isOnline&&0===V.retryCount){let e=setTimeout(()=>{e0()},2e3);return()=>clearTimeout(e)}},[V,M.isOnline]);let ev=e=>{if(!_)return e;let t="mobile"===_.type?"min-h-[44px] touch-manipulation select-none":"";return(0,c.cn)(e,t)};(0,a.useEffect)(()=>{s&&eD()},[s]),(0,a.useEffect)(()=>{r&&A.length>0&&ex()},[r,A]),(0,a.useEffect)(()=>{(async()=>{r&&!Y&&await eA()})()},[r,Y]),(0,a.useEffect)(()=>{let e=()=>{J.size>0&&eE()},t=()=>{document.hidden&&J.size>0&&eE()};return window.addEventListener("beforeunload",e),document.addEventListener("visibilitychange",t),()=>{e(),window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",t)}},[J]),(0,a.useEffect)(()=>{r&&Y&&eN()},[Q.currentSection,Q.completedSections,r,Y]),(0,a.useEffect)(()=>{let e=e=>{if(!U)switch(e.key){case"ArrowRight":case"ArrowDown":case" ":e.preventDefault(),ez();break;case"ArrowLeft":case"ArrowUp":e.preventDefault(),eP();break;case"Home":e.preventDefault(),eL(0);break;case"End":e.preventDefault(),eL(A.length-1)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[U,A.length]),(0,a.useEffect)(()=>{let e=e=>{G(null),B({x:e.targetTouches[0].clientX,y:e.targetTouches[0].clientY})},t=e=>{G({x:e.targetTouches[0].clientX,y:e.targetTouches[0].clientY})},s=()=>{if(!q||!H)return;let e=q.x-H.x;Math.abs(e)>Math.abs(q.y-H.y)&&Math.abs(e)>50&&(e>0?ez():eP()),B(null),G(null)};return document.addEventListener("touchstart",e),document.addEventListener("touchmove",t),document.addEventListener("touchend",s),()=>{document.removeEventListener("touchstart",e),document.removeEventListener("touchmove",t),document.removeEventListener("touchend",s)}},[q,H]),(0,a.useEffect)(()=>{if(!r)return;let e=new URL(window.location.href),t=Q.currentSection+1,s="".concat(e.pathname,"?section=").concat(t).concat(e.hash);window.history.replaceState({sectionIndex:Q.currentSection,campaignSlug:r.published_url},"".concat(r.name," - Section ").concat(t),s);let i=e=>{var t;(null==(t=e.state)?void 0:t.sectionIndex)!==void 0&&eL(e.state.sectionIndex)};return window.addEventListener("popstate",i),()=>window.removeEventListener("popstate",i)},[r,Q.currentSection]),(0,a.useEffect)(()=>{if(0===A.length)return;let e=new URLSearchParams(window.location.search).get("section");if(e){let t=parseInt(e)-1;t>=0&&t<A.length&&K(e=>({...e,currentSection:t}))}},[A.length]);let ex=async()=>{try{var e;let t=(e={variables:{getAllVariables:()=>[],getValue:e=>Q.userInputs[e]||ek(e)||eC(e),setValue:async(e,t)=>{K(s=>({...s,userInputs:{...s.userInputs,[e]:t}}))}},session:{responses:Q.userInputs,metadata:{sessionId:Q.sessionId,startTime:Q.startTime,currentSection:Q.currentSection}},cache:{invalidate:e=>{eT.debug("Variable cache invalidated")}}},new el(e,void 0));P(t)}catch(e){console.error("Failed to initialize variable engine:",e),ep.handleError(ep.createError(e,eh.SYSTEM,{location:{function:"initializeVariableEngine"}}))}},eb=()=>({viewport:{width:window.innerWidth,height:window.innerHeight},screen:{width:window.screen.width,height:window.screen.height},deviceType:window.innerWidth<768?"mobile":window.innerWidth<1024?"tablet":"desktop",userAgent:navigator.userAgent,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:new Date().toISOString()}),ew=async function(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{K(r=>({...r,userInputs:{...r.userInputs,[t]:s,["".concat(e,"_").concat(t)]:s}}));let i="".concat(e,"_").concat(t),a={sectionId:e,fieldId:t,value:s,metadata:{...r,timestamp:new Date().toISOString(),sessionId:Q.sessionId,sectionIndex:Q.currentSection,deviceInfo:eb(),interactionType:"input_change"}};X(e=>new Map(e.set(i,a))),W&&clearTimeout(W);let n=setTimeout(()=>{eE()},1e3);$(n),z&&await z.updateVariable(t,s,{source:"user_input",propagate:!0})}catch(r){console.error("Error collecting response:",r),ep.handleError(ep.createError(r,eh.VARIABLE,{location:{function:"collectResponse"},metadata:{sectionId:e,fieldId:t,value:s}}))}},eE=async()=>{if(0!==J.size)try{let e=Array.from(J.values());await eS(e),X(new Map),eT.info("Batch responses saved successfully")}catch(e){console.error("Error flushing pending updates:",e)}},eS=async e=>{try{let t=await (0,o.AG)(),s=e.map(e=>({session_id:e.metadata.sessionId,section_id:e.sectionId,field_id:e.fieldId,response_value:String(e.value),response_type:"number"==typeof e.value?"number":"boolean"==typeof e.value?"boolean":"text",response_data:{originalValue:e.value,metadata:e.metadata},section_index:e.metadata.sectionIndex,created_at:e.metadata.timestamp})),{error:r}=await t.from("lead_responses").upsert(s,{onConflict:"session_id,section_id,field_id"});if(r)throw r;await eN()}catch(e){throw console.error("Error saving batch responses:",e),e}},eN=async()=>{try{let e=await (0,o.AG)(),t={session_id:Q.sessionId,campaign_id:null==r?void 0:r.id,last_section_index:Q.currentSection,completion_percentage:Math.round(Q.completedSections.size/A.length*100),total_sections:A.length,completed_sections:Q.completedSections.size,last_activity:new Date().toISOString(),is_completed:Q.completedSections.size>=A.length},{error:s}=await e.from("campaign_sessions").upsert(t,{onConflict:"session_id,campaign_id"});if(s)throw s}catch(e){console.error("Error updating session progress:",e)}},eA=async()=>{if(Y)return!0;try{let e=await (0,o.AG)(),{data:t,error:s}=await e.from("campaign_sessions").select("\n          *,\n          lead_responses (*)\n        ").eq("session_id",Q.sessionId).eq("campaign_id",null==r?void 0:r.id).single();if(s||!t)return await ej(),Z(!0),!1;let i={},a=new Set;return t.lead_responses&&t.lead_responses.forEach(e=>{i[e.field_id]=e.response_value,a.add(e.section_index||0)}),K(e=>({...e,userInputs:i,completedSections:a,currentSection:t.last_section_index||0,leadId:t.lead_id})),Z(!0),eT.info("Session recovered successfully"),!0}catch(e){return console.error("Error recovering session:",e),Z(!0),!1}},ej=async()=>{try{let e=await (0,o.AG)(),t={session_id:Q.sessionId,campaign_id:null==r?void 0:r.id,start_time:Q.startTime.toISOString(),last_section_index:Q.currentSection,device_info:eb(),metadata:{initial_referrer:"undefined"!=typeof document?document.referrer:null,user_agent:"undefined"!=typeof navigator?navigator.userAgent:null,screen_resolution:"".concat(window.screen.width,"x").concat(window.screen.height)}},{error:s}=await e.from("campaign_sessions").upsert(t);if(s)throw s;eT.info("New session created")}catch(e){console.error("Error creating session:",e)}},ek=e=>({campaign_name:(null==r?void 0:r.name)||"",campaign_id:(null==r?void 0:r.id)||"",user_session:Q.sessionId,current_section:Q.currentSection+1,total_sections:A.length,start_time:Q.startTime.toISOString()})[e],eC=e=>({timestamp:new Date().toISOString(),user_agent:"undefined"!=typeof navigator?navigator.userAgent:"",screen_width:window.screen.width,screen_height:window.screen.height})[e],eV=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||!O)return e||"";try{return await O.processInterpolatedText(e)||e}catch(s){return console.error("Variable interpolation error:",s),eM(e,t)}},eI=()=>({campaign_name:(null==r?void 0:r.name)||"",campaign_id:(null==r?void 0:r.id)||"",campaign_description:(null==r?void 0:r.description)||"",user_session:Q.sessionId,current_section:Q.currentSection+1,total_sections:A.length,start_time:Q.startTime.toISOString(),completion_rate:Math.round(Q.completedSections.size/A.length*100),time_elapsed:Math.round((new Date().getTime()-Q.startTime.getTime())/1e3)}),eM=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return e;let s=e;return Object.entries(Q.userInputs).forEach(e=>{let[t,r]=e;s=s.replace(RegExp("@".concat(t),"g"),String(r))}),Object.entries(eI()).forEach(e=>{let[t,r]=e;s=s.replace(RegExp("@".concat(t),"g"),String(r))}),Object.entries(t).forEach(e=>{let[t,r]=e;s=s.replace(RegExp("@".concat(t),"g"),String(r))}),s},eD=async()=>{try{if(C(!0),I(null),!M.isOnline)throw Error("No internet connection available");let e=await (0,o.AG)(),{data:t,error:r}=await e.from("campaigns").select("*").eq("published_url",s).eq("status","published").eq("is_active",!0).single();if(r||!t){if((null==r?void 0:r.code)==="PGRST116")throw Error("Campaign not found");throw Error((null==r?void 0:r.message)||"Campaign not available")}N(t);let{data:i,error:a}=await e.from("sections").select("\n          *,\n          section_options (*)\n        ").eq("campaign_id",t.id).order("order_index",{ascending:!0});if(a)throw Error("Failed to load campaign sections: ".concat(a.message));if(!i||0===i.length)throw Error("This campaign has no content to display");j(i),K(e=>({...e,startTime:new Date,sessionId:crypto.randomUUID()}))}catch(e){console.error("Error loading public campaign:",e),eQ(e,{function:"loadPublicCampaign",slug:s})}finally{C(!1)}},e_=async(e,t)=>{try{let s=A[e];if(K(s=>({...s,userInputs:{...s.userInputs,...t},completedSections:new Set([...s.completedSections,e])})),z)for(let[e,s]of Object.entries(t))await z.updateVariable(e,s,{source:"user_input",propagate:!0});"capture"===s.type&&await eR(t),await eO(s.id,t),e<A.length-1&&setTimeout(()=>{K(e=>({...e,currentSection:Math.min(A.length-1,e.currentSection+1)}))},1e3)}catch(s){console.error("Error completing section:",s),ep.handleError(ep.createError(s,eh.VARIABLE,{location:{function:"handleSectionComplete"},metadata:{sectionIndex:e,data:t}}))}},eR=async e=>{try{if(!r)return;let t=await (0,o.AG)(),s={campaign_id:r.id,name:e.name||e.full_name||null,email:e.email,phone:e.phone||null,ip_address:null,user_agent:"undefined"!=typeof navigator?navigator.userAgent:null,metadata:{session_id:Q.sessionId,completed_sections:Array.from(Q.completedSections),start_time:Q.startTime.toISOString()}},{data:i,error:a}=await t.from("leads").upsert(s,{onConflict:"campaign_id,email"}).select().single();if(a)throw a;K(e=>({...e,leadId:i.id}))}catch(e){console.error("Error saving lead data:",e)}},eO=async(e,t)=>{try{let s,r;if(!Q.leadId)return;let i=await (0,o.AG)(),a={};"object"==typeof t?(s="multiple_choice",r=JSON.stringify(t),a=t):(s="number"==typeof t?"number":"text",r=String(t));let{error:n}=await i.from("lead_responses").upsert({lead_id:Q.leadId,section_id:e,response_type:s,response_value:r,response_data:a},{onConflict:"lead_id,section_id"});if(n)throw n}catch(e){console.error("Error saving response:",e)}},eP=()=>{U||Q.currentSection<=0||(F(!0),K(e=>({...e,currentSection:Math.max(0,e.currentSection-1)})),setTimeout(()=>F(!1),300))},ez=()=>{U||Q.currentSection>=A.length-1||(F(!0),K(e=>({...e,currentSection:Math.min(A.length-1,e.currentSection+1)})),setTimeout(()=>F(!1),300))},eL=e=>{!U&&e!==Q.currentSection&&(e<0||e>=A.length||(F(!0),K(t=>({...t,currentSection:e})),setTimeout(()=>F(!1),300)))},eU=async(e,t,s)=>{let r=await eV(e.title||""),i=await eV(e.description||"");switch(e.type){case"capture":return eF(e,t,s,r,i);case"text_question":return eq(e,t,s,r,i);case"multiple_choice":return eB(e,t,s,r,i);case"slider":return eH(e,t,s,r,i);case"info":return eG(e,t,s,r,i);case"logic":return eW(e,t,s,r,i);case"output":return e$(e,t,s,r,i);default:return eJ(e,t)}},eF=(e,t,s,r,a)=>(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:(0,c.cn)("font-bold text-gray-900 mb-4 text-center",(null==_?void 0:_.type)==="mobile"?"text-2xl":"text-3xl"),children:r||"Capture Section"}),(0,i.jsx)("p",{className:(0,c.cn)("text-gray-600 mb-8 text-center",(null==_?void 0:_.type)==="mobile"?"text-base px-4":"text-lg"),children:a||"Please provide your information."}),(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault();let s=new FormData(e.currentTarget),r={};s.forEach((e,t)=>{r[t]=e}),e_(t,r)},className:"space-y-6",children:[(s.fields||eX()).map((t,s)=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{className:(0,c.cn)("block font-medium text-gray-700 mb-2",(null==_?void 0:_.type)==="mobile"?"text-base":"text-sm"),children:[t.label,t.required&&(0,i.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,i.jsx)("input",{type:t.type||"text",name:t.id,required:t.required,className:(0,c.cn)("w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",ev("px-4 py-3"),(null==_?void 0:_.type)==="mobile"&&"text-base"),placeholder:t.placeholder||"Enter your ".concat(t.label.toLowerCase()),onChange:s=>{ew(e.id,t.id,s.target.value,{fieldType:t.type||"text",fieldLabel:t.label,isRequired:t.required||!1})},defaultValue:Q.userInputs[t.id]||""})]},t.id||s)),(0,i.jsx)("div",{className:"text-center pt-4",children:(0,i.jsx)(l.$,{type:"submit",className:ev("bg-blue-600 hover:bg-blue-700 w-full"),size:(null==_?void 0:_.type)==="mobile"?"lg":"default",children:"Continue"})})]})]}),eq=(e,t,s,r,a)=>(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4 text-center",children:r||"Question"}),(0,i.jsx)("p",{className:"text-gray-600 mb-8 text-center text-lg",children:a||"Please provide your answer."}),(0,i.jsxs)("form",{onSubmit:s=>{s.preventDefault();let r=new FormData(s.currentTarget).get("answer");e_(t,{answer:r,[e.id]:r})},className:"space-y-6",children:[(0,i.jsx)("div",{children:"textarea"===s.input_type?(0,i.jsx)("textarea",{name:"answer",required:e.required,rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:s.placeholder||"Type your answer here...",onChange:t=>{ew(e.id,"answer",t.target.value,{inputType:"textarea",isRequired:e.required||!1,placeholder:s.placeholder})},defaultValue:Q.userInputs.answer||Q.userInputs[e.id]||""}):(0,i.jsx)("input",{type:s.input_type||"text",name:"answer",required:e.required,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:s.placeholder||"Type your answer here...",onChange:t=>{ew(e.id,"answer",t.target.value,{inputType:s.input_type||"text",isRequired:e.required||!1,placeholder:s.placeholder})},defaultValue:Q.userInputs.answer||Q.userInputs[e.id]||""})}),(0,i.jsx)("div",{className:"text-center pt-4",children:(0,i.jsx)(l.$,{type:"submit",size:"lg",className:"bg-blue-600 hover:bg-blue-700 px-8 py-3",children:"Continue"})})]})]}),eB=(e,t,s,r,a)=>(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4 text-center",children:r||"Make Your Choice"}),(0,i.jsx)("p",{className:"text-gray-600 mb-8 text-center text-lg",children:a||"Please select from the options below."}),(0,i.jsx)("div",{className:"space-y-4 max-w-2xl mx-auto",children:(e.options||eY()).map((s,r)=>(0,i.jsx)("div",{className:"p-6 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 cursor-pointer transition-all",onClick:()=>e_(t,{choice:s.value,[e.id]:s.value,selected_option:s.label}),children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"w-5 h-5 border-2 border-gray-300 rounded mr-4"}),(0,i.jsx)("span",{className:"text-lg text-gray-900",children:s.label})]})},s.id||r))})]}),eH=(e,t,s,r,n)=>{let o=Q.userInputs[e.id]||Q.userInputs.value,[c,d]=(0,a.useState)(o||s.default_value||50);return(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4 text-center",children:r||"Rate Your Experience"}),(0,i.jsx)("p",{className:"text-gray-600 mb-8 text-center text-lg",children:n||"Please move the slider to your preferred value."}),(0,i.jsxs)("div",{className:"max-w-md mx-auto space-y-6",children:[(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:c}),(0,i.jsxs)("div",{className:"text-sm text-gray-500",children:[s.min_label||"Minimum"," ← → ",s.max_label||"Maximum"]})]}),(0,i.jsx)("input",{type:"range",min:s.min_value||0,max:s.max_value||100,step:s.step||1,value:c,onChange:t=>{let r=Number(t.target.value);d(r),ew(e.id,"value",r,{inputType:"slider",minValue:s.min_value||0,maxValue:s.max_value||100,step:s.step||1,minLabel:s.min_label,maxLabel:s.max_label})},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),(0,i.jsx)("div",{className:"text-center pt-4",children:(0,i.jsx)(l.$,{onClick:()=>e_(t,{value:c,[e.id]:c}),size:"lg",className:"bg-blue-600 hover:bg-blue-700 px-8 py-3",children:"Continue"})})]})]})},eG=(e,t,s,r,a)=>(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:r||"Information"}),(0,i.jsx)("div",{className:"prose prose-lg mx-auto text-gray-600 mb-8",children:(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:a||"Information content here."}})}),(0,i.jsx)("div",{className:"text-center pt-4",children:(0,i.jsx)(l.$,{onClick:()=>e_(t,{viewed:!0}),size:"lg",className:"bg-blue-600 hover:bg-blue-700 px-8 py-3",children:"Continue"})})]}),eW=(e,t,s,r,n)=>{let[o,c]=(0,a.useState)(!1);(0,a.useEffect)(()=>{l()},[]);let l=async()=>{c(!0);try{await new Promise(e=>setTimeout(e,2e3)),e_(t,{processed:!0,logic_result:"processed",timestamp:new Date().toISOString()})}catch(e){console.error("Error processing logic section:",e)}finally{c(!1)}};return(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(h.A,{className:"h-16 w-16 text-blue-600 mx-auto mb-6"}),(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:r||"Processing Your Information"}),(0,i.jsx)("div",{className:"prose prose-lg mx-auto text-gray-600",children:(0,i.jsx)("p",{children:n||"Please wait while we analyze your responses..."})}),o&&(0,i.jsxs)("div",{className:"mt-8 flex items-center justify-center",children:[(0,i.jsx)(u.A,{className:"h-8 w-8 animate-spin text-blue-600 mr-3"}),(0,i.jsx)("span",{className:"text-gray-600",children:"Processing..."})]})]})},e$=(e,t,s,r,n)=>{let o,[l,y]=(0,a.useState)(""),[v,x]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{v||Q.currentSection!==t||(async()=>{await ey(e),y(await en(e)),x(!0)})()},[Q.currentSection,t,v]),eg.isProcessing&&Q.currentSection===t)?(0,i.jsxs)("div",{className:"text-center max-w-2xl mx-auto",children:[(0,i.jsx)(h.A,{className:"h-16 w-16 text-blue-600 mx-auto mb-6 animate-pulse"}),(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Processing Your Results"}),(0,i.jsxs)("div",{className:"mb-8",children:[(0,i.jsx)("div",{className:"flex items-center justify-center mb-4",children:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("div",{className:"text-sm text-gray-600",children:eg.message}),(0,i.jsx)(u.A,{className:"h-4 w-4 animate-spin text-blue-600"})]})}),(0,i.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-4",children:(0,i.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(eg.progress,"%")}})}),(0,i.jsxs)("div",{className:"flex justify-center space-x-8 text-xs",children:[(0,i.jsxs)("div",{className:(0,c.cn)("flex items-center space-x-1",eg.progress>=20?"text-blue-600":"text-gray-400"),children:[(0,i.jsx)("div",{className:(0,c.cn)("w-2 h-2 rounded-full",eg.progress>=20?"bg-blue-600":"bg-gray-300")}),(0,i.jsx)("span",{children:"Analyzing"})]}),(0,i.jsxs)("div",{className:(0,c.cn)("flex items-center space-x-1",eg.progress>=60?"text-blue-600":"text-gray-400"),children:[(0,i.jsx)("div",{className:(0,c.cn)("w-2 h-2 rounded-full",eg.progress>=60?"bg-blue-600":"bg-gray-300")}),(0,i.jsx)("span",{children:"Generating"})]}),(0,i.jsxs)("div",{className:(0,c.cn)("flex items-center space-x-1",eg.progress>=90?"text-blue-600":"text-gray-400"),children:[(0,i.jsx)("div",{className:(0,c.cn)("w-2 h-2 rounded-full",eg.progress>=90?"bg-blue-600":"bg-gray-300")}),(0,i.jsx)("span",{children:"Finalizing"})]})]})]}),(0,i.jsx)("p",{className:"text-gray-600",children:"We're analyzing your responses to create personalized results just for you..."})]}):(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(p.A,{className:"h-16 w-16 text-green-600 mx-auto mb-6"}),(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:r||"Your Results Are Ready!"}),(0,i.jsx)("div",{className:"prose prose-lg mx-auto text-gray-600 mb-8",children:(o=l||n||"Thank you for completing this campaign.",Object.entries({...Q.userInputs,completion_time:Math.round((new Date().getTime()-Q.startTime.getTime())/1e3),completion_percentage:ee.totalProgress,sections_completed:Q.completedSections.size,total_sections:A.length}).forEach(e=>{let[t,s]=e;o=o.replace(RegExp("@".concat(t),"g"),String(s))}),(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:o}}))}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto mb-8",children:[(0,i.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,i.jsx)(m.A,{className:"h-5 w-5 text-blue-600 mr-2"}),(0,i.jsx)("span",{className:"text-sm font-medium text-blue-800",children:"Completion Time"})]}),(0,i.jsx)("div",{className:"text-xl font-bold text-blue-600",children:(()=>{let e=Math.round((new Date().getTime()-Q.startTime.getTime())/1e3),t=Math.floor(e/60);return"".concat(t,"m ").concat(e%60,"s")})()})]}),(0,i.jsxs)("div",{className:"bg-green-50 rounded-lg p-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,i.jsx)(g.A,{className:"h-5 w-5 text-green-600 mr-2"}),(0,i.jsx)("span",{className:"text-sm font-medium text-green-800",children:"Progress"})]}),(0,i.jsxs)("div",{className:"text-xl font-bold text-green-600",children:[ee.totalProgress,"%"]})]}),(0,i.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,i.jsx)(f.A,{className:"h-5 w-5 text-purple-600 mr-2"}),(0,i.jsx)("span",{className:"text-sm font-medium text-purple-800",children:"Responses"})]}),(0,i.jsx)("div",{className:"text-xl font-bold text-purple-600",children:Object.keys(Q.userInputs).length})]})]}),ee.milestones.length>0&&(0,i.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 max-w-2xl mx-auto",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Milestones Achieved"}),(0,i.jsx)("div",{className:"flex flex-wrap justify-center gap-2",children:ee.milestones.map((e,t)=>(0,i.jsxs)(d.E,{variant:"secondary",className:"bg-green-100 text-green-800",children:["✓ ",e]},t))})]})]})},eJ=(e,t)=>(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(y.A,{className:"h-12 w-12 text-orange-500 mx-auto mb-4"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Unsupported Section Type"}),(0,i.jsxs)("p",{className:"text-gray-600 mb-6",children:['Section type "',e.type,'" is not yet supported in the public view.']}),(0,i.jsx)(l.$,{onClick:()=>e_(t,{skipped:!0}),variant:"outline",children:"Skip This Section"})]}),eX=()=>[{id:"name",type:"text",label:"Full Name",required:!0},{id:"email",type:"email",label:"Email Address",required:!0}],eY=()=>[{id:"1",label:"Option 1",value:"option1"},{id:"2",label:"Option 2",value:"option2"},{id:"3",label:"Option 3",value:"option3"}],eZ=function(e,t){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=arguments.length>3?arguments[3]:void 0;return{message:e,type:t,retryable:s,retryCount:0,details:r,lastRetryAt:void 0,recovered:!1}},eQ=(e,t)=>{let s;I(s="type"in e?e:e.message.includes("fetch")||e.message.includes("network")?eZ("Network connection issue. Please check your internet connection.","network",!0,{originalError:e.message,context:t}):e.message.includes("401")||e.message.includes("403")?eZ("This campaign is no longer available or access is restricted.","api",!1,{originalError:e.message,context:t}):e.message.includes("404")?eZ("Campaign not found. Please check the URL.","api",!1,{originalError:e.message,context:t}):eZ("An unexpected error occurred. Please try again.","system",!0,{originalError:e.message,context:t})),console.error("Campaign Error:",s),"object"==typeof e&&"stack"in e&&ep.handleError(ep.createError(e,eh.API,{location:{function:(null==t?void 0:t.function)||"unknown"},metadata:{errorState:s,context:t}}))},eK=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3?arguments[3]:void 0;for(let i=0;i<=t;i++)try{let t=await e();return(null==V?void 0:V.retryable)&&(I(e=>e?{...e,recovered:!0}:null),setTimeout(()=>I(null),2e3)),t}catch(a){if(i===t)throw a;(null==V?void 0:V.retryable)&&I(e=>e?{...e,retryCount:(e.retryCount||0)+1,lastRetryAt:new Date}:null);let e=s*Math.pow(2,i);await new Promise(t=>setTimeout(t,e)),console.log("Retry attempt ".concat(i+1,"/").concat(t+1," for ").concat(r," in ").concat(e,"ms"))}},e0=async()=>{if(V)try{switch(C(!0),V.type){case"network":M.isOnline?await eK(()=>eD(),2,1e3,"network recovery"):I(eZ("No internet connection. Please check your network and try again.","network",!0));break;case"api":V.retryable&&await eK(()=>eD(),1,2e3,"api recovery");break;case"system":await eK(()=>eD(),1,1e3,"system recovery");break;default:await eK(()=>eD(),1,1e3,"generic recovery")}}catch(e){eQ(e,{function:"recoverFromError"})}finally{C(!1)}};return k?(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(u.A,{className:"h-8 w-8 animate-spin text-blue-600 mx-auto mb-4"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Loading Campaign"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Please wait while we prepare your experience..."})]})}):V?(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,i.jsxs)("div",{className:"text-center max-w-md mx-auto",children:["network"===V.type?(0,i.jsxs)("div",{className:"relative",children:[M.isOnline?(0,i.jsx)(v.A,{className:"h-12 w-12 text-amber-500 mx-auto mb-4"}):(0,i.jsx)(x.A,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),V.retryCount&&V.retryCount>0&&(0,i.jsx)("div",{className:"absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:V.retryCount})]}):"validation"===V.type?(0,i.jsx)(b.A,{className:"h-12 w-12 text-amber-500 mx-auto mb-4"}):(0,i.jsx)(y.A,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,i.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"network"===V.type?"Connection Issue":"validation"===V.type?"Access Required":"api"===V.type?"Campaign Unavailable":"Something went wrong"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:V.message}),"network"===V.type&&(0,i.jsx)("div",{className:(0,c.cn)("inline-flex items-center px-3 py-1 rounded-full text-sm mb-4",M.isOnline?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:M.isOnline?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.A,{className:"h-3 w-3 mr-1"}),"Connected"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.A,{className:"h-3 w-3 mr-1"}),"Offline"]})}),V.recovered&&(0,i.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-center",children:[(0,i.jsx)(p.A,{className:"h-4 w-4 text-green-600 mr-2"}),(0,i.jsx)("span",{className:"text-sm text-green-800",children:"Connection restored"})]})}),(0,i.jsxs)("div",{className:"space-y-3",children:[V.retryable&&(0,i.jsx)(l.$,{onClick:e0,disabled:k,className:ev("bg-blue-600 hover:bg-blue-700 w-full"),size:(null==_?void 0:_.type)==="mobile"?"lg":"default",children:k?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.A,{className:"h-4 w-4 animate-spin mr-2"}),"Retrying..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(w.A,{className:"h-4 w-4 mr-2"}),"Try Again"]})}),"validation"===V.type&&A.length>0&&(0,i.jsx)(l.$,{onClick:()=>{I(null);let e=A.findIndex(e=>"capture"===e.type);e>=0&&eL(e)},className:ev("bg-green-600 hover:bg-green-700 w-full"),size:(null==_?void 0:_.type)==="mobile"?"lg":"default",children:"Complete Required Information"}),!V.retryable&&"validation"!==V.type&&(0,i.jsx)(l.$,{variant:"outline",onClick:()=>window.location.reload(),className:ev("w-full"),size:(null==_?void 0:_.type)==="mobile"?"lg":"default",children:"Reload Page"}),"validation"===V.type&&(0,i.jsx)(l.$,{variant:"outline",onClick:()=>I(null),className:ev("w-full"),size:(null==_?void 0:_.type)==="mobile"?"lg":"default",children:"Continue Where I Left Off"})]}),!1,!1]})}):r&&0!==A.length?(0,i.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[eo&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg p-8 max-w-md mx-4 text-center",children:[(0,i.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDF89"}),(0,i.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Campaign Complete!"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:ed}),(0,i.jsx)("div",{className:"flex justify-center space-x-2 mb-4",children:ee.milestones.map((e,t)=>(0,i.jsx)(d.E,{variant:"secondary",className:"text-xs",children:e},t))}),(0,i.jsx)(l.$,{onClick:()=>ec(!1),className:"bg-green-600 hover:bg-green-700",children:"Continue"})]})}),(0,i.jsx)("div",{className:"bg-white border-b",children:(0,i.jsxs)("div",{className:"max-w-4xl mx-auto px-6 py-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(E.A,{className:"h-5 w-5 text-blue-600 mr-2"}),(0,i.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:r.name})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[J.size>0&&(0,i.jsxs)("div",{className:"flex items-center text-sm text-amber-600",children:[(0,i.jsx)(u.A,{className:"h-3 w-3 animate-spin mr-1"}),(0,i.jsx)("span",{children:"Saving..."})]}),0===J.size&&Y&&Q.userInputs&&Object.keys(Q.userInputs).length>0&&(0,i.jsxs)("div",{className:"flex items-center text-sm text-green-600",children:[(0,i.jsx)(p.A,{className:"h-3 w-3 mr-1"}),(0,i.jsx)("span",{children:"Saved"})]}),(0,i.jsxs)("div",{className:"flex flex-col items-end",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,i.jsxs)("span",{className:"text-sm text-gray-600",children:[Q.currentSection+1," of ",A.length]}),(0,i.jsxs)("span",{className:"text-sm font-medium text-blue-600",children:[ee.weightedProgress,"%"]})]}),ee.timeEstimate>0&&(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["~",Math.ceil(ee.timeEstimate/60),"min remaining • Est. ",ee.completionForecast]}),(0,i.jsx)("div",{className:"w-32 h-1 bg-gray-200 rounded-full mt-1",children:(0,i.jsx)("div",{className:"h-1 bg-blue-600 rounded-full transition-all duration-300",style:{width:"".concat(ee.weightedProgress,"%")}})})]}),(0,i.jsx)("div",{className:"flex space-x-1",children:A.map((e,t)=>{let s=ei(t).canAccess;return(0,i.jsx)("div",{className:(0,c.cn)("w-2 h-2 rounded-full transition-colors cursor-pointer",t===Q.currentSection?"bg-blue-600 ring-2 ring-blue-200":Q.completedSections.has(t)?"bg-green-500":s?"bg-gray-300 hover:bg-gray-400":"bg-gray-200"),onClick:()=>{s&&t!==Q.currentSection&&ea(t)},title:"".concat(e.title||"Section ".concat(t+1)).concat(s?"":" (Locked)")},t)})})]})]}),ee.milestones.length>0&&(0,i.jsx)("div",{className:"mt-3 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(g.A,{className:"h-4 w-4 text-green-600"}),(0,i.jsx)("div",{className:"flex space-x-1",children:ee.milestones.slice(-2).map((e,t)=>(0,i.jsx)(d.E,{variant:"secondary",className:"text-xs bg-green-50 text-green-700",children:e},t))})]})})]})}),(0,i.jsx)("div",{className:"py-12 px-6",children:A.map((e,t)=>eU(e,t,e.configuration||{}))}),(0,i.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg",children:(0,i.jsx)("div",{className:"max-w-4xl mx-auto px-6 py-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)(l.$,{variant:"outline",onClick:eP,disabled:U||Q.currentSection<=0,className:(0,c.cn)(ev("transition-all duration-200"),U&&"opacity-50 cursor-not-allowed",(null==_?void 0:_.type)==="mobile"&&"px-6 py-3"),size:(null==_?void 0:_.type)==="mobile"?"lg":"default",children:[(0,i.jsx)(S.A,{className:(0,c.cn)("mr-1",(null==_?void 0:_.type)==="mobile"?"h-5 w-5":"h-4 w-4")}),"Previous"]}),(0,i.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsxs)("span",{className:"text-sm text-gray-600",children:[Q.currentSection+1," of ",A.length]}),U&&(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(u.A,{className:"h-3 w-3 animate-spin text-blue-600 mr-1"}),(0,i.jsx)("span",{className:"text-xs text-blue-600",children:"Transitioning..."})]})]}),(0,i.jsx)("div",{className:"text-xs text-gray-400 text-center max-w-xs",children:(null==_?void 0:_.touchCapable)?"Swipe left/right or use buttons to navigate":"Use arrow keys or buttons to navigate"}),!M.isOnline&&(0,i.jsxs)("div",{className:"flex items-center text-xs text-red-500",children:[(0,i.jsx)(x.A,{className:"h-3 w-3 mr-1"}),(0,i.jsx)("span",{children:"Offline"})]})]}),(0,i.jsxs)(l.$,{variant:"outline",onClick:ez,disabled:U||Q.currentSection>=A.length-1,className:(0,c.cn)(ev("transition-all duration-200"),U&&"opacity-50 cursor-not-allowed",(null==_?void 0:_.type)==="mobile"&&"px-6 py-3"),size:(null==_?void 0:_.type)==="mobile"?"lg":"default",children:["Next",(0,i.jsx)(T.A,{className:(0,c.cn)("ml-1",(null==_?void 0:_.type)==="mobile"?"h-5 w-5":"h-4 w-4")})]})]})})})]}):(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(E.A,{className:"h-8 w-8 text-gray-400 mx-auto mb-4"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Content"}),(0,i.jsx)("p",{className:"text-gray-600",children:"This campaign doesn't have any content to display."})]})})}},94449:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(90602).A)("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]])},97168:(e,t,s)=>{"use strict";s.d(t,{$:()=>l});var r=s(95155),i=s(12115),a=s(99708),n=s(74466),o=s(53999);let c=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),l=i.forwardRef((e,t)=>{let{className:s,variant:i,size:n,asChild:l=!1,...d}=e,h=l?a.DX:"button";return(0,r.jsx)(h,{className:(0,o.cn)(c({variant:i,size:n,className:s})),ref:t,...d})});l.displayName="Button"}},e=>{var t=t=>e(e.s=t);e.O(0,[935,352,441,684,358],()=>t(51272)),_N_E=e.O()}]);