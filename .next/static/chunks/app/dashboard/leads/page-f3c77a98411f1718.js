(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[950],{95130:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>C});var l=a(95155),t=a(12115),r=a(35695),c=a(97168),i=a(88482),n=a(89852),d=a(88145),m=a(62533),x=a(76052),o=a(17712),h=a(54120),p=a(90242),u=a(12520),j=a(42355),N=a(47924),v=a(21492),g=a(28883),f=a(19420),y=a(69074),w=a(92657),b=a(5623),E=a(13052),_=a(17580);function C(){let{user:e,loading:s}=(0,x.A)(),a=(0,r.useRouter)(),[C,k]=(0,t.useState)(null),[S,A]=(0,t.useState)([]),[z,D]=(0,t.useState)([]),[$,L]=(0,t.useState)(!0),[M,P]=(0,t.useState)(null),[F,R]=(0,t.useState)(""),[Z,B]=(0,t.useState)("all"),[W,O]=(0,t.useState)("created_at"),[T,U]=(0,t.useState)("desc"),[V,H]=(0,t.useState)(1),[I,K]=(0,t.useState)(0),[Y,q]=(0,t.useState)(0),[G,J]=(0,t.useState)([]),[Q,X]=(0,t.useState)(!1);(0,t.useEffect)(()=>{s||e||a.push("/auth/login")},[e,s,a]),(0,t.useEffect)(()=>{e&&ee()},[e,V,F,Z,W,T]),(0,t.useEffect)(()=>{e&&C&&ea()},[e,C,F,Z,W,T]);let ee=async()=>{try{L(!0),P(null);let[l,t]=await Promise.all([(0,o.Rk)(),(0,o.ME)({page:1,per_page:100})]);l.success&&l.data&&k(l.data),t.success&&t.data&&D(t.data.data||[]);let r=await (0,o.ah)({page:V,per_page:20});if(!r.success)throw Error(r.error||"Failed to load leads");if(r.data){var e,s,a;let l=(null==(e=r.data.data)?void 0:e.map(e=>{var s,a;let l=(null==(a=t.data)||null==(s=a.data)?void 0:s.find(s=>s.id===e.campaign_id))||null;return{...e,campaign:l}}))||[];F&&(l=l.filter(e=>{var s,a,l,t;return(null==(s=e.email)?void 0:s.toLowerCase().includes(F.toLowerCase()))||(null==(a=e.phone)?void 0:a.includes(F))||(null==(t=e.campaign)||null==(l=t.name)?void 0:l.toLowerCase().includes(F.toLowerCase()))})),"all"!==Z&&(l=l.filter(e=>e.campaign_id===Z)),l.sort((e,s)=>{let a,l;switch(W){case"created_at":a=new Date(e.created_at),l=new Date(s.created_at);break;case"email":a=e.email||"",l=s.email||"";break;case"phone":a=e.phone||"",l=s.phone||"";break;case"campaign_name":var t,r;a=(null==(t=e.campaign)?void 0:t.name)||"",l=(null==(r=s.campaign)?void 0:r.name)||"";break;default:a=e.created_at,l=s.created_at}return a<l?"asc"===T?-1:1:a>l?"asc"===T?1:-1:0}),A(l),K((null==(s=r.data.meta)?void 0:s.total)||0),q(Math.ceil(((null==(a=r.data.meta)?void 0:a.total)||0)/20))}}catch(e){console.error("Error loading leads data:",e),P(e instanceof Error?e.message:"An error occurred")}finally{L(!1)}},es=e=>{W===e?U("asc"===T?"desc":"asc"):(O(e),U("asc"))},ea=async()=>{try{X(!0);let e=await (0,u.K)({searchTerm:F,selectedCampaign:Z,sortField:W,sortDirection:T,includeCompleted:!0,maxRecords:1e3},C);e.success&&e.data?J(e.data):(console.error("Failed to load export data:",e.error),J([]))}catch(e){console.error("Error loading export data:",e),J([])}finally{X(!1)}},el=e=>e.email&&e.phone?(0,l.jsx)(d.E,{variant:"default",children:"Email + Phone"}):e.email?(0,l.jsx)(d.E,{variant:"secondary",children:"Email"}):e.phone?(0,l.jsx)(d.E,{variant:"outline",children:"Phone"}):(0,l.jsx)(d.E,{variant:"destructive",children:"No Contact"}),et=e=>e?(0,l.jsx)(d.E,{variant:{published:"default",draft:"secondary",archived:"outline"}[e.status]||"outline",children:e.name}):(0,l.jsx)(d.E,{variant:"outline",children:"Unknown"});return s?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):e?(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)("header",{className:"bg-white shadow",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)(c.$,{variant:"ghost",onClick:()=>a.push("/dashboard"),className:"text-gray-600 hover:text-gray-900",children:[(0,l.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),(0,l.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Leads"})]}),(0,l.jsx)("div",{className:"flex items-center space-x-4",children:(0,l.jsx)(m.F,{variant:"compact"})})]})})}),(0,l.jsx)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-4 sm:space-y-0",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,l.jsx)("span",{className:"font-medium text-lg text-gray-900",children:I}),(0,l.jsx)("span",{className:"ml-1",children:"total leads"})]}),C&&(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,l.jsxs)("span",{className:"font-medium",children:[C.monthly_leads_captured||0," / ",C.monthly_leads_limit||1e3]}),(0,l.jsx)("span",{className:"ml-1",children:"leads this month"})]})]}),(0,l.jsx)("div",{className:"flex items-center space-x-3",children:(0,l.jsx)(h.NV,{data:G,source:"leads",title:"Export Leads Data",defaultFields:(0,u.Dj)(),onExportStart:()=>{console.log("Export started...")},onExportComplete:e=>{console.log("Export completed: ".concat(e))},onExportError:e=>{console.error("Export error:",e),P("Export failed: ".concat(e))},variant:"outline",size:"sm",disabled:Q,showDropdown:!0})})]}),(0,l.jsx)(i.Zp,{className:"mb-6",children:(0,l.jsx)(i.Wu,{className:"pt-6",children:(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(N.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,l.jsx)(n.p,{placeholder:"Search leads by email, phone, or campaign...",value:F,onChange:e=>R(e.target.value),className:"pl-10"})]})}),(0,l.jsx)("div",{className:"w-full sm:w-64",children:(0,l.jsxs)("select",{value:Z,onChange:e=>B(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",children:[(0,l.jsx)("option",{value:"all",children:"All Campaigns"}),z.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})})]})})}),M&&(0,l.jsx)(i.Zp,{className:"mb-6 border-red-200 bg-red-50",children:(0,l.jsx)(i.Wu,{className:"pt-6",children:(0,l.jsxs)("div",{className:"text-red-800",children:[(0,l.jsx)("p",{className:"font-medium",children:"Error loading leads"}),(0,l.jsx)("p",{className:"text-sm mt-1",children:M}),(0,l.jsx)(c.$,{variant:"outline",size:"sm",className:"mt-2",onClick:ee,children:"Try Again"})]})})}),(0,l.jsxs)(i.Zp,{children:[(0,l.jsxs)(i.aR,{children:[(0,l.jsx)(i.ZB,{children:"Lead Database"}),(0,l.jsx)(i.BT,{children:"Manage and view all captured leads from your campaigns"})]}),(0,l.jsx)(i.Wu,{children:$?(0,l.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,l.jsxs)("div",{className:"flex items-center space-x-4 p-4 border rounded-lg animate-pulse",children:[(0,l.jsx)("div",{className:"h-10 w-10 bg-gray-200 rounded-full"}),(0,l.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,l.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),(0,l.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),(0,l.jsx)("div",{className:"h-6 w-20 bg-gray-200 rounded"})]},s))}):S.length>0?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full",children:[(0,l.jsx)("thead",{className:"border-b",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"text-left py-3 px-4",children:(0,l.jsxs)(c.$,{variant:"ghost",size:"sm",onClick:()=>es("email"),className:"hover:bg-gray-100 font-medium",children:["Contact Info",(0,l.jsx)(v.A,{className:"ml-2 h-4 w-4"})]})}),(0,l.jsx)("th",{className:"text-left py-3 px-4",children:(0,l.jsxs)(c.$,{variant:"ghost",size:"sm",onClick:()=>es("campaign_name"),className:"hover:bg-gray-100 font-medium",children:["Campaign",(0,l.jsx)(v.A,{className:"ml-2 h-4 w-4"})]})}),(0,l.jsx)("th",{className:"text-left py-3 px-4",children:"Source"}),(0,l.jsx)("th",{className:"text-left py-3 px-4",children:(0,l.jsxs)(c.$,{variant:"ghost",size:"sm",onClick:()=>es("created_at"),className:"hover:bg-gray-100 font-medium",children:["Created",(0,l.jsx)(v.A,{className:"ml-2 h-4 w-4"})]})}),(0,l.jsx)("th",{className:"text-right py-3 px-4",children:"Actions"})]})}),(0,l.jsx)("tbody",{className:"divide-y",children:S.map(e=>(0,l.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,l.jsx)("td",{className:"py-4 px-4",children:(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("div",{className:"flex items-center space-x-2",children:e.email&&(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsx)(g.A,{className:"h-4 w-4 text-gray-400"}),(0,l.jsx)("span",{className:"text-sm font-medium",children:e.email})]})}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[e.phone&&(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsx)(f.A,{className:"h-4 w-4 text-gray-400"}),(0,l.jsx)("span",{className:"text-sm text-gray-600",children:e.phone})]}),el(e)]})]})}),(0,l.jsx)("td",{className:"py-4 px-4",children:et(e.campaign)}),(0,l.jsx)("td",{className:"py-4 px-4",children:(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsx)("div",{className:"text-gray-900",children:e.utm_source||"Direct"}),e.utm_source&&(0,l.jsx)("div",{className:"text-gray-500",children:e.utm_source||"Unknown"})]})}),(0,l.jsx)("td",{className:"py-4 px-4",children:(0,l.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-600",children:[(0,l.jsx)(y.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:new Date(e.created_at).toLocaleDateString()})]})}),(0,l.jsx)("td",{className:"py-4 px-4 text-right",children:(0,l.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,l.jsx)(c.$,{variant:"ghost",size:"sm",children:(0,l.jsx)(w.A,{className:"h-4 w-4"})}),(0,l.jsx)(c.$,{variant:"ghost",size:"sm",children:(0,l.jsx)(b.A,{className:"h-4 w-4"})})]})})]},e.id))})]})}),Y>1&&(0,l.jsxs)("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing ",(V-1)*20+1," to ",Math.min(20*V,I)," of ",I," leads"]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>H(Math.max(1,V-1)),disabled:1===V,children:[(0,l.jsx)(j.A,{className:"h-4 w-4"}),"Previous"]}),(0,l.jsxs)("span",{className:"text-sm text-gray-600",children:["Page ",V," of ",Y]}),(0,l.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>H(Math.min(Y,V+1)),disabled:V===Y,children:["Next",(0,l.jsx)(E.A,{className:"h-4 w-4"})]})]})]})]}):(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)(_.A,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No leads yet"}),(0,l.jsx)("p",{className:"text-gray-500 mb-4",children:"Leads will appear here once people start completing your campaigns."}),(0,l.jsx)(c.$,{onClick:()=>a.push("/dashboard/campaigns"),size:"sm",children:"View Your Campaigns"})]})})]}),(0,l.jsx)("div",{className:"mt-6",children:(0,l.jsx)(p.H,{source:"leads",maxEntries:10,showStats:!0,compact:!1})})]})})]}):null}},96817:(e,s,a)=>{Promise.resolve().then(a.bind(a,95130))}},e=>{var s=s=>e(e.s=s);e.O(0,[524,935,352,590,963,710,915,178,533,652,441,684,358],()=>s(96817)),_N_E=e.O()}]);