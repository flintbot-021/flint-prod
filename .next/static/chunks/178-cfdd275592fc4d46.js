"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{2382:(e,a,t)=>{t.d(a,{Rk:()=>n,canCaptureLeads:()=>l,canCreateCampaign:()=>o,incrementCampaignUsage:()=>i,incrementLeadsUsage:()=>s});var r=t(85793);async function n(){let e=await (0,r.oC)(),a=await (0,r.AG)();return(0,r.Uj)(async()=>await a.from("profiles").select("*").eq("id",e).single())}async function i(){let e=await (0,r.oC)(),a=await (0,r.AG)(),{data:t,error:n}=await a.from("profiles").select("monthly_campaigns_used, monthly_campaign_limit").eq("id",e).single();if(n)return{success:!1,error:n.message||"Failed to fetch profile"};let i=t.monthly_campaigns_used||0,s=t.monthly_campaign_limit||0;return s>0&&i>=s?{success:!1,error:"Monthly campaign limit exceeded",validation_errors:[{field:"monthly_campaigns_used",message:"You have reached your monthly limit of ".concat(s," campaigns"),code:"LIMIT_EXCEEDED",value:i}]}:(0,r.Uj)(async()=>await a.from("profiles").update({monthly_campaigns_used:i+1,updated_at:new Date().toISOString()}).eq("id",e).select().single())}async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=await (0,r.oC)(),t=await (0,r.AG)(),{data:n,error:i}=await t.from("profiles").select("monthly_leads_captured, monthly_leads_limit").eq("id",a).single();if(i)return{success:!1,error:i.message||"Failed to fetch profile"};let s=n.monthly_leads_captured||0,o=n.monthly_leads_limit||0;return o>0&&s+e>o?{success:!1,error:"Monthly leads limit exceeded",validation_errors:[{field:"monthly_leads_captured",message:"Adding ".concat(e," lead(s) would exceed your monthly limit of ").concat(o," leads"),code:"LIMIT_EXCEEDED",value:s}]}:(0,r.Uj)(async()=>await t.from("profiles").update({monthly_leads_captured:s+e,updated_at:new Date().toISOString()}).eq("id",a).select().single())}async function o(){let e=await (0,r.oC)(),a=await (0,r.AG)();return(0,r.Uj)(async()=>{let{data:t,error:r}=await a.from("profiles").select("monthly_campaigns_used, monthly_campaign_limit").eq("id",e).single();return r?{data:null,error:r}:{data:t.monthly_campaign_limit<=0||t.monthly_campaigns_used<t.monthly_campaign_limit,error:null}})}async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=await (0,r.oC)(),t=await (0,r.AG)();return(0,r.Uj)(async()=>{let{data:r,error:n}=await t.from("profiles").select("monthly_leads_captured, monthly_leads_limit").eq("id",a).single();return n?{data:null,error:n}:{data:r.monthly_leads_limit<=0||r.monthly_leads_captured+e<=r.monthly_leads_limit,error:null}})}},17712:(e,a,t)=>{t.d(a,{JU:()=>r.JU,KT:()=>n.KT,K_:()=>r.K_,LE:()=>l,ME:()=>r.ME,Rk:()=>i.Rk,SX:()=>r.SX,TF:()=>r.TF,Tq:()=>o,Ys:()=>r.Ys,ah:()=>n.ah,h1:()=>r.h1,jz:()=>r.jz,lT:()=>r.lT,s2:()=>r.publishCampaign,t9:()=>r.t9}),t(85793);var r=t(75479),n=t(41131),i=t(2382);async function s(e){let{createLead:a}=await Promise.resolve().then(t.bind(t,41131)),{incrementLeadsUsage:r,canCaptureLeads:n}=await Promise.resolve().then(t.bind(t,2382)),i=await n(1);if(!i.success)return i;if(!i.data)return{success:!1,error:"Monthly leads limit reached"};let s=await a(e);return s.success&&await r(1),s}async function o(e){let{createCampaign:a}=await Promise.resolve().then(t.bind(t,75479)),{incrementCampaignUsage:r,canCreateCampaign:n}=await Promise.resolve().then(t.bind(t,2382)),i=await n();if(!i.success)return i;if(!i.data)return{success:!1,error:"Monthly campaign limit reached"};let s=await a(e);return s.success&&await r(),s}async function l(e,a,t){return a.email?s({campaign_id:e,name:a.name||null,email:a.email,phone:a.phone||null,ip_address:(null==t?void 0:t.ip_address)||null,user_agent:(null==t?void 0:t.user_agent)||null,referrer:(null==t?void 0:t.referrer)||null,utm_source:(null==t?void 0:t.utm_source)||null,utm_medium:(null==t?void 0:t.utm_medium)||null,utm_campaign:(null==t?void 0:t.utm_campaign)||null,utm_term:(null==t?void 0:t.utm_term)||null,utm_content:(null==t?void 0:t.utm_content)||null,metadata:{capture_form:!0,gdpr_consent:a.gdprConsent||!1,marketing_consent:a.marketingConsent||!1,capture_timestamp:new Date().toISOString()},completed_at:null}):{success:!1,error:"Email is required",validation_errors:[{field:"email",message:"Email address is required",code:"REQUIRED_FIELD",value:a.email}]}}},41131:(e,a,t)=>{t.d(a,{KT:()=>i,ah:()=>s,createLead:()=>n});var r=t(85793);async function n(e){let a=(0,r.Rv)(e,["campaign_id","email"]);if(a.length>0)return{success:!1,error:"Validation failed",validation_errors:a};if(!(0,r.aJ)(e.campaign_id))return{success:!1,error:"Invalid campaign ID format"};if(!(0,r.B9)(e.email))return{success:!1,error:"Invalid email format",validation_errors:[{field:"email",message:"Please provide a valid email address",code:"INVALID_EMAIL",value:e.email}]};let t=await (0,r.AG)();return(0,r.Uj)(async()=>await t.from("leads").insert(e).select().single())}async function i(e){if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let a=await (0,r.AG)();return(0,r.Uj)(async()=>{let{count:t}=await a.from("leads").select("*",{count:"exact",head:!0}).eq("campaign_id",e),{count:r}=await a.from("leads").select("*",{count:"exact",head:!0}).eq("campaign_id",e).not("completed_at","is",null),{data:n}=await a.from("leads").select("*").eq("campaign_id",e).order("created_at",{ascending:!1}).limit(10),i=t||0,s=r||0;return{data:{total:i,completed:s,conversion_rate:Math.round(100*(i>0?s/i*100:0))/100,recent_leads:n||[]},error:null}})}async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await (0,r.oC)();let a=await (0,r.AG)(),{campaign_id:t,completed:n,search:i,...s}=e;return(0,r.Uj)(async()=>{let e=a.from("leads").select("\n        *,\n        campaigns!inner (*)\n      ",{count:"exact"});t&&(e=e.eq("campaign_id",t)),void 0!==n&&(e=n?e.not("completed_at","is",null):e.is("completed_at",null)),i&&(e=e.or("name.ilike.%".concat(i,"%,email.ilike.%").concat(i,"%,phone.ilike.%").concat(i,"%"))),e=(0,r.fu)(e,{sort_by:"created_at",sort_order:"desc",...s});let{data:o,error:l,count:c}=await e;if(l)return{data:null,error:l};let{page:d=1,per_page:u=20}=s,m=Math.ceil((c||0)/u);return{data:{data:o||[],meta:{total:c||0,page:d,per_page:u,has_more:d<m,total_pages:m}},error:null}})}},46414:(e,a,t)=>{t.d(a,{U:()=>n});var r=t(81935);function n(){return(0,r.createBrowserClient)("http://127.0.0.1:54321","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0")}},53999:(e,a,t)=>{t.d(a,{cn:()=>i});var r=t(52596),n=t(39688);function i(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,n.QP)((0,r.$)(a))}},75479:(e,a,t)=>{t.d(a,{JU:()=>p,K_:()=>l,ME:()=>s,SX:()=>o,TF:()=>d,Ys:()=>g,createCampaign:()=>n,h1:()=>m,jz:()=>i,lT:()=>f,publishCampaign:()=>u,t9:()=>h});var r=t(85793);async function n(e){let a=(0,r.Rv)(e,["name"]);if(a.length>0)return{success:!1,error:"Validation failed",validation_errors:a};let t=await (0,r.oC)(),n=await (0,r.AG)();return(0,r.Uj)(async()=>await n.from("campaigns").insert({...e,user_id:t}).select().single())}async function i(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let t=await (0,r.AG)();return(0,r.Uj)(async()=>{let r=t.from("campaigns").select(a?"\n        *,\n        sections (\n          *,\n          section_options (*)\n        ),\n        campaign_variables (*),\n        campaign_analytics (*)\n      ":"*").eq("id",e);return await r.single()})}async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=await (0,r.oC)(),t=await (0,r.AG)(),{status:n,search:i,...s}=e;return(0,r.Uj)(async()=>{let e=t.from("campaigns").select("*",{count:"exact"}).eq("user_id",a);n&&(e=e.eq("status",n)),i&&(e=e.or("name.ilike.%".concat(i,"%,description.ilike.%").concat(i,"%"))),e=(0,r.fu)(e,{sort_by:"created_at",...s});let{data:o,error:l,count:c}=await e;if(l)return{data:null,error:l};let{page:d=1,per_page:u=20}=s,m=Math.ceil((c||0)/u);return{data:{data:o||[],meta:{total:c||0,page:d,per_page:u,has_more:d<m,total_pages:m}},error:null}})}async function o(e,a){if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let t=await (0,r.AG)();return(0,r.Uj)(async()=>await t.from("campaigns").update({...a,updated_at:new Date().toISOString()}).eq("id",e).select().single())}async function l(e){if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let a=await (0,r.AG)();return(0,r.Uj)(async()=>{let{error:t}=await a.from("campaigns").delete().eq("id",e);return{data:!t,error:t}})}async function c(e,a){let t=await (0,r.AG)();return(0,r.Uj)(async()=>{let r=e.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim().substring(0,50);(r=r.replace(/^-+|-+$/g,""))||(r="campaign");let n=r,i=0;for(;i<100;){let e=t.from("campaigns").select("id").eq("published_url",n);a&&(e=e.neq("id",a));let{data:s,error:o}=await e;if(o)throw o;if(!s||0===s.length)return{data:n,error:null};i++,n="".concat(r,"-").concat(i)}throw Error("Failed to generate unique URL after multiple attempts")})}async function d(e){if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let a=await (0,r.AG)();return(0,r.Uj)(async()=>{let t=[],{data:r,error:n}=await a.from("campaigns").select("\n        *,\n        sections (\n          id,\n          type,\n          title,\n          settings\n        )\n      ").eq("id",e).single();if(n||!r)throw n||Error("Campaign not found");return r.sections&&0!==r.sections.length||t.push("Campaign must have at least one section"),r.name&&0!==r.name.trim().length||t.push("Campaign must have a name"),r.sections&&r.sections.forEach((e,a)=>{e.title&&0!==e.title.trim().length||t.push("Section ".concat(a+1," must have a title"))}),{data:{isValid:0===t.length,errors:t},error:null}})}async function u(e,a){if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let t=await (0,r.AG)();return(0,r.Uj)(async()=>{var r,n;let i,s=await d(e);if(!s.success||!(null==(r=s.data)?void 0:r.isValid)){let e=(null==(n=s.data)?void 0:n.errors)||["Campaign validation failed"];throw Error("Cannot publish campaign: ".concat(e.join(", ")))}let{data:o,error:l}=await t.from("campaigns").select("name, published_url").eq("id",e).single();if(l||!o)throw l||Error("Campaign not found");if(a){if(!/^[a-z0-9-]+$/.test(a)||a.length<3||a.length>50)throw Error("Custom URL must be 3-50 characters long and contain only lowercase letters, numbers, and hyphens");let{data:r,error:n}=await t.from("campaigns").select("id").eq("published_url",a).neq("id",e);if(n)throw n;if(r&&r.length>0)throw Error("This custom URL is already taken. Please choose a different one.");i=a}else{let a=await c(o.name,e);if(!a.success||!a.data)throw Error(a.error||"Failed to generate unique URL");i=a.data}let u={status:"published",published_at:new Date().toISOString(),published_url:i,is_active:!0,updated_at:new Date().toISOString()},{data:m,error:f}=await t.from("campaigns").update(u).eq("id",e).select().single();if(f)throw f;return{data:m,error:null}})}async function m(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let t=await (0,r.AG)();return(0,r.Uj)(async()=>{let r={status:"draft",published_at:null,is_active:!1,updated_at:new Date().toISOString()};return a||(r.published_url=null),await t.from("campaigns").update(r).eq("id",e).select().single()})}async function f(e,a){let t=await (0,r.AG)();return(0,r.Uj)(async()=>{if(!/^[a-z0-9-]+$/.test(e)||e.length<3||e.length>50)return{data:{available:!1,suggestions:void 0},error:null};let r=t.from("campaigns").select("published_url").eq("published_url",e);a&&(r=r.neq("id",a));let{data:n,error:i}=await r;if(i)throw i;let s=!n||0===n.length,o=[];if(!s)for(let a=1;a<=5;a++){let r="".concat(e,"-").concat(a),{data:n}=await t.from("campaigns").select("published_url").eq("published_url",r).limit(1);n&&0!==n.length||o.push(r)}return{data:{available:s,suggestions:o.length>0?o:void 0},error:null}})}async function g(e){if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let a=await (0,r.AG)();return(0,r.Uj)(async()=>{let{data:t,error:r}=await a.from("campaigns").select("status, published_at").eq("id",e).single();if(r||!t)throw r||Error("Campaign not found");if("published"!==t.status||!t.published_at)throw Error("Only published campaigns can be activated");return await a.from("campaigns").update({is_active:!0,updated_at:new Date().toISOString()}).eq("id",e).select().single()})}async function p(e){if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let a=await (0,r.AG)();return(0,r.Uj)(async()=>{let{data:t,error:r}=await a.from("campaigns").select("status, published_at").eq("id",e).single();if(r||!t)throw r||Error("Campaign not found");if("published"!==t.status||!t.published_at)throw Error("Only published campaigns can be deactivated");return await a.from("campaigns").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",e).select().single()})}async function h(e){if(!(0,r.aJ)(e))return{success:!1,error:"Invalid campaign ID format"};await (0,r.oC)();let a=await (0,r.AG)();return(0,r.Uj)(async()=>{let{data:t,error:r}=await a.from("campaigns").select("status, published_at, is_active").eq("id",e).single();if(r||!t)throw r||Error("Campaign not found");let n="published"===t.status&&!!t.published_at;return{data:{isPublished:n,isActive:t.is_active,canActivate:n},error:null}})}},85793:(e,a,t)=>{t.d(a,{AG:()=>n,B9:()=>c,Rv:()=>o,Uj:()=>s,aJ:()=>l,fu:()=>d,oC:()=>m});var r=t(46414);async function n(){return(0,r.U)()}class i extends Error{constructor(e,a,t,r){super(e),this.code=a,this.details=t,this.validationErrors=r,this.name="DataAccessError"}}async function s(e){try{let{data:a,error:t}=await e();if(t){if(console.error("Database operation failed:",t),"PGRST116"===t.code)return{success:!1,error:"No records found"};if("23505"===t.code)return{success:!1,error:"Record already exists",validation_errors:[{field:"unique_constraint",message:"A record with this information already exists",code:"DUPLICATE_ENTRY"}]};if("23503"===t.code)return{success:!1,error:"Referenced record does not exist",validation_errors:[{field:"foreign_key",message:"The referenced record does not exist",code:"INVALID_REFERENCE"}]};return{success:!1,error:t.message||"Database operation failed"}}return{success:!0,data:a||void 0}}catch(e){return console.error("Unexpected error in database operation:",e),{success:!1,error:e instanceof Error?e.message:"Unexpected error occurred"}}}function o(e,a){let t=[];for(let r of a){let a=e[r];(null==a||""===a)&&t.push({field:r,message:"".concat(r," is required"),code:"REQUIRED_FIELD_MISSING",value:a})}return t}function l(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function c(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function d(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{page:t=1,per_page:r=20,sort_by:n,sort_order:i="desc"}=a,s=(t-1)*r;return e=e.range(s,s+r-1),n&&(e=e.order(n,{ascending:"asc"===i})),e}async function u(){let e=await n(),{data:{user:a}}=await e.auth.getUser();return(null==a?void 0:a.id)||null}async function m(){let e=await u();if(!e)throw new i("Authentication required","AUTH_REQUIRED");return e}},88145:(e,a,t)=>{t.d(a,{E:()=>l});var r=t(95155);t(12115);var n=t(99708),i=t(74466),s=t(53999);let o=(0,i.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:a,variant:t,asChild:i=!1,...l}=e,c=i?n.DX:"span";return(0,r.jsx)(c,{"data-slot":"badge",className:(0,s.cn)(o({variant:t}),a),...l})}},88482:(e,a,t)=>{t.d(a,{BT:()=>c,Wu:()=>d,ZB:()=>l,Zp:()=>s,aR:()=>o,wL:()=>u});var r=t(95155),n=t(12115),i=t(53999);let s=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground shadow",t),...n})});s.displayName="Card";let o=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...n})});o.displayName="CardHeader";let l=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,i.cn)("font-semibold leading-none tracking-tight",t),...n})});l.displayName="CardTitle";let c=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",t),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,i.cn)("p-6 pt-0",t),...n})});d.displayName="CardContent";let u=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,r.jsx)("div",{ref:a,className:(0,i.cn)("flex items-center p-6 pt-0",t),...n})});u.displayName="CardFooter"},97168:(e,a,t)=>{t.d(a,{$:()=>c});var r=t(95155),n=t(12115),i=t(99708),s=t(74466),o=t(53999);let l=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,a)=>{let{className:t,variant:n,size:s,asChild:c=!1,...d}=e,u=c?i.DX:"button";return(0,r.jsx)(u,{className:(0,o.cn)(l({variant:n,size:s,className:t})),ref:a,...d})});c.displayName="Button"}}]);